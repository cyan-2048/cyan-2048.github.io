"undefined"!=window.jQuery&&function(x,C){function e(){if(!M.isReady){try{w.documentElement.doScroll("left")}catch(t){return void setTimeout(e,1)}M.ready()}}function h(t,e){e.src?M.ajax({url:e.src,async:!1,dataType:"script"}):M.globalEval(e.text||e.textContent||e.innerHTML||""),e.parentNode&&e.parentNode.removeChild(e)}function l(t,e,i,n,o,s){var r=t.length;if("object"==typeof e){for(var a in e)l(t,a,e[a],n,o,i);return t}if(i===C)return r?o(t[0],e):C;for(n=!s&&n&&M.isFunction(i),a=0;a<r;a++)o(t[a],e,n?i.call(t[a],a,o(t[a],e)):i,s);return t}function v(){return(new Date).getTime()}function t(){return!1}function i(){return!0}function n(t,e,i){return i[0].type=t,M.event.handle.apply(e,i)}function o(t){var e,i,n,o,s,r=[],a=[],l=arguments,m=M.data(this,"events");if(t.liveFired!==this&&m&&m.live&&(!t.button||"click"!==t.type)){t.liveFired=this;for(var c=m.live.slice(0),h=0;h<c.length;h++)(m=c[h]).origType.replace($,"")===t.type?a.push(m.selector):c.splice(h--,1);for(o=0,s=(i=M(t.target).closest(a,t.currentTarget)).length;o<s;o++)for(h=0;h<c.length;h++)m=c[h],i[o].selector===m.selector&&(n=i[o].elem,a=null,"mouseenter"!==m.preType&&"mouseleave"!==m.preType||(a=M(t.relatedTarget).closest(m.selector)[0]),a&&a===n||r.push({elem:n,handleObj:m}));for(o=0,s=r.length;o<s;o++)if(i=r[o],t.currentTarget=i.elem,t.data=i.handleObj.data,t.handleObj=i.handleObj,!1===i.handleObj.origHandler.apply(i.elem,l)){e=!1;break}return e}}function u(t,e){return"live."+(t&&"*"!==t?t+".":"")+e.replace(/\./g,"`").replace(/ /g,"&")}function s(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function r(o,t){var s=0;t.each(function(){if(this.nodeName===(o[s]&&o[s].nodeName)){var t=M.data(o[s++]),e=M.data(this,t);if(t=t&&t.events)for(var i in delete e.handle,e.events={},t)for(var n in t[i])M.event.add(this,i,t[i][n],t[i][n].data)}})}function _(t,e,i){var n,o,s;return e=e&&e[0]?e[0].ownerDocument||e[0]:w,1===t.length&&"string"==typeof t[0]&&t[0].length<512&&e===w&&!pt.test(t[0])&&(M.support.checkClone||!dt.test(t[0]))&&(o=!0,(s=M.fragments[t[0]])&&1!==s&&(n=s)),n||(n=e.createDocumentFragment(),M.clean(t,e,n,i)),o&&(M.fragments[t[0]]=s?n:1),{fragment:n,cacheable:o}}function a(t,e){var i={};return M.each(Ut.concat.apply([],Ut.slice(0,e)),function(){i[this]=t}),i}function m(t){return"scrollTo"in t&&t.document?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}var c,p,M=function(t,e){return new M.fn.init(t,e)},d=x.jQuery,y=x.$,w=x.document,b=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,f=/^.[^:#\[\.,]*$/,g=/\S/,S=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,A=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,V=navigator.userAgent,I=!1,P=[],B=Object.prototype.toString,R=Object.prototype.hasOwnProperty,T=Array.prototype.push,L=Array.prototype.slice,D=Array.prototype.indexOf;M.fn=M.prototype={init:function(t,e){var i,n;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!e)return this.context=w,this[0]=w.body,this.selector="body",this.length=1,this;if("string"!=typeof t)return M.isFunction(t)?c.ready(t):(t.selector!==C&&(this.selector=t.selector,this.context=t.context),M.makeArray(t,this));if(!(i=b.exec(t))||!i[1]&&e)return!e&&/^\w+$/.test(t)?(this.selector=t,t=(this.context=w).getElementsByTagName(t),M.merge(this,t)):(!e||e.jquery?e||c:M(e)).find(t);if(i[1])return n=e?e.ownerDocument||e:w,(t=A.exec(t))?M.isPlainObject(e)?(t=[w.createElement(t[1])],M.fn.attr.call(t,e,!0)):t=[n.createElement(t[1])]:t=((t=_([i[1]],[n])).cacheable?t.fragment.cloneNode(!0):t.fragment).childNodes,M.merge(this,t);if(e=w.getElementById(i[2])){if(e.id!==i[2])return c.find(t);this.length=1,this[0]=e}return this.context=w,this.selector=t,this},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return L.call(this,0)},get:function(t){return null==t?this.toArray():t<0?this.slice(t)[0]:this[t]},pushStack:function(t,e,i){var n=M();return M.isArray(t)?T.apply(n,t):M.merge(n,t),n.prevObject=this,n.context=this.context,"find"===e?n.selector=this.selector+(this.selector?" ":"")+i:e&&(n.selector=this.selector+"."+e+"("+i+")"),n},each:function(t,e){return M.each(this,t,e)},ready:function(t){return M.bindReady(),M.isReady?t.call(w,M):P&&P.push(t),this},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(L.apply(this,arguments),"slice",L.call(arguments).join(","))},map:function(i){return this.pushStack(M.map(this,function(t,e){return i.call(t,e,t)}))},end:function(){return this.prevObject||M(null)},push:T,sort:[].sort,splice:[].splice},M.fn.init.prototype=M.fn,M.extend=M.fn.extend=function(){var t,e,i,n,o=arguments[0]||{},s=1,r=arguments.length,a=!1;for("boolean"==typeof o&&(a=o,o=arguments[1]||{},s=2),"object"==typeof o||M.isFunction(o)||(o={}),r===s&&(o=this,--s);s<r;s++)if(null!=(t=arguments[s]))for(e in t)i=o[e],o!==(n=t[e])&&(a&&n&&(M.isPlainObject(n)||M.isArray(n))?(i=i&&(M.isPlainObject(i)||M.isArray(i))?i:M.isArray(n)?[]:{},o[e]=M.extend(a,i,n)):n!==C&&(o[e]=n));return o},M.extend({noConflict:function(t){return x.$=y,t&&(x.jQuery=d),M},isReady:!1,ready:function(){if(!M.isReady){if(!w.body)return setTimeout(M.ready,13);if(M.isReady=!0,P){for(var t,e=0;t=P[e++];)t.call(w,M);P=null}M.fn.triggerHandler&&M(w).triggerHandler("ready")}},bindReady:function(){if(!I){if(I=!0,"complete"===w.readyState)return M.ready();if(w.addEventListener)w.addEventListener("DOMContentLoaded",p,!1),x.addEventListener("load",M.ready,!1);else if(w.attachEvent){w.attachEvent("onreadystatechange",p),x.attachEvent("onload",M.ready);var t=!1;try{t=null==x.frameElement}catch(t){}w.documentElement.doScroll&&t&&e()}}},isFunction:function(t){return"[object Function]"===B.call(t)},isArray:function(t){return"[object Array]"===B.call(t)},isPlainObject:function(t){if(!t||"[object Object]"!==B.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!R.call(t,"constructor")&&!R.call(t.constructor.prototype,"isPrototypeOf"))return!1;for(var e in t);return e===C||R.call(t,e)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw t},parseJSON:function(t){return"string"==typeof t&&t?(t=M.trim(t),/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))?x.JSON&&x.JSON.parse?x.JSON.parse(t):new Function("return "+t)():void M.error("Invalid JSON: "+t)):null},noop:function(){},globalEval:function(t){var e,i;t&&g.test(t)&&(e=w.getElementsByTagName("head")[0]||w.documentElement,(i=w.createElement("script")).type="text/javascript",M.support.scriptEval?i.appendChild(w.createTextNode(t)):i.text=t,e.insertBefore(i,e.firstChild),e.removeChild(i))},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,e,i){var n,o=0,s=t.length,r=s===C||M.isFunction(t);if(i)if(r){for(n in t)if(!1===e.apply(t[n],i))break}else for(;o<s&&!1!==e.apply(t[o++],i););else if(r){for(n in t)if(!1===e.call(t[n],n,t[n]))break}else for(i=t[0];o<s&&!1!==e.call(i,o,i);i=t[++o]);return t},trim:function(t){return(t||"").replace(S,"")},makeArray:function(t,e){return e=e||[],null!=t&&(null==t.length||"string"==typeof t||M.isFunction(t)||"function"!=typeof t&&t.setInterval?T.call(e,t):M.merge(e,t)),e},inArray:function(t,e){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},merge:function(t,e){var i=t.length,n=0;if("number"==typeof e.length)for(var o=e.length;n<o;n++)t[i++]=e[n];else for(;e[n]!==C;)t[i++]=e[n++];return t.length=i,t},grep:function(t,e,i){for(var n=[],o=0,s=t.length;o<s;o++)!i!=!e(t[o],o)&&n.push(t[o]);return n},map:function(t,e,i){for(var n,o=[],s=0,r=t.length;s<r;s++)null!=(n=e(t[s],s,i))&&(o[o.length]=n);return o.concat.apply([],o)},guid:1,proxy:function(t,e,i){return 2===arguments.length&&("string"==typeof e?(t=(i=t)[e],e=C):e&&!M.isFunction(e)&&(i=e,e=C)),!e&&t&&(e=function(){return t.apply(i||this,arguments)}),t&&(e.guid=t.guid=t.guid||e.guid||M.guid++),e},uaMatch:function(t){return t=t.toLowerCase(),{browser:(t=/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||!/compatible/.test(t)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(t)||[])[1]||"",version:t[2]||"0"}},browser:{}}),(V=M.uaMatch(V)).browser&&(M.browser[V.browser]=!0,M.browser.version=V.version),M.browser.webkit&&(M.browser.safari=!0),D&&(M.inArray=function(t,e){return D.call(e,t)}),c=M(w),w.addEventListener?p=function(){w.removeEventListener("DOMContentLoaded",p,!1),M.ready()}:w.attachEvent&&(p=function(){"complete"===w.readyState&&(w.detachEvent("onreadystatechange",p),M.ready())}),function(){M.support={};var t=w.documentElement,e=w.createElement("script"),i=w.createElement("div"),n="script"+v();i.style.display="none",i.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var o=i.getElementsByTagName("*"),s=i.getElementsByTagName("a")[0];if(o&&o.length&&s){M.support={leadingWhitespace:3===i.firstChild.nodeType,tbody:!i.getElementsByTagName("tbody").length,htmlSerialize:!!i.getElementsByTagName("link").length,style:/red/.test(s.getAttribute("style")),hrefNormalized:"/a"===s.getAttribute("href"),opacity:/^0.55$/.test(s.style.opacity),cssFloat:!!s.style.cssFloat,checkOn:"on"===i.getElementsByTagName("input")[0].value,optSelected:w.createElement("select").appendChild(w.createElement("option")).selected,parentNode:null===i.removeChild(i.appendChild(w.createElement("div"))).parentNode,deleteExpando:!0,checkClone:!1,scriptEval:!1,noCloneEvent:!0,boxModel:null},e.type="text/javascript";try{e.appendChild(w.createTextNode("window."+n+"=1;"))}catch(t){}t.insertBefore(e,t.firstChild),x[n]&&(M.support.scriptEval=!0,delete x[n]);try{delete e.test}catch(t){M.support.deleteExpando=!1}t.removeChild(e),i.attachEvent&&i.fireEvent&&(i.attachEvent("onclick",function t(){M.support.noCloneEvent=!1,i.detachEvent("onclick",t)}),i.cloneNode(!0).fireEvent("onclick")),(i=w.createElement("div")).innerHTML="<input type='radio' name='radiotest' checked='checked'/>",(t=w.createDocumentFragment()).appendChild(i.firstChild),M.support.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,M(function(){var t=w.createElement("div");t.style.width=t.style.paddingLeft="1px",w.body.appendChild(t),M.boxModel=M.support.boxModel=2===t.offsetWidth,w.body.removeChild(t).style.display="none"}),t=function(t){var e=w.createElement("div"),i=(t="on"+t)in e;return i||(e.setAttribute(t,"return;"),i="function"==typeof e[t]),i},M.support.submitBubbles=t("submit"),M.support.changeBubbles=t("change"),t=e=i=o=s=null}}(),M.props={for:"htmlFor",class:"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var J="jQuery"+v(),F=0,N={};M.extend({cache:{},expando:J,noData:{embed:!0,object:!0,applet:!0},data:function(t,e,i){if(!t.nodeName||!M.noData[t.nodeName.toLowerCase()]){var n=(t=t==x?N:t)[J],o=M.cache;return n||"string"!=typeof e||i!==C?(n=n||++F,"object"==typeof e?o[t[J]=n]=M.extend(!0,{},e):o[n]||(o[t[J]=n]={}),t=o[n],i!==C&&(t[e]=i),"string"==typeof e?t[e]:t):null}},removeData:function(t,e){var i,n,o;t.nodeName&&M.noData[t.nodeName.toLowerCase()]||(i=(t=t==x?N:t)[J],o=(n=M.cache)[i],e?o&&(delete o[e],M.isEmptyObject(o)&&M.removeData(t)):(M.support.deleteExpando?delete t[M.expando]:t.removeAttribute&&t.removeAttribute(M.expando),delete n[i]))}}),M.fn.extend({data:function(t,e){if(void 0===t&&this.length)return M.data(this[0]);if("object"==typeof t)return this.each(function(){M.data(this,t)});var i=t.split(".");if(i[1]=i[1]?"."+i[1]:"",e!==C)return this.trigger("setData"+i[1]+"!",[i[0],e]).each(function(){M.data(this,t,e)});var n=this.triggerHandler("getData"+i[1]+"!",[i[0]]);return n===C&&this.length&&(n=M.data(this[0],t)),n===C&&i[1]?this.data(i[0]):n},removeData:function(t){return this.each(function(){M.removeData(this,t)})}}),M.extend({queue:function(t,e,i){if(t){e=(e||"fx")+"queue";var n=M.data(t,e);return i?(!n||M.isArray(i)?n=M.data(t,e,M.makeArray(i)):n.push(i),n):n||[]}},dequeue:function(t,e){e=e||"fx";var i=M.queue(t,e),n=i.shift();"inprogress"===n&&(n=i.shift()),n&&("fx"===e&&i.unshift("inprogress"),n.call(t,function(){M.dequeue(t,e)}))}}),M.fn.extend({queue:function(e,i){return"string"!=typeof e&&(i=e,e="fx"),i===C?M.queue(this[0],e):this.each(function(){var t=M.queue(this,e,i);"fx"===e&&"inprogress"!==t[0]&&M.dequeue(this,e)})},dequeue:function(t){return this.each(function(){M.dequeue(this,t)})},delay:function(e,i){return e=M.fx&&M.fx.speeds[e]||e,i=i||"fx",this.queue(i,function(){var t=this;setTimeout(function(){M.dequeue(t,i)},e)})},clearQueue:function(t){return this.queue(t||"fx",[])}});var E=/[\n\t]/g,j=/\s+/,k=/\r/g,O=/href|src|style/,z=/(button|input)/i,q=/(button|input|object|select|textarea)/i,G=/^(a|area)$/i,U=/radio|checkbox/;function K(t){return t.replace(/[^\w\s\.\|`]/g,function(t){return"\\"+t})}M.fn.extend({attr:function(t,e){return l(this,t,e,!0,M.attr)},removeAttr:function(t){return this.each(function(){M.attr(this,t,""),1===this.nodeType&&this.removeAttribute(t)})},addClass:function(i){if(M.isFunction(i))return this.each(function(t){var e=M(this);e.addClass(i.call(this,t,e.attr("class")))});if(i&&"string"==typeof i)for(var t=(i||"").split(j),e=0,n=this.length;e<n;e++){var o=this[e];if(1===o.nodeType)if(o.className){for(var s=" "+o.className+" ",r=o.className,a=0,l=t.length;a<l;a++)s.indexOf(" "+t[a]+" ")<0&&(r+=" "+t[a]);o.className=M.trim(r)}else o.className=i}return this},removeClass:function(i){if(M.isFunction(i))return this.each(function(t){var e=M(this);e.removeClass(i.call(this,t,e.attr("class")))});if(i&&"string"==typeof i||i===C)for(var t=(i||"").split(j),e=0,n=this.length;e<n;e++){var o=this[e];if(1===o.nodeType&&o.className)if(i){for(var s=(" "+o.className+" ").replace(E," "),r=0,a=t.length;r<a;r++)s=s.replace(" "+t[r]+" "," ");o.className=M.trim(s)}else o.className=""}return this},toggleClass:function(s,r){var a=typeof s,l="boolean"==typeof r;return M.isFunction(s)?this.each(function(t){var e=M(this);e.toggleClass(s.call(this,t,e.attr("class"),r),r)}):this.each(function(){if("string"==a)for(var t,e=0,i=M(this),n=r,o=s.split(j);t=o[e++];)n=l?n:!i.hasClass(t),i[n?"addClass":"removeClass"](t);else"undefined"!=a&&"boolean"!=a||(this.className&&M.data(this,"__className__",this.className),this.className=!this.className&&!1!==s&&M.data(this,"__className__")||"")})},hasClass:function(t){t=" "+t+" ";for(var e=0,i=this.length;e<i;e++)if(-1<(" "+this[e].className+" ").replace(E," ").indexOf(t))return!0;return!1},val:function(o){if(o===C){if(n=this[0]){if(M.nodeName(n,"option"))return(n.attributes.value||{}).specified?n.value:n.text;if(M.nodeName(n,"select")){var t=n.selectedIndex,e=[],i=n.options,n="select-one"===n.type;if(t<0)return null;for(var s=n?t:0,t=n?t+1:i.length;s<t;s++){var r=i[s];if(r.selected){if(o=M(r).val(),n)return o;e.push(o)}}return e}return U.test(n.type)&&!M.support.checkOn?null===n.getAttribute("value")?"on":n.value:(n.value||"").replace(k,"")}return C}var a=M.isFunction(o);return this.each(function(t){var e,i=M(this),n=o;1===this.nodeType&&(a&&(n=o.call(this,t,i.val())),"number"==typeof n&&(n+=""),M.isArray(n)&&U.test(this.type)?this.checked=0<=M.inArray(i.val(),n):M.nodeName(this,"select")?(e=M.makeArray(n),M("option",this).each(function(){this.selected=0<=M.inArray(M(this).val(),e)}),e.length||(this.selectedIndex=-1)):this.value=n)})}}),M.extend({attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,e,i,n){if(!t||3===t.nodeType||8===t.nodeType)return C;if(n&&e in M.attrFn)return M(t)[e](i);n=1!==t.nodeType||!M.isXMLDoc(t);var o=i!==C;if(e=n&&M.props[e]||e,1!==t.nodeType)return M.style(t,e,i);var s=O.test(e);return e in t&&n&&!s?(o&&("type"===e&&z.test(t.nodeName)&&t.parentNode&&M.error("type property can't be changed"),t[e]=i),M.nodeName(t,"form")&&t.getAttributeNode(e)?t.getAttributeNode(e).nodeValue:"tabIndex"===e?(e=t.getAttributeNode("tabIndex"))&&e.specified?e.value:q.test(t.nodeName)||G.test(t.nodeName)&&t.href?0:C:t[e]):!M.support.style&&n&&"style"===e?(o&&(t.style.cssText=""+i),t.style.cssText):(o&&t.setAttribute(e,""+i),null===(t=!M.support.hrefNormalized&&n&&s?t.getAttribute(e,2):t.getAttribute(e))?C:t)}});var $=/\.(.*)$/;M.event={add:function(t,e,i,n){var o,s;if(3!==t.nodeType&&8!==t.nodeType&&(t.setInterval&&t!==x&&!t.frameElement&&(t=x),i.handler&&(i=(o=i).handler),i.guid||(i.guid=M.guid++),s=M.data(t))){var r=s.events=s.events||{},a=s.handle;a||(s.handle=a=function(){return void 0===M||M.event.triggered?C:M.event.handle.apply(a.elem,arguments)}),a.elem=t,e=e.split(" ");for(var l,m,c=0;l=e[c++];){s=o?M.extend({},o):{handler:i,data:n},-1<l.indexOf(".")?(l=(m=l.split(".")).shift(),s.namespace=m.slice(0).sort().join(".")):(m=[],s.namespace=""),s.type=l,s.guid=i.guid;var h=r[l],u=M.event.special[l]||{};h||(h=r[l]=[],u.setup&&!1!==u.setup.call(t,n,m,a)||(t.addEventListener?t.addEventListener(l,a,!1):t.attachEvent&&t.attachEvent("on"+l,a))),u.add&&(u.add.call(t,s),s.handler.guid||(s.handler.guid=i.guid)),h.push(s),M.event.global[l]=!0}t=null}},global:{},remove:function(t,e,i,n){if(3!==t.nodeType&&8!==t.nodeType){var o,s,r,a,l,m,c,h=0,u=M.data(t),_=u&&u.events;if(u&&_)if(e&&e.type&&(i=e.handler,e=e.type),!e||"string"==typeof e&&"."===e.charAt(0))for(o in e=e||"",_)M.event.remove(t,o+e);else{for(e=e.split(" ");o=e[h++];)if(r=[],(s=(l=o).indexOf(".")<0)||(o=(r=o.split(".")).shift(),a=new RegExp("(^|\\.)"+M.map(r.slice(0).sort(),K).join("\\.(?:.*\\.)?")+"(\\.|$)")),m=_[o])if(i){for(l=M.event.special[o]||{},p=n||0;p<m.length&&(c=m[p],i.guid!==c.guid||((s||a.test(c.namespace))&&(null==n&&m.splice(p--,1),l.remove&&l.remove.call(t,c)),null==n));p++);(0===m.length||null!=n&&1===m.length)&&(l.teardown&&!1!==l.teardown.call(t,r)||Q(t,o,u.handle),delete _[o])}else for(var p=0;p<m.length;p++)c=m[p],(s||a.test(c.namespace))&&(M.event.remove(t,l,c.handler,p),m.splice(p--,1));M.isEmptyObject(_)&&((e=u.handle)&&(e.elem=null),delete u.events,delete u.handle,M.isEmptyObject(u)&&M.removeData(t))}}},trigger:function(t,e,i,n){var o=t.type||t;if(!n){if(t="object"==typeof t?t[J]?t:M.extend(M.Event(o),t):M.Event(o),0<=o.indexOf("!")&&(t.type=o=o.slice(0,-1),t.exclusive=!0),i||(t.stopPropagation(),M.event.global[o]&&M.each(M.cache,function(){this.events&&this.events[o]&&M.event.trigger(t,e,this.handle.elem)})),!i||3===i.nodeType||8===i.nodeType)return C;t.result=C,t.target=i,(e=M.makeArray(e)).unshift(t)}t.currentTarget=i,(n=M.data(i,"handle"))&&n.apply(i,e),n=i.parentNode||i.ownerDocument;try{i&&i.nodeName&&M.noData[i.nodeName.toLowerCase()]||i["on"+o]&&!1===i["on"+o].apply(i,e)&&(t.result=!1)}catch(t){}if(!t.isPropagationStopped()&&n)M.event.trigger(t,e,n,!0);else if(!t.isDefaultPrevented()){n=t.target;var s,r=M.nodeName(n,"a")&&"click"===o,a=M.event.special[o]||{};if(!(a._default&&!1!==a._default.call(i,t)||r||n&&n.nodeName&&M.noData[n.nodeName.toLowerCase()])){try{n[o]&&((s=n["on"+o])&&(n["on"+o]=null),M.event.triggered=!0,n[o]())}catch(t){}s&&(n["on"+o]=s),M.event.triggered=!1}}},handle:function(t){var e,i,n,o;if((t=arguments[0]=M.event.fix(t||x.event)).currentTarget=this,(e=t.type.indexOf(".")<0&&!t.exclusive)||(i=t.type.split("."),t.type=i.shift(),n=new RegExp("(^|\\.)"+i.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")),i=(o=M.data(this,"events"))[t.type],o&&i){o=0;for(var s=(i=i.slice(0)).length;o<s;o++){var r=i[o];if((e||n.test(r.namespace))&&(t.handler=r.handler,t.data=r.data,(r=(t.handleObj=r).handler.apply(this,arguments))!==C&&!1===(t.result=r)&&(t.preventDefault(),t.stopPropagation()),t.isImmediatePropagationStopped()))break}}return t.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(t){if(t[J])return t;var e=t;t=M.Event(e);for(var i,n=this.props.length;n;)t[i=this.props[--n]]=e[i];return t.target||(t.target=t.srcElement||w),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),null==t.pageX&&null!=t.clientX&&(e=w.documentElement,n=w.body,t.pageX=t.clientX+(e&&e.scrollLeft||n&&n.scrollLeft||0)-(e&&e.clientLeft||n&&n.clientLeft||0),t.pageY=t.clientY+(e&&e.scrollTop||n&&n.scrollTop||0)-(e&&e.clientTop||n&&n.clientTop||0)),!t.which&&(t.charCode||0===t.charCode?t.charCode:t.keyCode)&&(t.which=t.charCode||t.keyCode),!t.metaKey&&t.ctrlKey&&(t.metaKey=t.ctrlKey),t.which||t.button===C||(t.which=1&t.button?1:2&t.button?3:4&t.button?2:0),t},guid:1e8,proxy:M.proxy,special:{ready:{setup:M.bindReady,teardown:M.noop},live:{add:function(t){M.event.add(this,t.origType,M.extend({},t,{handler:o}))},remove:function(t){var e=!0,i=t.origType.replace($,"");M.each(M.data(this,"events").live||[],function(){if(i===this.origType.replace($,""))return e=!1}),e&&M.event.remove(this,t.origType,o)}},beforeunload:{setup:function(t,e,i){return this.setInterval&&(this.onbeforeunload=i),!1},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}}};var X,W,H,Y,Q=w.removeEventListener?function(t,e,i){t.removeEventListener(e,i,!1)}:function(t,e,i){t.detachEvent("on"+e,i)};function Z(t){var e=t.relatedTarget;try{for(;e&&e!==this;)e=e.parentNode;e!==this&&(t.type=t.data,M.event.handle.apply(this,arguments))}catch(t){}}function tt(t){t.type=t.data,M.event.handle.apply(this,arguments)}M.Event=function(t){if(!this.preventDefault)return new M.Event(t);t&&t.type?(this.originalEvent=t,this.type=t.type):this.type=t,this.timeStamp=v(),this[J]=!0},M.Event.prototype={preventDefault:function(){this.isDefaultPrevented=i;var t=this.originalEvent;t&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=i;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()},isDefaultPrevented:t,isPropagationStopped:t,isImmediatePropagationStopped:t},M.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,i){M.event.special[e]={setup:function(t){M.event.add(this,i,t&&t.selector?tt:Z,e)},teardown:function(t){M.event.remove(this,i,t&&t.selector?tt:Z)}}}),M.support.submitBubbles||(M.event.special.submit={setup:function(){if("form"===this.nodeName.toLowerCase())return!1;M.event.add(this,"click.specialSubmit",function(t){var e=t.target,i=e.type;if(("submit"===i||"image"===i)&&M(e).closest("form").length)return n("submit",this,arguments)}),M.event.add(this,"keypress.specialSubmit",function(t){var e=t.target,i=e.type;if(("text"===i||"password"===i)&&M(e).closest("form").length&&13===t.keyCode)return n("submit",this,arguments)})},teardown:function(){M.event.remove(this,".specialSubmit")}}),M.support.changeBubbles||(X=/textarea|input|select/i,H=function(t){var e=t.type,i=t.value;return"radio"===e||"checkbox"===e?i=t.checked:"select-multiple"===e?i=-1<t.selectedIndex?M.map(t.options,function(t){return t.selected}).join("-"):"":"select"===t.nodeName.toLowerCase()&&(i=t.selectedIndex),i},Y=function(t,e){var i,n,o=t.target;if(X.test(o.nodeName)&&!o.readOnly&&(i=M.data(o,"_change_data"),n=H(o),"focusout"===t.type&&"radio"===o.type||M.data(o,"_change_data",n),i!==C&&n!==i&&(null!=i||n)))return t.type="change",M.event.trigger(t,e,o)},M.event.special.change={filters:{focusout:Y,click:function(t){var e=t.target,i=e.type;if("radio"===i||"checkbox"===i||"select"===e.nodeName.toLowerCase())return Y.call(this,t)},keydown:function(t){var e=t.target,i=e.type;if(13===t.keyCode&&"textarea"!==e.nodeName.toLowerCase()||32===t.keyCode&&("checkbox"===i||"radio"===i)||"select-multiple"===i)return Y.call(this,t)},beforeactivate:function(t){t=t.target,M.data(t,"_change_data",H(t))}},setup:function(){if("file"===this.type)return!1;for(var t in W)M.event.add(this,t+".specialChange",W[t]);return X.test(this.nodeName)},teardown:function(){return M.event.remove(this,".specialChange"),X.test(this.nodeName)}},W=M.event.special.change.filters),w.addEventListener&&M.each({focus:"focusin",blur:"focusout"},function(t,e){function i(t){return(t=M.event.fix(t)).type=e,M.event.handle.call(this,t)}M.event.special[e]={setup:function(){this.addEventListener(t,i,!0)},teardown:function(){this.removeEventListener(t,i,!0)}}}),M.each(["bind","one"],function(t,r){M.fn[r]=function(t,e,i){if("object"==typeof t){for(var n in t)this[r](n,e,t[n],i);return this}M.isFunction(e)&&(i=e,e=C);var o="one"===r?M.proxy(i,function(t){return M(this).unbind(t,o),i.apply(this,arguments)}):i;if("unload"===t&&"one"!==r)this.one(t,e,i);else{n=0;for(var s=this.length;n<s;n++)M.event.add(this[n],t,o,e)}return this}}),M.fn.extend({unbind:function(t,e){if("object"!=typeof t||t.preventDefault){n=0;for(var i=this.length;n<i;n++)M.event.remove(this[n],t,e)}else for(var n in t)this.unbind(n,t[n]);return this},delegate:function(t,e,i,n){return this.live(e,i,n,t)},undelegate:function(t,e,i){return 0===arguments.length?this.unbind("live"):this.die(e,null,i,t)},trigger:function(t,e){return this.each(function(){M.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0])return(t=M.Event(t)).preventDefault(),t.stopPropagation(),M.event.trigger(t,e,this[0]),t.result},toggle:function(i){for(var n=arguments,o=1;o<n.length;)M.proxy(i,n[o++]);return this.click(M.proxy(i,function(t){var e=(M.data(this,"lastToggle"+i.guid)||0)%o;return M.data(this,"lastToggle"+i.guid,1+e),t.preventDefault(),n[e].apply(this,arguments)||!1}))},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}});var et={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};function it(t,i,n){if(M.isFunction(i))return M.grep(t,function(t,e){return!!i.call(t,e,t)===n});if(i.nodeType)return M.grep(t,function(t){return t===i===n});if("string"==typeof i){var e=M.grep(t,function(t){return 1===t.nodeType});if(f.test(i))return M.filter(i,e,!n);i=M.filter(i,e)}return M.grep(t,function(t){return 0<=M.inArray(t,i)===n})}M.each(["live","die"],function(t,c){M.fn[c]=function(t,e,i,n){var o,s,r,a=0,l=n||this.selector,m=n?this:M(this.context);for(M.isFunction(e)&&(i=e,e=C),t=(t||"").split(" ");null!=(o=t[a++]);)s="",(n=$.exec(o))&&(s=n[0],o=o.replace($,"")),"hover"===o?t.push("mouseenter"+s,"mouseleave"+s):("focus"===(r=o)||"blur"===o?(t.push(et[o]+s),o+=s):o=(et[o]||o)+s,"live"===c?m.each(function(){M.event.add(this,u(o,l),{data:e,selector:l,handler:i,origType:o,origHandler:i,preType:r})}):m.unbind(u(o,l),i));return this}}),M.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(t,e){M.fn[e]=function(t){return t?this.bind(e,t):this.trigger(e)},M.attrFn&&(M.attrFn[e]=!0)}),x.attachEvent&&!x.addEventListener&&x.attachEvent("onunload",function(){for(var t in M.cache)if(M.cache[t].handle)try{M.event.remove(M.cache[t].handle.elem)}catch(t){}}),function(){function r(t){for(var e,i="",n=0;t[n];n++)3===(e=t[n]).nodeType||4===e.nodeType?i+=e.nodeValue:8!==e.nodeType&&(i+=r(e.childNodes));return i}function a(t,e,i,n,o,s){o=0;for(var r=n.length;o<r;o++){var a=n[o];if(a){a=a[t];for(var l=!1;a;){if(a.sizcache===i){l=n[a.sizset];break}if(1!==a.nodeType||s||(a.sizcache=i,a.sizset=o),a.nodeName.toLowerCase()===e){l=a;break}a=a[t]}n[o]=l}}}function l(t,e,i,n,o,s){o=0;for(var r=n.length;o<r;o++){var a=n[o];if(a){a=a[t];for(var l=!1;a;){if(a.sizcache===i){l=n[a.sizset];break}if(1===a.nodeType)if(s||(a.sizcache=i,a.sizset=o),"string"!=typeof e){if(a===e){l=!0;break}}else if(0<y.filter(e,[a]).length){l=a;break}a=a[t]}n[o]=l}}}var p=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,m=0,d=Object.prototype.toString,o=!1,i=!0;[0,0].sort(function(){return i=!1,0});var y=function(t,e,i,n){i=i||[];var o=e=e||w;if(1!==e.nodeType&&9!==e.nodeType)return[];if(!t||"string"!=typeof t)return i;for(var s,r,a,l=[],m=!0,c=g(e),h=t;null!==(p.exec(""),_=p.exec(h));)if(h=_[3],l.push(_[1]),_[2]){a=_[3];break}if(1<l.length&&f.exec(t))if(2===l.length&&b.relative[l[0]])s=S(l[0]+l[1],e);else for(s=b.relative[l[0]]?[e]:y(l.shift(),e);l.length;)t=l.shift(),b.relative[t]&&(t+=l.shift()),s=S(t,s);else if(!n&&1<l.length&&9===e.nodeType&&!c&&b.match.ID.test(l[0])&&!b.match.ID.test(l[l.length-1])&&(e=((_=y.find(l.shift(),e,c)).expr?y.filter(_.expr,_.set):_.set)[0]),e)for(s=(_=n?{expr:l.pop(),set:x(n)}:y.find(l.pop(),1!==l.length||"~"!==l[0]&&"+"!==l[0]||!e.parentNode?e:e.parentNode,c)).expr?y.filter(_.expr,_.set):_.set,0<l.length?r=x(s):m=!1;l.length;){var u=l.pop(),_=u;b.relative[u]?_=l.pop():u="",null==_&&(_=e),b.relative[u](r,_,c)}else r=[];if((r=r||s)||y.error(u||t),"[object Array]"===d.call(r))if(m)if(e&&1===e.nodeType)for(t=0;null!=r[t];t++)r[t]&&(!0===r[t]||1===r[t].nodeType&&v(e,r[t]))&&i.push(s[t]);else for(t=0;null!=r[t];t++)r[t]&&1===r[t].nodeType&&i.push(s[t]);else i.push.apply(i,r);else x(r,i);return a&&(y(a,o,i,n),y.uniqueSort(i)),i};y.uniqueSort=function(t){if(n&&(o=i,t.sort(n),o))for(var e=1;e<t.length;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},y.matches=function(t,e){return y(t,null,null,e)},y.find=function(t,e,i){var n,o;if(!t)return[];for(var s=0,r=b.order.length;s<r;s++){var a=b.order[s];if(o=b.leftMatch[a].exec(t)){var l=o[1];if(o.splice(1,1),"\\"!==l.substr(l.length-1)&&(o[1]=(o[1]||"").replace(/\\/g,""),null!=(n=b.find[a](o,e,i)))){t=t.replace(b.match[a],"");break}}}return{set:n=n||e.getElementsByTagName("*"),expr:t}},y.filter=function(t,e,i,n){for(var o,s=t,r=[],a=e,l=e&&e[0]&&g(e[0]);t&&e.length;){for(var m in b.filter)if(null!=(o=b.leftMatch[m].exec(t))&&o[2]){var c,h,u=b.filter[m],_=o[1],p=!1;if(o.splice(1,1),"\\"!==_.substr(_.length-1)){if(a===r&&(r=[]),b.preFilter[m])if(o=b.preFilter[m](o,a,i,r,n,l)){if(!0===o)continue}else p=c=!0;if(o)for(var d=0;null!=(_=a[d]);d++)_&&(h=n^!!(c=u(_,o,d,a)),i&&null!=c?h?p=!0:a[d]=!1:h&&(r.push(_),p=!0));if(c!==C){if(i||(a=r),t=t.replace(b.match[m],""),!p)return[];break}}}if(t===s){if(null!=p)break;y.error(t)}s=t}return a},y.error=function(t){throw"Syntax error, unrecognized expression: "+t};var t,b=y.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")}},relative:{"+":function(t,e){var i=(n="string"==typeof e)&&!/\W/.test(e),n=n&&!i;i&&(e=e.toLowerCase()),i=0;for(var o,s=t.length;i<s;i++)if(o=t[i]){for(;(o=o.previousSibling)&&1!==o.nodeType;);t[i]=n||o&&o.nodeName.toLowerCase()===e?o||!1:o===e}n&&y.filter(e,t,!0)},">":function(t,e){var i="string"==typeof e;if(i&&!/\W/.test(e)){e=e.toLowerCase();for(var n=0,o=t.length;n<o;n++){var s=t[n];s&&(i=s.parentNode,t[n]=i.nodeName.toLowerCase()===e&&i)}}else{for(n=0,o=t.length;n<o;n++)(s=t[n])&&(t[n]=i?s.parentNode:s.parentNode===e);i&&y.filter(e,t,!0)}},"":function(t,e,i){var n,o=m++,s=l;"string"!=typeof e||/\W/.test(e)||(n=e=e.toLowerCase(),s=a),s("parentNode",e,o,t,n,i)},"~":function(t,e,i){var n,o=m++,s=l;"string"!=typeof e||/\W/.test(e)||(n=e=e.toLowerCase(),s=a),s("previousSibling",e,o,t,n,i)}},find:{ID:function(t,e,i){if(void 0!==e.getElementById&&!i)return(t=e.getElementById(t[1]))?[t]:[]},NAME:function(t,e){if(void 0!==e.getElementsByName){for(var i=[],n=0,o=(e=e.getElementsByName(t[1])).length;n<o;n++)e[n].getAttribute("name")===t[1]&&i.push(e[n]);return 0===i.length?null:i}},TAG:function(t,e){return e.getElementsByTagName(t[1])}},preFilter:{CLASS:function(t,e,i,n,o,s){if(t=" "+t[1].replace(/\\/g,"")+" ",s)return t;s=0;for(var r;null!=(r=e[s]);s++)r&&(o^(r.className&&0<=(" "+r.className+" ").replace(/[\t\n]/g," ").indexOf(t))?i||n.push(r):i&&(e[s]=!1));return!1},ID:function(t){return t[1].replace(/\\/g,"")},TAG:function(t){return t[1].toLowerCase()},CHILD:function(t){var e;return"nth"===t[1]&&(e=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(("even"===t[2]?"2n":"odd"===t[2]&&"2n+1")||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]),t[2]=+(e[1]+(e[2]||1)),t[3]=+e[3]),t[0]=m++,t},ATTR:function(t,e,i,n,o,s){return e=t[1].replace(/\\/g,""),!s&&b.attrMap[e]&&(t[1]=b.attrMap[e]),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(t,e,i,n,o){if("not"===t[1]){if(!(1<(p.exec(t[3])||"").length||/^\w/.test(t[3])))return t=y.filter(t[3],e,i,!0^o),i||n.push.apply(n,t),!1;t[3]=y(t[3],null,null,e)}else if(b.match.POS.test(t[0])||b.match.CHILD.test(t[0]))return!0;return t},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,i){return!!y(i[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.type},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||"button"===t.nodeName.toLowerCase()},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,i,n){return e===n.length-1},even:function(t,e){return e%2==0},odd:function(t,e){return e%2==1},lt:function(t,e,i){return e<+i[3]},gt:function(t,e,i){return e>+i[3]},nth:function(t,e,i){return+i[3]===e},eq:function(t,e,i){return+i[3]===e}},filter:{PSEUDO:function(t,e,i,n){var o=e[1],s=b.filters[o];if(s)return s(t,i,e,n);if("contains"===o)return 0<=(t.textContent||t.innerText||r([t])||"").indexOf(e[3]);if("not"===o){for(i=0,n=(e=e[3]).length;i<n;i++)if(e[i]===t)return!1;return!0}y.error("Syntax error, unrecognized expression: "+o)},CHILD:function(t,e){var i=e[1],n=t;switch(i){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"===i)return!0;n=t;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0;case"nth":i=e[2];var o=e[3];if(1===i&&0===o)return!0;e=e[0];var s=t.parentNode;if(s&&(s.sizcache!==e||!t.nodeIndex)){for(var r=0,n=s.firstChild;n;n=n.nextSibling)1===n.nodeType&&(n.nodeIndex=++r);s.sizcache=e}return t=t.nodeIndex-o,0===i?0===t:t%i==0&&0<=t/i}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||t.nodeName.toLowerCase()===e},CLASS:function(t,e){return-1<(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)},ATTR:function(t,e){var i=e[1],i=(t=b.attrHandle[i]?b.attrHandle[i](t):null!=t[i]?t[i]:t.getAttribute(i))+"",n=e[2];return e=e[4],null==t?"!="===n:"="===n?i===e:"*="===n?0<=i.indexOf(e):"~="===n?0<=(" "+i+" ").indexOf(e):e?"!="===n?i!==e:"^="===n?0===i.indexOf(e):"$="===n?i.substr(i.length-e.length)===e:"|="===n&&(i===e||i.substr(0,e.length+1)===e+"-"):i&&!1!==t},POS:function(t,e,i,n){var o=b.setFilters[e[2]];if(o)return o(t,i,e,n)}}},f=b.match.POS;for(t in b.match)b.match[t]=new RegExp(b.match[t].source+/(?![^\[]*\])(?![^\(]*\))/.source),b.leftMatch[t]=new RegExp(/(^(?:.|\r|\n)*?)/.source+b.match[t].source.replace(/\\(\d+)/g,function(t,e){return"\\"+(+e+1)}));var n,e,x=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(w.documentElement.childNodes,0)}catch(t){x=function(t,e){if(e=e||[],"[object Array]"===d.call(t))Array.prototype.push.apply(e,t);else if("number"==typeof t.length)for(var i=0,n=t.length;i<n;i++)e.push(t[i]);else for(i=0;t[i];i++)e.push(t[i]);return e}}w.documentElement.compareDocumentPosition?n=function(t,e){return t.compareDocumentPosition&&e.compareDocumentPosition?(0===(t=4&t.compareDocumentPosition(e)?-1:t===e?0:1)&&(o=!0),t):(t==e&&(o=!0),t.compareDocumentPosition?-1:1)}:"sourceIndex"in w.documentElement?n=function(t,e){return t.sourceIndex&&e.sourceIndex?(0===(t=t.sourceIndex-e.sourceIndex)&&(o=!0),t):(t==e&&(o=!0),t.sourceIndex?-1:1)}:w.createRange&&(n=function(t,e){if(!t.ownerDocument||!e.ownerDocument)return t==e&&(o=!0),t.ownerDocument?-1:1;var i=t.ownerDocument.createRange(),n=e.ownerDocument.createRange();return i.setStart(t,0),i.setEnd(t,0),n.setStart(e,0),n.setEnd(e,0),0===(t=i.compareBoundaryPoints(Range.START_TO_END,n))&&(o=!0),t}),function(){var t=w.createElement("div"),e="script"+(new Date).getTime();t.innerHTML="<a name='"+e+"'/>";var i=w.documentElement;i.insertBefore(t,i.firstChild),w.getElementById(e)&&(b.find.ID=function(t,e,i){if(void 0!==e.getElementById&&!i)return(e=e.getElementById(t[1]))?e.id===t[1]||void 0!==e.getAttributeNode&&e.getAttributeNode("id").nodeValue===t[1]?[e]:C:[]},b.filter.ID=function(t,e){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===e}),i.removeChild(t),i=t=null}(),(e=w.createElement("div")).appendChild(w.createComment("")),0<e.getElementsByTagName("*").length&&(b.find.TAG=function(t,e){if(e=e.getElementsByTagName(t[1]),"*"===t[1]){t=[];for(var i=0;e[i];i++)1===e[i].nodeType&&t.push(e[i]);e=t}return e}),e.innerHTML="<a href='#'></a>",e.firstChild&&void 0!==e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(b.attrHandle.href=function(t){return t.getAttribute("href",2)}),e=null,w.querySelectorAll&&function(){var o=y,t=w.createElement("div");if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){for(var e in y=function(t,e,i,n){if(e=e||w,!n&&9===e.nodeType&&!g(e))try{return x(e.querySelectorAll(t),i)}catch(t){}return o(t,e,i,n)},o)y[e]=o[e];t=null}}(),(e=w.createElement("div")).innerHTML="<div class='test e'></div><div class='test'></div>",e.getElementsByClassName&&0!==e.getElementsByClassName("e").length&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length&&(b.order.splice(1,0,"CLASS"),b.find.CLASS=function(t,e,i){if(void 0!==e.getElementsByClassName&&!i)return e.getElementsByClassName(t[1])},e=null));var v=w.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:function(t,e){return t!==e&&(!t.contains||t.contains(e))},g=function(t){return!!(t=(t?t.ownerDocument||t:0).documentElement)&&"HTML"!==t.nodeName},S=function(t,e){var i,n=[],o="";for(e=e.nodeType?[e]:e;i=b.match.PSEUDO.exec(t);)o+=i[0],t=t.replace(b.match.PSEUDO,"");t=b.relative[t]?t+"*":t,i=0;for(var s=e.length;i<s;i++)y(t,e[i],n);return y.filter(o,n)};M.find=y,M.expr=y.selectors,M.expr[":"]=M.expr.filters,M.unique=y.uniqueSort,M.text=r,M.isXMLDoc=g,M.contains=v}();var nt=/Until$/,ot=/^(?:parents|prevUntil|prevAll)/,st=/,/,L=Array.prototype.slice;function rt(t,e,i){return ct.test(i)?t:e+"></"+i+">"}M.fn.extend({find:function(t){for(var e,i=this.pushStack("","find",t),n=0,o=this.length;n<o;n++)if(e=i.length,M.find(t,this[n],i),0<n)for(var s=e;s<i.length;s++)for(var r=0;r<e;r++)if(i[r]===i[s]){i.splice(s--,1);break}return i},has:function(t){var i=M(t);return this.filter(function(){for(var t=0,e=i.length;t<e;t++)if(M.contains(this,i[t]))return!0})},not:function(t){return this.pushStack(it(this,t,!1),"not",t)},filter:function(t){return this.pushStack(it(this,t,!0),"filter",t)},is:function(t){return!!t&&0<M.filter(t,this).length},closest:function(i,n){if(M.isArray(i)){var t,e,o=[],s=this[0],r={};if(s&&i.length){t=0;for(var a=i.length;t<a;t++)r[e=i[t]]||(r[e]=M.expr.match.POS.test(e)?M(e,n||this.context):e);for(;s&&s.ownerDocument&&s!==n;){for(e in r)((t=r[e]).jquery?-1<t.index(s):M(s).is(t))&&(o.push({selector:e,elem:s}),delete r[e]);s=s.parentNode}}return o}var l=M.expr.match.POS.test(i)?M(i,n||this.context):null;return this.map(function(t,e){for(;e&&e.ownerDocument&&e!==n;){if(l?-1<l.index(e):M(e).is(i))return e;e=e.parentNode}return null})},index:function(t){return t&&"string"!=typeof t?M.inArray(t.jquery?t[0]:t,this):M.inArray(this[0],t?M(t):this.parent().children())},add:function(t,e){return t="string"==typeof t?M(t,e||this.context):M.makeArray(t),e=M.merge(this.get(),t),this.pushStack(s(t[0])||s(e[0])?e:M.unique(e))},andSelf:function(){return this.add(this.prevObject)}}),M.each({parent:function(t){return(t=t.parentNode)&&11!==t.nodeType?t:null},parents:function(t){return M.dir(t,"parentNode")},parentsUntil:function(t,e,i){return M.dir(t,"parentNode",i)},next:function(t){return M.nth(t,2,"nextSibling")},prev:function(t){return M.nth(t,2,"previousSibling")},nextAll:function(t){return M.dir(t,"nextSibling")},prevAll:function(t){return M.dir(t,"previousSibling")},nextUntil:function(t,e,i){return M.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return M.dir(t,"previousSibling",i)},siblings:function(t){return M.sibling(t.parentNode.firstChild,t)},children:function(t){return M.sibling(t.firstChild)},contents:function(t){return M.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:M.makeArray(t.childNodes)}},function(n,o){M.fn[n]=function(t,e){var i=M.map(this,o,t);return nt.test(n)||(e=t),e&&"string"==typeof e&&(i=M.filter(e,i)),i=1<this.length?M.unique(i):i,(1<this.length||st.test(e))&&ot.test(n)&&(i=i.reverse()),this.pushStack(i,n,L.call(arguments).join(","))}}),M.extend({filter:function(t,e,i){return i&&(t=":not("+t+")"),M.find.matches(t,e)},dir:function(t,e,i){var n=[];for(t=t[e];t&&9!==t.nodeType&&(i===C||1!==t.nodeType||!M(t).is(i));)1===t.nodeType&&n.push(t),t=t[e];return n},nth:function(t,e,i){e=e||1;for(var n=0;t&&(1!==t.nodeType||++n!==e);t=t[i]);return t},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var at=/ jQuery\d+="(?:\d+|null)"/g,lt=/^\s+/,mt=/(<([\w:]+)[^>]*?)\/>/g,ct=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,ht=/<([\w:]+)/,ut=/<tbody/i,_t=/<|&#?\w+;/,pt=/<script|<object|<embed|<option|<style/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,yt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};function bt(t,e){return e.toUpperCase()}yt.optgroup=yt.option,yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,M.support.htmlSerialize||(yt._default=[1,"div<div>","</div>"]),M.fn.extend({text:function(i){return M.isFunction(i)?this.each(function(t){var e=M(this);e.text(i.call(this,t,e.text()))}):"object"!=typeof i&&i!==C?this.empty().append((this[0]&&this[0].ownerDocument||w).createTextNode(i)):M.text(this)},wrapAll:function(e){return M.isFunction(e)?this.each(function(t){M(this).wrapAll(e.call(this,t))}):(this[0]&&(t=M(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)),this);var t},wrapInner:function(i){return M.isFunction(i)?this.each(function(t){M(this).wrapInner(i.call(this,t))}):this.each(function(){var t=M(this),e=t.contents();e.length?e.wrapAll(i):t.append(i)})},wrap:function(t){return this.each(function(){M(this).wrapAll(t)})},unwrap:function(){return this.parent().each(function(){M.nodeName(this,"body")||M(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=M(arguments[0]);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,M(arguments[0]).toArray()),t}},remove:function(t,e){for(var i,n=0;null!=(i=this[n]);n++)t&&!M.filter(t,[i]).length||(e||1!==i.nodeType||(M.cleanData(i.getElementsByTagName("*")),M.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&M.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t){var e=this.map(function(){if(M.support.noCloneEvent||M.isXMLDoc(this))return this.cloneNode(!0);var t=this.outerHTML,e=this.ownerDocument;return t||((t=e.createElement("div")).appendChild(this.cloneNode(!0)),t=t.innerHTML),M.clean([t.replace(at,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(lt,"")],e)[0]});return!0===t&&(r(this,e),r(this.find("*"),e.find("*"))),e},html:function(n){if(n===C)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(at,""):null;if("string"!=typeof n||pt.test(n)||!M.support.leadingWhitespace&&lt.test(n)||yt[(ht.exec(n)||["",""])[1].toLowerCase()])M.isFunction(n)?this.each(function(t){var e=M(this),i=e.html();e.empty().append(function(){return n.call(this,t,i)})}):this.empty().append(n);else{n=n.replace(mt,rt);try{for(var t=0,e=this.length;t<e;t++)1===this[t].nodeType&&(M.cleanData(this[t].getElementsByTagName("*")),this[t].innerHTML=n)}catch(t){this.empty().append(n)}}return this},replaceWith:function(n){return this[0]&&this[0].parentNode?M.isFunction(n)?this.each(function(t){var e=M(this),i=e.html();e.replaceWith(n.call(this,t,i))}):("string"!=typeof n&&(n=M(n).detach()),this.each(function(){var t=this.nextSibling,e=this.parentNode;M(this).remove(),t?M(t).before(n):M(e).append(n)})):this.pushStack(M(M.isFunction(n)?n():n),"replaceWith",n)},detach:function(t){return this.remove(t,!0)},domManip:function(i,n,o){var t,e,s,r,a=i[0],l=[];if(!M.support.checkClone&&3===arguments.length&&"string"==typeof a&&dt.test(a))return this.each(function(){M(this).domManip(i,n,o,!0)});if(M.isFunction(a))return this.each(function(t){var e=M(this);i[0]=a.call(this,t,n?e.html():C),e.domManip(i,n,o)});if(this[0]){if(t=a&&a.parentNode,e=1===(s=(t=M.support.parentNode&&t&&11===t.nodeType&&t.childNodes.length===this.length?{fragment:t}:_(i,this,l)).fragment).childNodes.length?s=s.firstChild:s.firstChild){n=n&&M.nodeName(e,"tr");for(var m=0,c=this.length;m<c;m++)o.call(n?(r=this[m],M.nodeName(r,"table")?r.getElementsByTagName("tbody")[0]||r.appendChild(r.ownerDocument.createElement("tbody")):r):this[m],0<m||t.cacheable||1<this.length?s.cloneNode(!0):s)}l.length&&M.each(l,h)}return this}}),M.fragments={},M.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(s,r){M.fn[s]=function(t){var e=[];t=M(t);var i=1===this.length&&this[0].parentNode;if(i&&11===i.nodeType&&1===i.childNodes.length&&1===t.length)return t[r](this[0]),this;i=0;for(var n=t.length;i<n;i++){var o=(0<i?this.clone(!0):this).get();M.fn[r].apply(M(t[i]),o),e=e.concat(o)}return this.pushStack(e,s,t.selector)}}),M.extend({clean:function(t,e,i,n){void 0===(e=e||w).createElement&&(e=e.ownerDocument||e[0]&&e[0].ownerDocument||w);for(var o,s=[],r=0;null!=(o=t[r]);r++)if("number"==typeof o&&(o+=""),o){if("string"!=typeof o||_t.test(o)){if("string"==typeof o){o=o.replace(mt,rt);var a=(ht.exec(o)||["",""])[1].toLowerCase(),l=yt[a]||yt._default,m=l[0],c=e.createElement("div");for(c.innerHTML=l[1]+o+l[2];m--;)c=c.lastChild;if(!M.support.tbody)for(m=ut.test(o),l=(a="table"!==a||m?"<table>"!==l[1]||m?[]:c.childNodes:c.firstChild&&c.firstChild.childNodes).length-1;0<=l;--l)M.nodeName(a[l],"tbody")&&!a[l].childNodes.length&&a[l].parentNode.removeChild(a[l]);!M.support.leadingWhitespace&&lt.test(o)&&c.insertBefore(e.createTextNode(lt.exec(o)[0]),c.firstChild),o=c.childNodes}}else o=e.createTextNode(o);o.nodeType?s.push(o):s=M.merge(s,o)}if(i)for(r=0;s[r];r++)!n||!M.nodeName(s[r],"script")||s[r].type&&"text/javascript"!==s[r].type.toLowerCase()?(1===s[r].nodeType&&s.splice.apply(s,[r+1,0].concat(M.makeArray(s[r].getElementsByTagName("script")))),i.appendChild(s[r])):n.push(s[r].parentNode?s[r].parentNode.removeChild(s[r]):s[r]);return s},cleanData:function(t){for(var e,i,n,o=M.cache,s=M.event.special,r=M.support.deleteExpando,a=0;null!=(n=t[a]);a++)if(i=n[M.expando]){if((e=o[i]).events)for(var l in e.events)s[l]?M.event.remove(n,l):Q(n,l,e.handle);r?delete n[M.expando]:n.removeAttribute&&n.removeAttribute(M.expando),delete o[i]}}});var ft=/z-?index|font-?weight|opacity|zoom|line-?height/i,xt=/alpha\([^)]*\)/,vt=/opacity=([^)]*)/,gt=/float/i,St=/-([a-z])/gi,Ct=/([A-Z])/g,Mt=/^-?\d+(?:px)?$/i,wt=/^-?\d/,At={position:"absolute",visibility:"hidden",display:"block"},Vt=["Left","Right"],It=["Top","Bottom"],Pt=w.defaultView&&w.defaultView.getComputedStyle,Bt=M.support.cssFloat?"cssFloat":"styleFloat";M.fn.css=function(t,e){return l(this,t,e,!0,function(t,e,i){return i===C?M.curCSS(t,e):("number"!=typeof i||ft.test(e)||(i+="px"),void M.style(t,e,i))})},M.extend({style:function(t,e,i){if(!t||3===t.nodeType||8===t.nodeType)return C;("width"===e||"height"===e)&&parseFloat(i)<0&&(i=C);var n=t.style||t,o=i!==C;return M.support.opacity||"opacity"!==e?(gt.test(e)&&(e=Bt),e=e.replace(St,bt),o&&(n[e]=i),n[e]):(o&&(n.zoom=1,e=parseInt(i,10)+""=="NaN"?"":"alpha(opacity="+100*i+")",t=n.filter||M.curCSS(t,"filter")||"",n.filter=xt.test(t)?t.replace(xt,e):e),n.filter&&0<=n.filter.indexOf("opacity=")?parseFloat(vt.exec(n.filter)[1])/100+"":"")},css:function(t,e,i,n){if("width"!==e&&"height"!==e)return M.curCSS(t,e,i);var o,s="width"===e?Vt:It;function r(){o="width"===e?t.offsetWidth:t.offsetHeight,"border"!==n&&M.each(s,function(){n||(o-=parseFloat(M.curCSS(t,"padding"+this,!0))||0),"margin"===n?o+=parseFloat(M.curCSS(t,"margin"+this,!0))||0:o-=parseFloat(M.curCSS(t,"border"+this+"Width",!0))||0})}return 0!==t.offsetWidth?r():M.swap(t,At,r),Math.max(0,Math.round(o))},curCSS:function(t,e,i){var n,o,s=t.style;if(!M.support.opacity&&"opacity"===e&&t.currentStyle)return""===(n=vt.test(t.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"")?"1":n;if(gt.test(e)&&(e=Bt),!i&&s&&s[e])n=s[e];else if(Pt){if(gt.test(e)&&(e="float"),e=e.replace(Ct,"-$1").toLowerCase(),!(s=t.ownerDocument.defaultView))return null;(t=s.getComputedStyle(t,null))&&(n=t.getPropertyValue(e)),"opacity"===e&&""===n&&(n="1")}else t.currentStyle&&(i=e.replace(St,bt),n=t.currentStyle[e]||t.currentStyle[i],!Mt.test(n)&&wt.test(n)&&(e=s.left,o=t.runtimeStyle.left,t.runtimeStyle.left=t.currentStyle.left,s.left="fontSize"===i?"1em":n||0,n=s.pixelLeft+"px",s.left=e,t.runtimeStyle.left=o));return n},swap:function(t,e,i){var n,o={};for(n in e)o[n]=t.style[n],t.style[n]=e[n];for(n in i.call(t),e)t.style[n]=o[n]}}),M.expr&&M.expr.filters&&(M.expr.filters.hidden=function(t){var e=t.offsetWidth,i=t.offsetHeight,n="tr"===t.nodeName.toLowerCase();return 0===e&&0===i&&!n||(!(0<e&&0<i)||n)&&"none"===M.curCSS(t,"display")},M.expr.filters.visible=function(t){return!M.expr.filters.hidden(t)});var Rt=v(),Tt=/<script(.|\s)*?\/script>/gi,Lt=/select|textarea/i,Dt=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,Jt=/=\?(&|$)/,Ft=/\?/,Nt=/(\?|&)_=.*?(&|$)/,Et=/^(\w+:)?\/\/([^\/?#]+)/,jt=/%20/g,kt=M.fn.load;M.fn.extend({load:function(t,e,i){if("string"!=typeof t)return kt.call(this,t);if(!this.length)return this;var n,o=t.indexOf(" ");0<=o&&(n=t.slice(o,t.length),t=t.slice(0,o)),o="GET",e&&(M.isFunction(e)?(i=e,e=null):"object"==typeof e&&(e=M.param(e,M.ajaxSettings.traditional),o="POST"));var s=this;return M.ajax({url:t,type:o,dataType:"html",data:e,complete:function(t,e){"success"!==e&&"notmodified"!==e||s.html(n?M("<div />").append(t.responseText.replace(Tt,"")).find(n):t.responseText),i&&s.each(i,[t.responseText,e,t])}}),this},serialize:function(){return M.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?M.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Lt.test(this.nodeName)||Dt.test(this.type))}).map(function(t,e){return null==(t=M(this).val())?null:M.isArray(t)?M.map(t,function(t){return{name:e.name,value:t}}):{name:e.name,value:t}}).get()}}),M.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){M.fn[e]=function(t){return this.bind(e,t)}}),M.extend({get:function(t,e,i,n){return M.isFunction(e)&&(n=n||i,i=e,e=null),M.ajax({type:"GET",url:t,data:e,success:i,dataType:n})},getScript:function(t,e){return M.get(t,null,e,"script")},getJSON:function(t,e,i){return M.get(t,e,i,"json")},post:function(t,e,i,n){return M.isFunction(e)&&(n=n||i,i=e,e={}),M.ajax({type:"POST",url:t,data:e,success:i,dataType:n})},ajaxSetup:function(t){M.extend(M.ajaxSettings,t)},ajaxSettings:{url:location.href,global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,xhr:!x.XMLHttpRequest||"file:"===x.location.protocol&&x.ActiveXObject?function(){try{return new x.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}:function(){return new x.XMLHttpRequest},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(t){function i(){m.success&&m.success.call(c,r,s,y),m.global&&e("ajaxSuccess",[y,m])}function n(){m.complete&&m.complete.call(c,y,s),m.global&&e("ajaxComplete",[y,m]),m.global&&!--M.active&&M.event.trigger("ajaxStop")}function e(t,e){(m.context?M(m.context):M.event).trigger(t,e)}var o,s,r,a,l,m=M.extend(!0,{},M.ajaxSettings,t),c=t&&t.context||m,h=m.type.toUpperCase();if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=M.param(m.data,m.traditional)),"jsonp"===m.dataType&&("GET"===h?Jt.test(m.url)||(m.url+=(Ft.test(m.url)?"&":"?")+(m.jsonp||"callback")+"=?"):m.data&&Jt.test(m.data)||(m.data=(m.data?m.data+"&":"")+(m.jsonp||"callback")+"=?"),m.dataType="json"),"json"===m.dataType&&(m.data&&Jt.test(m.data)||Jt.test(m.url))&&(o=m.jsonpCallback||"jsonp"+Rt++,m.data&&(m.data=(m.data+"").replace(Jt,"="+o+"$1")),m.url=m.url.replace(Jt,"="+o+"$1"),m.dataType="script",x[o]=x[o]||function(t){r=t,i(),n(),x[o]=C;try{delete x[o]}catch(t){}_&&_.removeChild(p)}),"script"===m.dataType&&null===m.cache&&(m.cache=!1),!1===m.cache&&"GET"===h&&(a=v(),l=m.url.replace(Nt,"$1_="+a+"$2"),m.url=l+(l===m.url?(Ft.test(m.url)?"&":"?")+"_="+a:"")),m.data&&"GET"===h&&(m.url+=(Ft.test(m.url)?"&":"?")+m.data),m.global&&!M.active++&&M.event.trigger("ajaxStart"),a=(a=Et.exec(m.url))&&(a[1]&&a[1]!==location.protocol||a[2]!==location.host),"script"===m.dataType&&"GET"===h&&a){var u,_=w.getElementsByTagName("head")[0]||w.documentElement,p=w.createElement("script");return p.src=m.url,m.scriptCharset&&(p.charset=m.scriptCharset),o||(u=!1,p.onload=p.onreadystatechange=function(){u||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(u=!0,i(),n(),p.onload=p.onreadystatechange=null,_&&p.parentNode&&_.removeChild(p))}),_.insertBefore(p,_.firstChild),C}var d=!1,y=m.xhr();if(y){m.username?y.open(h,m.url,m.async,m.username,m.password):y.open(h,m.url,m.async);try{(m.data||t&&t.contentType)&&y.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(M.lastModified[m.url]&&y.setRequestHeader("If-Modified-Since",M.lastModified[m.url]),M.etag[m.url]&&y.setRequestHeader("If-None-Match",M.etag[m.url])),a||y.setRequestHeader("X-Requested-With","XMLHttpRequest"),y.setRequestHeader("Accept",m.dataType&&m.accepts[m.dataType]?m.accepts[m.dataType]+", */*":m.accepts._default)}catch(t){}if(m.beforeSend&&!1===m.beforeSend.call(c,y,m))return m.global&&!--M.active&&M.event.trigger("ajaxStop"),y.abort(),!1;m.global&&e("ajaxSend",[y,m]);var b=y.onreadystatechange=function(t){if(y&&0!==y.readyState&&"abort"!==t){if(!d&&y&&(4===y.readyState||"timeout"===t)){var e;if(d=!0,y.onreadystatechange=M.noop,"success"===(s="timeout"===t?"timeout":M.httpSuccess(y)?m.ifModified&&M.httpNotModified(y,m.url)?"notmodified":"success":"error"))try{r=M.httpData(y,m.dataType,m)}catch(t){s="parsererror",e=t}"success"===s||"notmodified"===s?o||i():M.handleError(m,y,s,e),n(),"timeout"===t&&y.abort(),m.async&&(y=null)}}else d||n(),d=!0,y&&(y.onreadystatechange=M.noop)};try{var f=y.abort;y.abort=function(){y&&f.call(y),b("abort")}}catch(t){}m.async&&0<m.timeout&&setTimeout(function(){y&&!d&&b("timeout")},m.timeout);try{y.send("POST"===h||"PUT"===h||"DELETE"===h?m.data:null)}catch(t){M.handleError(m,y,null,t),n()}return m.async||b(),y}},handleError:function(t,e,i,n){t.error&&t.error.call(t.context||t,e,i,n),t.global&&(t.context?M(t.context):M.event).trigger("ajaxError",[e,t,n])},active:0,httpSuccess:function(t){try{return!t.status&&"file:"===location.protocol||200<=t.status&&t.status<300||304===t.status||1223===t.status||0===t.status}catch(t){}return!1},httpNotModified:function(t,e){var i=t.getResponseHeader("Last-Modified"),n=t.getResponseHeader("Etag");return i&&(M.lastModified[e]=i),n&&(M.etag[e]=n),304===t.status||0===t.status},httpData:function(t,e,i){var n=t.getResponseHeader("content-type")||"",o="xml"===e||!e&&0<=n.indexOf("xml");return t=o?t.responseXML:t.responseText,o&&"parsererror"===t.documentElement.nodeName&&M.error("parsererror"),i&&i.dataFilter&&(t=i.dataFilter(t,e)),"string"==typeof t&&("json"===e||!e&&0<=n.indexOf("json")?t=M.parseJSON(t):("script"===e||!e&&0<=n.indexOf("javascript"))&&M.globalEval(t)),t},param:function(t,o){function s(t,e){e=M.isFunction(e)?e():e,i[i.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)}var i=[];if(o===C&&(o=M.ajaxSettings.traditional),M.isArray(t)||t.jquery)M.each(t,function(){s(this.name,this.value)});else for(var e in t)!function i(n,t){M.isArray(t)?M.each(t,function(t,e){o||/\[\]$/.test(n)?s(n,e):i(n+"["+("object"==typeof e||M.isArray(e)?t:"")+"]",e)}):o||null==t||"object"!=typeof t?s(n,t):M.each(t,function(t,e){i(n+"["+t+"]",e)})}(e,t[e]);return i.join("&").replace(jt,"+")}});var Ot,zt={},qt=/toggle|show|hide/,Gt=/^([+-]=)?([\d+-.]+)(.*)$/,Ut=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];M.fn.extend({show:function(t,e){if(t||0===t)return this.animate(a("show",3),t,e);for(t=0,e=this.length;t<e;t++){var i,n,o=M.data(this[t],"olddisplay");this[t].style.display=o||"","none"===M.css(this[t],"display")&&(o=this[t].nodeName,zt[o]?n=zt[o]:("none"===(n=(i=M("<"+o+" />").appendTo("body")).css("display"))&&(n="block"),i.remove(),zt[o]=n),M.data(this[t],"olddisplay",n))}for(t=0,e=this.length;t<e;t++)this[t].style.display=M.data(this[t],"olddisplay")||"";return this},hide:function(t,e){if(t||0===t)return this.animate(a("hide",3),t,e);for(t=0,e=this.length;t<e;t++){var i=M.data(this[t],"olddisplay");i||"none"===i||M.data(this[t],"olddisplay",M.css(this[t],"display"))}for(t=0,e=this.length;t<e;t++)this[t].style.display="none";return this},_toggle:M.fn.toggle,toggle:function(e,t){var i="boolean"==typeof e;return M.isFunction(e)&&M.isFunction(t)?this._toggle.apply(this,arguments):null==e||i?this.each(function(){var t=i?e:M(this).is(":hidden");M(this)[t?"show":"hide"]()}):this.animate(a("toggle",3),e,t),this},fadeTo:function(t,e,i){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,i)},animate:function(m,t,e,i){var n=M.speed(t,e,i);return M.isEmptyObject(m)?this.each(n.complete):this[!1===n.queue?"each":"queue"](function(){var t,r=M.extend({},n),a=1===this.nodeType&&M(this).is(":hidden"),l=this;for(t in m){var e=t.replace(St,bt);if(t!==e&&(m[e]=m[t],delete m[t],t=e),"hide"===m[t]&&a||"show"===m[t]&&!a)return r.complete.call(this);"height"!==t&&"width"!==t||!this.style||(r.display=M.css(this,"display"),r.overflow=this.style.overflow),M.isArray(m[t])&&((r.specialEasing=r.specialEasing||{})[t]=m[t][1],m[t]=m[t][0])}return null!=r.overflow&&(this.style.overflow="hidden"),r.curAnim=M.extend({},m),M.each(m,function(t,e){var i,n,o,s=new M.fx(l,r,t);qt.test(e)?s["toggle"===e?a?"show":"hide":e](m):(i=Gt.exec(e),n=s.cur(!0)||0,i?(e=parseFloat(i[2]),"px"!==(o=i[3]||"px")&&(l.style[t]=(e||1)+o,n=(e||1)/s.cur(!0)*n,l.style[t]=n+o),i[1]&&(e=("-="===i[1]?-1:1)*e+n),s.custom(n,e,o)):s.custom(n,e,""))}),!0})},stop:function(t,e){var i=M.timers;return t&&this.queue([]),this.each(function(){for(var t=i.length-1;0<=t;t--)i[t].elem===this&&(e&&i[t](!0),i.splice(t,1))}),e||this.dequeue(),this}}),M.each({slideDown:a("show",1),slideUp:a("hide",1),slideToggle:a("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(t,i){M.fn[t]=function(t,e){return this.animate(i,t,e)}}),M.extend({speed:function(t,e,i){var n=t&&"object"==typeof t?t:{complete:i||!i&&e||M.isFunction(t)&&t,duration:t,easing:i&&e||e&&!M.isFunction(e)&&e};return n.duration=M.fx.off?0:"number"==typeof n.duration?n.duration:M.fx.speeds[n.duration]||M.fx.speeds._default,n.old=n.complete,n.complete=function(){!1!==n.queue&&M(this).dequeue(),M.isFunction(n.old)&&n.old.call(this)},n},easing:{linear:function(t,e,i,n){return i+n*t},swing:function(t,e,i,n){return(-Math.cos(t*Math.PI)/2+.5)*n+i}},timers:[],fx:function(t,e,i){this.options=e,this.elem=t,this.prop=i,e.orig||(e.orig={})}}),M.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(M.fx.step[this.prop]||M.fx.step._default)(this),"height"!==this.prop&&"width"!==this.prop||!this.elem.style||(this.elem.style.display="block")},cur:function(t){return null==this.elem[this.prop]||this.elem.style&&null!=this.elem.style[this.prop]?(t=parseFloat(M.css(this.elem,this.prop,t)))&&-1e4<t?t:parseFloat(M.curCSS(this.elem,this.prop))||0:this.elem[this.prop]},custom:function(t,e,i){function n(t){return o.step(t)}this.startTime=v(),this.start=t,this.end=e,this.unit=i||this.unit||"px",this.now=this.start,this.pos=this.state=0;var o=this;n.elem=this.elem,n()&&M.timers.push(n)&&!Ot&&(Ot=setInterval(M.fx.tick,13))},show:function(){this.options.orig[this.prop]=M.style(this.elem,this.prop),this.options.show=!0,this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),M(this.elem).show()},hide:function(){this.options.orig[this.prop]=M.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e=v(),i=!0;if(t||e>=this.options.duration+this.startTime){for(var n in this.now=this.end,this.pos=this.state=1,this.update(),this.options.curAnim[this.prop]=!0,this.options.curAnim)!0!==this.options.curAnim[n]&&(i=!1);if(i){if(null!=this.options.display&&(this.elem.style.overflow=this.options.overflow,t=M.data(this.elem,"olddisplay"),this.elem.style.display=t||this.options.display,"none"===M.css(this.elem,"display")&&(this.elem.style.display="block")),this.options.hide&&M(this.elem).hide(),this.options.hide||this.options.show)for(var o in this.options.curAnim)M.style(this.elem,o,this.options.orig[o]);this.options.complete.call(this.elem)}return!1}return o=e-this.startTime,this.state=o/this.options.duration,t=this.options.easing||(M.easing.swing?"swing":"linear"),this.pos=M.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||t](this.state,o,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0}},M.extend(M.fx,{tick:function(){for(var t=M.timers,e=0;e<t.length;e++)t[e]()||t.splice(e--,1);t.length||M.fx.stop()},stop:function(){clearInterval(Ot),Ot=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){M.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=("width"===t.prop||"height"===t.prop?Math.max(0,t.now):t.now)+t.unit:t.elem[t.prop]=t.now}}}),M.expr&&M.expr.filters&&(M.expr.filters.animated=function(e){return M.grep(M.timers,function(t){return e===t.elem}).length}),M.fn.offset="getBoundingClientRect"in w.documentElement?function(e){var t=this[0];if(e)return this.each(function(t){M.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return M.offset.bodyOffset(t);var i=t.getBoundingClientRect(),t=(n=t.ownerDocument).body,n=n.documentElement;return{top:i.top+(self.pageYOffset||M.support.boxModel&&n.scrollTop||t.scrollTop)-(n.clientTop||t.clientTop||0),left:i.left+(self.pageXOffset||M.support.boxModel&&n.scrollLeft||t.scrollLeft)-(n.clientLeft||t.clientLeft||0)}}:function(e){var t=this[0];if(e)return this.each(function(t){M.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return M.offset.bodyOffset(t);M.offset.initialize();for(var i,n=t.offsetParent,o=t,s=t.ownerDocument,r=s.documentElement,a=s.body,o=(s=s.defaultView)?s.getComputedStyle(t,null):t.currentStyle,l=t.offsetTop,m=t.offsetLeft;(t=t.parentNode)&&t!==a&&t!==r&&(!M.offset.supportsFixedPosition||"fixed"!==o.position);)i=s?s.getComputedStyle(t,null):t.currentStyle,l-=t.scrollTop,m-=t.scrollLeft,t===n&&(l+=t.offsetTop,m+=t.offsetLeft,!M.offset.doesNotAddBorder||M.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(t.nodeName)||(l+=parseFloat(i.borderTopWidth)||0,m+=parseFloat(i.borderLeftWidth)||0),o=n,n=t.offsetParent),M.offset.subtractsBorderForOverflowNotVisible&&"visible"!==i.overflow&&(l+=parseFloat(i.borderTopWidth)||0,m+=parseFloat(i.borderLeftWidth)||0),o=i;return"relative"!==o.position&&"static"!==o.position||(l+=a.offsetTop,m+=a.offsetLeft),M.offset.supportsFixedPosition&&"fixed"===o.position&&(l+=Math.max(r.scrollTop,a.scrollTop),m+=Math.max(r.scrollLeft,a.scrollLeft)),{top:l,left:m}},M.offset={initialize:function(){var t,e,i,n=w.body,o=w.createElement("div"),s=parseFloat(M.curCSS(n,"marginTop",!0))||0;M.extend(o.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),o.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",n.insertBefore(o,n.firstChild),e=(t=o.firstChild).firstChild,i=t.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===i.offsetTop,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=20===e.offsetTop||15===e.offsetTop,e.style.position=e.style.top="",t.style.overflow="hidden",t.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,this.doesNotIncludeMarginInBodyOffset=n.offsetTop!==s,n.removeChild(o),M.offset.initialize=M.noop},bodyOffset:function(t){var e=t.offsetTop,i=t.offsetLeft;return M.offset.initialize(),M.offset.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(M.curCSS(t,"marginTop",!0))||0,i+=parseFloat(M.curCSS(t,"marginLeft",!0))||0),{top:e,left:i}},setOffset:function(t,e,i){/static/.test(M.curCSS(t,"position"))&&(t.style.position="relative");var n=M(t),o=n.offset(),s=parseInt(M.curCSS(t,"top",!0),10)||0,r=parseInt(M.curCSS(t,"left",!0),10)||0;M.isFunction(e)&&(e=e.call(t,i,o)),i={top:e.top-o.top+s,left:e.left-o.left+r},"using"in e?e.using.call(t,i):n.css(i)}},M.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),i=this.offset(),n=/^body|html$/i.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(M.curCSS(t,"marginTop",!0))||0,i.left-=parseFloat(M.curCSS(t,"marginLeft",!0))||0,n.top+=parseFloat(M.curCSS(e[0],"borderTopWidth",!0))||0,n.left+=parseFloat(M.curCSS(e[0],"borderLeftWidth",!0))||0,{top:i.top-n.top,left:i.left-n.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||w.body;t&&!/^body|html$/i.test(t.nodeName)&&"static"===M.css(t,"position");)t=t.offsetParent;return t})}}),M.each(["Left","Top"],function(n,t){var o="scroll"+t;M.fn[o]=function(t){var e,i=this[0];return i?t!==C?this.each(function(){(e=m(this))?e.scrollTo(n?M(e).scrollLeft():t,n?t:M(e).scrollTop()):this[o]=t}):(e=m(i))?"pageXOffset"in e?e[n?"pageYOffset":"pageXOffset"]:M.support.boxModel&&e.document.documentElement[o]||e.document.body[o]:i[o]:null}}),M.each(["Height","Width"],function(t,e){var n=e.toLowerCase();M.fn["inner"+e]=function(){return this[0]?M.css(this[0],n,!1,"padding"):null},M.fn["outer"+e]=function(t){return this[0]?M.css(this[0],n,!1,t?"margin":"border"):null},M.fn[n]=function(i){var t=this[0];return t?M.isFunction(i)?this.each(function(t){var e=M(this);e[n](i.call(this,t,e[n]()))}):"scrollTo"in t&&t.document?"CSS1Compat"===t.document.compatMode&&t.document.documentElement["client"+e]||t.document.body["client"+e]:9===t.nodeType?Math.max(t.documentElement["client"+e],t.body["scroll"+e],t.documentElement["scroll"+e],t.body["offset"+e],t.documentElement["offset"+e]):i===C?M.css(t,n):this.css(n,"string"==typeof i?i:i+"px"):null==i?null:this}}),x.jQuery=x.$=M}(window);var Class={create:function(){var t,e=null,i=$A(arguments);function n(){this.initialize.apply(this,arguments)}Object.isFunction(i[0])&&(e=i.shift()),Object.extend(n,Class.Methods),n.superclass=e,n.subclasses=[],e&&((t=function(){}).prototype=e.prototype,n.prototype=new t,e.subclasses.push(n));for(var o=0;o<i.length;o++)n.addMethods(i[o]);return n.prototype.initialize||(n.prototype.initialize=this.emptyFunction),n.prototype.constructor=n},emptyFunction:function(){}};function $A(t){if(!t)return[];if(t.toArray)return t.toArray();for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return i}Class.Methods={addMethods:function(t){var e=this.superclass&&this.superclass.prototype,i=Object.keys(t);Object.keys({toString:!0}).length||i.push("toString","valueOf");for(var n=0,o=i.length;n<o;n++){var s,r=i[n],a=t[r];e&&Object.isFunction(a)&&"$super"==a.argumentNames().first()&&(s=a,a=Object.extend(function(t){return function(){return e[t].apply(this,arguments)}}(r).wrap(s),{valueOf:function(){return s},toString:function(){return s.toString()}})),this.prototype[r]=a}return this}},Object.extend=function(t,e){for(var i in e)t[i]=e[i];return t},Object.extend(Object,{inspect:function(t){try{return Object.isUndefined(t)?"undefined":null===t?"null":t.inspect?t.inspect():String(t)}catch(t){if(t instanceof RangeError)return"...";throw t}},toJSON:function(t){switch(typeof t){case"undefined":case"function":case"unknown":return;case"boolean":return t.toString()}if(null===t)return"null";if(t.toJSON)return t.toJSON();if(!Object.isElement(t)){var e,i=[];for(e in t){var n=Object.toJSON(t[e]);Object.isUndefined(n)||i.push(e.toJSON()+": "+n)}return"{"+i.join(", ")+"}"}},toQueryString:function(t){return $H(t).toQueryString()},toHTML:function(t){return t&&t.toHTML?t.toHTML():String.interpret(t)},keys:function(t){var e,i=[];for(e in t)i.push(e);return i},values:function(t){var e,i=[];for(e in t)i.push(t[e]);return i},clone:function(t){return Object.extend({},t)},isElement:function(t){return t&&1==t.nodeType},isArray:function(t){return null!=t&&"object"==typeof t&&"splice"in t&&"join"in t},isHash:function(t){return t instanceof Hash},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isUndefined:function(t){return void 0===t}}),(WebKit=-1<navigator.userAgent.indexOf("AppleWebKit/"))&&($A=function(t){if(!t)return[];if((!Object.isFunction(t)||"[object NodeList]"!=t)&&t.toArray)return t.toArray();for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return i});var b2Settings=Class.create();b2Settings.prototype={initialize:function(){}},b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_massUnitsPerKilogram=1,b2Settings.b2_timeUnitsPerSecond=1,b2Settings.b2_lengthUnitsPerMeter=30,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_maxShapesPerBody=64,b2Settings.b2_maxPolyVertices=8,b2Settings.b2_maxProxies=1024,b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies,b2Settings.b2_linearSlop=.005*b2Settings.b2_lengthUnitsPerMeter,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_velocityThreshold=+b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond,b2Settings.b2_maxLinearCorrection=.2*b2Settings.b2_lengthUnitsPerMeter,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5*b2Settings.b2_timeUnitsPerSecond,b2Settings.b2_linearSleepTolerance=.01*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond,b2Settings.b2_angularSleepTolerance=2/180/b2Settings.b2_timeUnitsPerSecond,b2Settings.b2Assert=function(t){t||(void 0).x++};var b2Vec2=Class.create();b2Vec2.prototype={initialize:function(t,e){this.x=t,this.y=e},SetZero:function(){this.x=0,this.y=0},Set:function(t,e){this.x=t,this.y=e},SetV:function(t){this.x=t.x,this.y=t.y},Negative:function(){return new b2Vec2(-this.x,-this.y)},Copy:function(){return new b2Vec2(this.x,this.y)},Add:function(t){this.x+=t.x,this.y+=t.y},Subtract:function(t){this.x-=t.x,this.y-=t.y},Multiply:function(t){this.x*=t,this.y*=t},MulM:function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},MulTM:function(t){var e=b2Math.b2Dot(this,t.col1);this.y=b2Math.b2Dot(this,t.col2),this.x=e},CrossVF:function(t){var e=this.x;this.x=t*this.y,this.y=-t*e},CrossFV:function(t){var e=this.x;this.x=-t*this.y,this.y=t*e},MinV:function(t){this.x=(this.x<t.x?this:t).x,this.y=(this.y<t.y?this:t).y},MaxV:function(t){this.x=(this.x>t.x?this:t).x,this.y=(this.y>t.y?this:t).y},Abs:function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Normalize:function(){var t=this.Length();if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},IsValid:function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)},x:null,y:null},b2Vec2.Make=function(t,e){return new b2Vec2(t,e)};var b2Mat22=Class.create();b2Mat22.prototype={initialize:function(t,e,i){null==t&&(t=0),this.col1=new b2Vec2,this.col2=new b2Vec2,null!=e&&null!=i?(this.col1.SetV(e),this.col2.SetV(i)):(i=Math.cos(t),t=Math.sin(t),this.col1.x=i,this.col2.x=-t,this.col1.y=t,this.col2.y=i)},Set:function(t){var e=Math.cos(t),t=Math.sin(t);this.col1.x=e,this.col2.x=-t,this.col1.y=t,this.col2.y=e},SetVV:function(t,e){this.col1.SetV(t),this.col2.SetV(e)},Copy:function(){return new b2Mat22(0,this.col1,this.col2)},SetM:function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},AddM:function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},SetIdentity:function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},SetZero:function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},Invert:function(t){var e=this.col1.x,i=this.col2.x,n=this.col1.y,o=this.col2.y,s=1/(s=e*o-i*n);return t.col1.x=s*o,t.col2.x=-s*i,t.col1.y=-s*n,t.col2.y=s*e,t},Solve:function(t,e,i){var n=this.col1.x,o=this.col2.x,s=this.col1.y,r=this.col2.y,a=1/(a=n*r-o*s);return t.x=a*(r*e-o*i),t.y=a*(n*i-s*e),t},Abs:function(){this.col1.Abs(),this.col2.Abs()},col1:new b2Vec2,col2:new b2Vec2};var b2Math=Class.create();b2Math.prototype={initialize:function(){}},b2Math.b2IsValid=function(t){return isFinite(t)},b2Math.b2Dot=function(t,e){return t.x*e.x+t.y*e.y},b2Math.b2CrossVV=function(t,e){return t.x*e.y-t.y*e.x},b2Math.b2CrossVF=function(t,e){return new b2Vec2(e*t.y,-e*t.x)},b2Math.b2CrossFV=function(t,e){return new b2Vec2(-t*e.y,t*e.x)},b2Math.b2MulMV=function(t,e){return new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},b2Math.b2MulTMV=function(t,e){return new b2Vec2(b2Math.b2Dot(e,t.col1),b2Math.b2Dot(e,t.col2))},b2Math.AddVV=function(t,e){return new b2Vec2(t.x+e.x,t.y+e.y)},b2Math.SubtractVV=function(t,e){return new b2Vec2(t.x-e.x,t.y-e.y)},b2Math.MulFV=function(t,e){return new b2Vec2(t*e.x,t*e.y)},b2Math.AddMM=function(t,e){return new b2Mat22(0,b2Math.AddVV(t.col1,e.col1),b2Math.AddVV(t.col2,e.col2))},b2Math.b2MulMM=function(t,e){return new b2Mat22(0,b2Math.b2MulMV(t,e.col1),b2Math.b2MulMV(t,e.col2))},b2Math.b2MulTMM=function(t,e){var i=new b2Vec2(b2Math.b2Dot(t.col1,e.col1),b2Math.b2Dot(t.col2,e.col1)),e=new b2Vec2(b2Math.b2Dot(t.col1,e.col2),b2Math.b2Dot(t.col2,e.col2));return new b2Mat22(0,i,e)},b2Math.b2Abs=function(t){return 0<t?t:-t},b2Math.b2AbsV=function(t){return new b2Vec2(b2Math.b2Abs(t.x),b2Math.b2Abs(t.y))},b2Math.b2AbsM=function(t){return new b2Mat22(0,b2Math.b2AbsV(t.col1),b2Math.b2AbsV(t.col2))},b2Math.b2Min=function(t,e){return t<e?t:e},b2Math.b2MinV=function(t,e){return new b2Vec2(b2Math.b2Min(t.x,e.x),b2Math.b2Min(t.y,e.y))},b2Math.b2Max=function(t,e){return e<t?t:e},b2Math.b2MaxV=function(t,e){return new b2Vec2(b2Math.b2Max(t.x,e.x),b2Math.b2Max(t.y,e.y))},b2Math.b2Clamp=function(t,e,i){return b2Math.b2Max(e,b2Math.b2Min(t,i))},b2Math.b2ClampV=function(t,e,i){return b2Math.b2MaxV(e,b2Math.b2MinV(t,i))},b2Math.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},b2Math.b2Random=function(){return 2*Math.random()-1},b2Math.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1},b2Math.b2IsPowerOfTwo=function(t){return 0<t&&0==(t&t-1)},b2Math.tempVec2=new b2Vec2,b2Math.tempVec3=new b2Vec2,b2Math.tempVec4=new b2Vec2,b2Math.tempVec5=new b2Vec2,b2Math.tempMat=new b2Mat22;var b2AABB=Class.create();b2AABB.prototype={IsValid:function(){var t=this.maxVertex.x,e=this.maxVertex.y,t=this.maxVertex.x,e=this.maxVertex.y;return t-=this.minVertex.x,e-=this.minVertex.y,0<=t&&0<=e&&this.minVertex.IsValid()&&this.maxVertex.IsValid()},minVertex:new b2Vec2,maxVertex:new b2Vec2,initialize:function(){this.minVertex=new b2Vec2,this.maxVertex=new b2Vec2}};var b2Bound=Class.create();b2Bound.prototype={IsLower:function(){return 0==(1&this.value)},IsUpper:function(){return 1==(1&this.value)},Swap:function(t){var e=this.value,i=this.proxyId,n=this.stabbingCount;this.value=t.value,this.proxyId=t.proxyId,this.stabbingCount=t.stabbingCount,t.value=e,t.proxyId=i,t.stabbingCount=n},value:0,proxyId:0,stabbingCount:0,initialize:function(){}};var b2BoundValues=Class.create();b2BoundValues.prototype={lowerValues:[0,0],upperValues:[0,0],initialize:function(){this.lowerValues=[0,0],this.upperValues=[0,0]}};var b2Pair=Class.create();b2Pair.prototype={SetBuffered:function(){this.status|=b2Pair.e_pairBuffered},ClearBuffered:function(){this.status&=~b2Pair.e_pairBuffered},IsBuffered:function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},SetRemoved:function(){this.status|=b2Pair.e_pairRemoved},ClearRemoved:function(){this.status&=~b2Pair.e_pairRemoved},IsRemoved:function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},SetFinal:function(){this.status|=b2Pair.e_pairFinal},IsFinal:function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},userData:null,proxyId1:0,proxyId2:0,next:0,status:0,initialize:function(){}},b2Pair.b2_nullPair=b2Settings.USHRT_MAX,b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs,b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4;var b2PairCallback=Class.create();b2PairCallback.prototype={PairAdded:function(t,e){return null},PairRemoved:function(t,e,i){},initialize:function(){}};var b2BufferedPair=Class.create();b2BufferedPair.prototype={proxyId1:0,proxyId2:0,initialize:function(){}};var b2PairManager=Class.create();b2PairManager.prototype={initialize:function(){var t=0;for(this.m_hashTable=new Array(b2Pair.b2_tableCapacity),t=0;t<b2Pair.b2_tableCapacity;++t)this.m_hashTable[t]=b2Pair.b2_nullPair;for(this.m_pairs=new Array(b2Settings.b2_maxPairs),t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairs[t]=new b2Pair;for(this.m_pairBuffer=new Array(b2Settings.b2_maxPairs),t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairBuffer[t]=new b2BufferedPair;for(t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairs[t].proxyId1=b2Pair.b2_nullProxy,this.m_pairs[t].proxyId2=b2Pair.b2_nullProxy,this.m_pairs[t].userData=null,this.m_pairs[t].status=0,this.m_pairs[t].next=t+1;this.m_pairs[b2Settings.b2_maxPairs-1].next=b2Pair.b2_nullPair,this.m_pairCount=0},Initialize:function(t,e){this.m_broadPhase=t,this.m_callback=e},AddBufferedPair:function(t,e){e=this.AddPair(t,e);0==e.IsBuffered()&&(e.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount].proxyId1=e.proxyId1,this.m_pairBuffer[this.m_pairBufferCount].proxyId2=e.proxyId2,++this.m_pairBufferCount),e.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},RemoveBufferedPair:function(t,e){e=this.Find(t,e);null!=e&&(0==e.IsBuffered()&&(e.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount].proxyId1=e.proxyId1,this.m_pairBuffer[this.m_pairBufferCount].proxyId2=e.proxyId2,++this.m_pairBufferCount),e.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},Commit:function(){for(var t=0,e=0,i=this.m_broadPhase.m_proxyPool,t=0;t<this.m_pairBufferCount;++t){var n=this.Find(this.m_pairBuffer[t].proxyId1,this.m_pairBuffer[t].proxyId2);n.ClearBuffered();var o=i[n.proxyId1],s=i[n.proxyId2];n.IsRemoved()?(1==n.IsFinal()&&this.m_callback.PairRemoved(o.userData,s.userData,n.userData),this.m_pairBuffer[e].proxyId1=n.proxyId1,this.m_pairBuffer[e].proxyId2=n.proxyId2,++e):0==n.IsFinal()&&(n.userData=this.m_callback.PairAdded(o.userData,s.userData),n.SetFinal())}for(t=0;t<e;++t)this.RemovePair(this.m_pairBuffer[t].proxyId1,this.m_pairBuffer[t].proxyId2);this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},AddPair:function(t,e){e<t&&(n=t,t=e,e=n);var i=b2PairManager.Hash(t,e)&b2Pair.b2_tableMask;if(null!=(o=this.FindHash(t,e,i)))return o;var n=this.m_freePair,o=this.m_pairs[n];return this.m_freePair=o.next,o.proxyId1=t,o.proxyId2=e,o.status=0,o.userData=null,o.next=this.m_hashTable[i],this.m_hashTable[i]=n,++this.m_pairCount,o},RemovePair:function(t,e){var i;e<t&&(i=t,t=e,e=i);for(var n=b2PairManager.Hash(t,e)&b2Pair.b2_tableMask,o=this.m_hashTable[n],s=null;o!=b2Pair.b2_nullPair;){if(b2PairManager.Equals(this.m_pairs[o],t,e)){var r=o;s?s.next=this.m_pairs[o].next:this.m_hashTable[n]=this.m_pairs[o].next;var a=this.m_pairs[r],l=a.userData;return a.next=this.m_freePair,a.proxyId1=b2Pair.b2_nullProxy,a.proxyId2=b2Pair.b2_nullProxy,a.userData=null,a.status=0,this.m_freePair=r,--this.m_pairCount,l}o=(s=this.m_pairs[o]).next}return null},Find:function(t,e){e<t&&(i=t,t=e,e=i);var i=b2PairManager.Hash(t,e)&b2Pair.b2_tableMask;return this.FindHash(t,e,i)},FindHash:function(t,e,i){for(var n=this.m_hashTable[i];n!=b2Pair.b2_nullPair&&0==b2PairManager.Equals(this.m_pairs[n],t,e);)n=this.m_pairs[n].next;return n==b2Pair.b2_nullPair?null:this.m_pairs[n]},ValidateBuffer:function(){},ValidateTable:function(){},m_broadPhase:null,m_callback:null,m_pairs:null,m_freePair:0,m_pairCount:0,m_pairBuffer:null,m_pairBufferCount:0,m_hashTable:null},b2PairManager.Hash=function(t,e){t=~(t=e<<16&4294901760|t)+(t<<15&4294934528);return t^=t>>12&1048575,t+=t<<2&4294967292,t^=t>>4&268435455,t*=2057,t^=t>>16&65535},b2PairManager.Equals=function(t,e,i){return t.proxyId1==e&&t.proxyId2==i},b2PairManager.EqualsPair=function(t,e){return t.proxyId1==e.proxyId1&&t.proxyId2==e.proxyId2};var b2BroadPhase=Class.create();b2BroadPhase.prototype={initialize:function(t,e){this.m_pairManager=new b2PairManager,this.m_proxyPool=new Array(b2Settings.b2_maxPairs),this.m_bounds=new Array(2*b2Settings.b2_maxProxies),this.m_queryResults=new Array(b2Settings.b2_maxProxies),this.m_quantizationFactor=new b2Vec2;var i=0;for(this.m_pairManager.Initialize(this,e),this.m_worldAABB=t,i=this.m_proxyCount=0;i<b2Settings.b2_maxProxies;i++)this.m_queryResults[i]=0;for(this.m_bounds=new Array(2),i=0;i<2;i++){this.m_bounds[i]=new Array(2*b2Settings.b2_maxProxies);for(var n=0;n<2*b2Settings.b2_maxProxies;n++)this.m_bounds[i][n]=new b2Bound}var o,s=t.maxVertex.x,e=t.maxVertex.y;for(s-=t.minVertex.x,e-=t.minVertex.y,this.m_quantizationFactor.x=b2Settings.USHRT_MAX/s,this.m_quantizationFactor.y=b2Settings.USHRT_MAX/e,i=0;i<b2Settings.b2_maxProxies-1;++i)o=new b2Proxy,(this.m_proxyPool[i]=o).SetNext(i+1),o.timeStamp=0,o.overlapCount=b2BroadPhase.b2_invalid,o.userData=null;o=new b2Proxy,(this.m_proxyPool[b2Settings.b2_maxProxies-1]=o).SetNext(b2Pair.b2_nullProxy),o.timeStamp=0,o.overlapCount=b2BroadPhase.b2_invalid,o.userData=null,this.m_freeProxy=0,this.m_timeStamp=1,this.m_queryResultCount=0},InRange:function(t){var e,i,n=t.minVertex.x,o=t.minVertex.y;return n-=this.m_worldAABB.maxVertex.x,o-=this.m_worldAABB.maxVertex.y,e=this.m_worldAABB.minVertex.x,i=this.m_worldAABB.minVertex.y,e-=t.maxVertex.x,i-=t.maxVertex.y,n=b2Math.b2Max(n,e),o=b2Math.b2Max(o,i),b2Math.b2Max(n,o)<0},GetProxy:function(t){return t==b2Pair.b2_nullProxy||0==this.m_proxyPool[t].IsValid()?null:this.m_proxyPool[t]},CreateProxy:function(t,e){var i=0,n=this.m_freeProxy,o=this.m_proxyPool[n];this.m_freeProxy=o.GetNext(),o.overlapCount=0,o.userData=e;var s=2*this.m_proxyCount,r=new Array,a=new Array;this.ComputeBounds(r,a,t);for(var l=0;l<2;++l){var m,c=this.m_bounds[l],h=0,u=[0],_=[h];this.Query(u,_,r[l],a[l],c,s,l),m=u[0],h=_[0];for(var p,d,y=new Array,b=0,f=s-h,b=0;b<f;b++)y[b]=new b2Bound,p=y[b],d=c[h+b],p.value=d.value,p.proxyId=d.proxyId,p.stabbingCount=d.stabbingCount;f=y.length;var x=h+2;for(b=0;b<f;b++)d=y[b],(p=c[x+b]).value=d.value,p.proxyId=d.proxyId,p.stabbingCount=d.stabbingCount;for(y=new Array,f=h-m,b=0;b<f;b++)y[b]=new b2Bound,p=y[b],d=c[m+b],p.value=d.value,p.proxyId=d.proxyId,p.stabbingCount=d.stabbingCount;for(f=y.length,x=m+1,b=0;b<f;b++)d=y[b],(p=c[x+b]).value=d.value,p.proxyId=d.proxyId,p.stabbingCount=d.stabbingCount;for(++h,c[m].value=r[l],c[m].proxyId=n,c[h].value=a[l],c[h].proxyId=n,c[m].stabbingCount=0==m?0:c[m-1].stabbingCount,c[h].stabbingCount=c[h-1].stabbingCount,i=m;i<h;++i)c[i].stabbingCount++;for(i=m;i<2+s;++i){var v=this.m_proxyPool[c[i].proxyId];c[i].IsLower()?v.lowerBounds[l]=i:v.upperBounds[l]=i}}++this.m_proxyCount;for(var g=0;g<this.m_queryResultCount;++g)this.m_pairManager.AddBufferedPair(n,this.m_queryResults[g]);return this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),n},DestroyProxy:function(t){for(var e=this.m_proxyPool[t],i=2*this.m_proxyCount,n=0;n<2;++n){for(var o,s,r=this.m_bounds[n],a=e.lowerBounds[n],l=e.upperBounds[n],m=r[a].value,c=r[l].value,h=new Array,u=0,_=l-a-1,u=0;u<_;u++)h[u]=new b2Bound,o=h[u],s=r[a+1+u],o.value=s.value,o.proxyId=s.proxyId,o.stabbingCount=s.stabbingCount;_=h.length;var p=a;for(u=0;u<_;u++)s=h[u],(o=r[p+u]).value=s.value,o.proxyId=s.proxyId,o.stabbingCount=s.stabbingCount;for(h=new Array,_=i-l-1,u=0;u<_;u++)h[u]=new b2Bound,o=h[u],s=r[l+1+u],o.value=s.value,o.proxyId=s.proxyId,o.stabbingCount=s.stabbingCount;for(_=h.length,p=l-1,u=0;u<_;u++)s=h[u],(o=r[p+u]).value=s.value,o.proxyId=s.proxyId,o.stabbingCount=s.stabbingCount;_=i-2;for(var d=a;d<_;++d){var y=this.m_proxyPool[r[d].proxyId];r[d].IsLower()?y.lowerBounds[n]=d:y.upperBounds[n]=d}_=l-1;for(var b=a;b<_;++b)r[b].stabbingCount--;this.Query([0],[0],m,c,r,i-2,n)}for(var f=0;f<this.m_queryResultCount;++f)this.m_pairManager.RemoveBufferedPair(t,this.m_queryResults[f]);this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),e.userData=null,e.overlapCount=b2BroadPhase.b2_invalid,e.lowerBounds[0]=b2BroadPhase.b2_invalid,e.lowerBounds[1]=b2BroadPhase.b2_invalid,e.upperBounds[0]=b2BroadPhase.b2_invalid,e.upperBounds[1]=b2BroadPhase.b2_invalid,e.SetNext(this.m_freeProxy),this.m_freeProxy=t,--this.m_proxyCount},MoveProxy:function(t,e){var i,n,o,s,r=0,a=0,l=0;if(!(t==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=t)&&0!=e.IsValid()){var m=2*this.m_proxyCount,c=this.m_proxyPool[t],h=new b2BoundValues;this.ComputeBounds(h.lowerValues,h.upperValues,e);for(var u=new b2BoundValues,r=0;r<2;++r)u.lowerValues[r]=this.m_bounds[r][c.lowerBounds[r]].value,u.upperValues[r]=this.m_bounds[r][c.upperBounds[r]].value;for(r=0;r<2;++r){var _=this.m_bounds[r],p=c.lowerBounds[r],d=c.upperBounds[r],y=h.lowerValues[r],b=h.upperValues[r],f=y-_[p].value,x=b-_[d].value;if(_[p].value=y,_[d].value=b,f<0)for(a=p;0<a&&y<_[a-1].value;){i=_[a];var v=(n=_[a-1]).proxyId,g=this.m_proxyPool[n.proxyId];n.stabbingCount++,1==n.IsUpper()?(this.TestOverlap(h,g)&&this.m_pairManager.AddBufferedPair(t,v),g.upperBounds[r]++,i.stabbingCount++):(g.lowerBounds[r]++,i.stabbingCount--),c.lowerBounds[r]--,i.Swap(n),--a}if(0<x)for(a=d;a<m-1&&_[a+1].value<=b;)i=_[a],l=(o=_[a+1]).proxyId,s=this.m_proxyPool[l],o.stabbingCount++,1==o.IsLower()?(this.TestOverlap(h,s)&&this.m_pairManager.AddBufferedPair(t,l),s.lowerBounds[r]--,i.stabbingCount++):(s.upperBounds[r]--,i.stabbingCount--),c.upperBounds[r]++,i.Swap(o),a++;if(0<f)for(a=p;a<m-1&&_[a+1].value<=y;)i=_[a],l=(o=_[a+1]).proxyId,s=this.m_proxyPool[l],o.stabbingCount--,o.IsUpper()?(this.TestOverlap(u,s)&&this.m_pairManager.RemoveBufferedPair(t,l),s.upperBounds[r]--,i.stabbingCount--):(s.lowerBounds[r]--,i.stabbingCount++),c.lowerBounds[r]++,i.Swap(o),a++;if(x<0)for(a=d;0<a&&b<_[a-1].value;)i=_[a],v=(n=_[a-1]).proxyId,g=this.m_proxyPool[v],n.stabbingCount--,1==n.IsLower()?(this.TestOverlap(u,g)&&this.m_pairManager.RemoveBufferedPair(t,v),g.lowerBounds[r]++,i.stabbingCount--):(g.upperBounds[r]++,i.stabbingCount++),c.upperBounds[r]--,i.Swap(n),a--}}},Commit:function(){this.m_pairManager.Commit()},QueryAABB:function(t,e,i){var n=new Array,o=new Array;this.ComputeBounds(n,o,t);var s=[0],t=[0];this.Query(s,t,n[0],o[0],this.m_bounds[0],2*this.m_proxyCount,0),this.Query(s,t,n[1],o[1],this.m_bounds[1],2*this.m_proxyCount,1);for(var r=0,a=0;a<this.m_queryResultCount&&r<i;++a,++r){var l=this.m_proxyPool[this.m_queryResults[a]];e[a]=l.userData}return this.m_queryResultCount=0,this.IncrementTimeStamp(),r},Validate:function(){for(var t=0;t<2;++t)for(var e=this.m_bounds[t],i=2*this.m_proxyCount,n=0;n<i;++n)1==e[n].IsLower()?0:0},ComputeBounds:function(t,e,i){var n=i.minVertex.x,o=i.minVertex.y,n=b2Math.b2Min(n,this.m_worldAABB.maxVertex.x),o=b2Math.b2Min(o,this.m_worldAABB.maxVertex.y);n=b2Math.b2Max(n,this.m_worldAABB.minVertex.x),o=b2Math.b2Max(o,this.m_worldAABB.minVertex.y);var s=i.maxVertex.x,i=i.maxVertex.y,s=b2Math.b2Min(s,this.m_worldAABB.maxVertex.x),i=b2Math.b2Min(i,this.m_worldAABB.maxVertex.y);s=b2Math.b2Max(s,this.m_worldAABB.minVertex.x),i=b2Math.b2Max(i,this.m_worldAABB.minVertex.y),t[0]=this.m_quantizationFactor.x*(n-this.m_worldAABB.minVertex.x)&b2Settings.USHRT_MAX-1,e[0]=this.m_quantizationFactor.x*(s-this.m_worldAABB.minVertex.x)&65535|1,t[1]=this.m_quantizationFactor.y*(o-this.m_worldAABB.minVertex.y)&b2Settings.USHRT_MAX-1,e[1]=this.m_quantizationFactor.y*(i-this.m_worldAABB.minVertex.y)&65535|1},TestOverlapValidate:function(t,e){for(var i=0;i<2;++i){var n=this.m_bounds[i];if(n[t.lowerBounds[i]].value>n[e.upperBounds[i]].value)return!1;if(n[t.upperBounds[i]].value<n[e.lowerBounds[i]].value)return!1}return!0},TestOverlap:function(t,e){for(var i=0;i<2;++i){var n=this.m_bounds[i];if(t.lowerValues[i]>n[e.upperBounds[i]].value)return!1;if(t.upperValues[i]<n[e.lowerBounds[i]].value)return!1}return!0},Query:function(t,e,i,n,o,s,r){for(var a=b2BroadPhase.BinarySearch(o,s,i),l=b2BroadPhase.BinarySearch(o,s,n),m=a;m<l;++m)o[m].IsLower()&&this.IncrementOverlapCount(o[m].proxyId);if(0<a)for(var c=a-1,h=o[c].stabbingCount;h;)o[c].IsLower()&&a<=this.m_proxyPool[o[c].proxyId].upperBounds[r]&&(this.IncrementOverlapCount(o[c].proxyId),--h),--c;t[0]=a,e[0]=l},IncrementOverlapCount:function(t){var e=this.m_proxyPool[t];e.timeStamp<this.m_timeStamp?(e.timeStamp=this.m_timeStamp,e.overlapCount=1):(e.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=t,++this.m_queryResultCount)},IncrementTimeStamp:function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var t=0;t<b2Settings.b2_maxProxies;++t)this.m_proxyPool[t].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},m_pairManager:new b2PairManager,m_proxyPool:new Array(b2Settings.b2_maxPairs),m_freeProxy:0,m_bounds:new Array(2*b2Settings.b2_maxProxies),m_queryResults:new Array(b2Settings.b2_maxProxies),m_queryResultCount:0,m_worldAABB:null,m_quantizationFactor:new b2Vec2,m_proxyCount:0,m_timeStamp:0},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.BinarySearch=function(t,e,i){for(var n=0,o=e-1;n<=o;){var s=Math.floor((n+o)/2);if(t[s].value>i)o=s-1;else{if(!(t[s].value<i))return s;n=s+1}}return n};var b2Collision=Class.create();b2Collision.prototype={initialize:function(){}},b2Collision.b2_nullFeature=255,b2Collision.ClipSegmentToLine=function(t,e,i,n){var o=0,s=e[0].v,r=e[1].v,a=b2Math.b2Dot(i,e[0].v)-n,i=b2Math.b2Dot(i,e[1].v)-n;return a<=0&&(t[o++]=e[0]),i<=0&&(t[o++]=e[1]),a*i<0&&(n=a/(a-i),(i=t[o].v).x=s.x+n*(r.x-s.x),i.y=s.y+n*(r.y-s.y),t[o].id=(0<a?e[0]:e[1]).id,++o),o},b2Collision.EdgeSeparation=function(t,e,i){for(var n=t.m_vertices,o=i.m_vertexCount,s=i.m_vertices,r=t.m_normals[e].x,a=t.m_normals[e].y,l=r,m=t.m_R,r=m.col1.x*l+m.col2.x*a,c=a=m.col1.y*l+m.col2.y*a,l=(h=r)*(m=i.m_R).col1.x+c*m.col1.y,c=h*m.col2.x+c*m.col2.y,h=l,u=0,_=Number.MAX_VALUE,p=0;p<o;++p){var d=s[p],d=d.x*h+d.y*c;d<_&&(_=d,u=p)}m=t.m_R;l=t.m_position.x+(m.col1.x*n[e].x+m.col2.x*n[e].y),n=t.m_position.y+(m.col1.y*n[e].x+m.col2.y*n[e].y);m=i.m_R;e=i.m_position.x+(m.col1.x*s[u].x+m.col2.x*s[u].y),m=i.m_position.y+(m.col1.y*s[u].x+m.col2.y*s[u].y);return(e-=l)*r+(m-=n)*a},b2Collision.FindMaxSeparation=function(t,e,i,n){for(var o=e.m_vertexCount,s=i.m_position.x-e.m_position.x,r=i.m_position.y-e.m_position.y,a=s*e.m_R.col1.x+r*e.m_R.col1.y,l=s*e.m_R.col2.x+r*e.m_R.col2.y,m=0,c=-Number.MAX_VALUE,h=0;h<o;++h){var u=e.m_normals[h].x*a+e.m_normals[h].y*l;c<u&&(c=u,m=h)}var _=b2Collision.EdgeSeparation(e,m,i);if(0<_&&0==n)return _;var p=0<=m-1?m-1:o-1,d=b2Collision.EdgeSeparation(e,p,i);if(0<d&&0==n)return d;s=m+1<o?m+1:0,r=b2Collision.EdgeSeparation(e,s,i);if(0<r&&0==n)return r;var y,b=0,f=0;if(_<d&&r<d)f=-1,b=p,y=d;else{if(!(_<r))return t[0]=m,_;f=1,b=s,y=r}for(;;){if(m=-1==f?0<=b-1?b-1:o-1:b+1<o?b+1:0,0<(_=b2Collision.EdgeSeparation(e,m,i))&&0==n)return _;if(!(y<_))break;b=m,y=_}return t[0]=b,y},b2Collision.FindIncidentEdge=function(t,e,i,n){var o=e.m_vertexCount,s=e.m_vertices,r=n.m_vertexCount,a=n.m_vertices,l=(b=s[i+1==o?0:i+1]).x,o=b.y,m=l-=(b=s[i]).x,l=o-=b.y,o=-m,c=1/Math.sqrt(l*l+o*o);l*=c,o*=c;m=l;var e=e.m_R,h=e.col1.x*m+e.col2.x*o,u=e.col1.y*m+e.col2.y*o;m=h*(e=n.m_R).col1.x+u*e.col1.y,u=h*e.col2.x+u*e.col2.y,h=m;for(var _=0,p=0,d=Number.MAX_VALUE,y=0;y<r;++y){var b,f=y,x=y+1<r?y+1:0,v=(b=a[x]).x,g=b.y,m=v-=(b=a[f]).x,v=g-=b.y,g=-m,g=(v*=c=1/Math.sqrt(v*v+g*g))*h+(g*=c)*u;g<d&&(d=g,_=f,p=x)}(b=(e=t[0]).v).SetV(a[_]),b.MulM(n.m_R),b.Add(n.m_position),e.id.features.referenceFace=i,e.id.features.incidentEdge=_,e.id.features.incidentVertex=_,(b=(e=t[1]).v).SetV(a[p]),b.MulM(n.m_R),b.Add(n.m_position),e.id.features.referenceFace=i,e.id.features.incidentEdge=_,e.id.features.incidentVertex=p},b2Collision.b2CollidePolyTempVec=new b2Vec2,b2Collision.b2CollidePoly=function(t,e,i,n){var o=t.pointCount=0,s=[0],r=b2Collision.FindMaxSeparation(s,e,i,n),o=s[0];if(!(0<r&&0==n)){var a=[0],l=b2Collision.FindMaxSeparation(a,i,e,n),m=a[0];if(!(0<l&&0==n)){var s=0,c=0,c=.98*r+.001<l?(d=i,h=e,s=m,1):(d=e,h=i,s=o,0),a=[new ClipVertex,new ClipVertex];b2Collision.FindIncidentEdge(a,d,s,h);var r=d.m_vertexCount,l=d.m_vertices,m=l[s],e=s+1<r?l[s+1]:l[0],i=(e.x,m.x,e.y,m.y,e.x-m.x),o=e.y-m.y,h=i,r=d.m_R,i=r.col1.x*h+r.col2.x*o,o=r.col1.y*h+r.col2.y*o,s=1/Math.sqrt(i*i+o*o),h=u=i*=s,u=_=o*=s,_=-h,l=m.x,s=m.y;h=l,l=(r=d.m_R).col1.x*h+r.col2.x*s,s=r.col1.y*h+r.col2.y*s,l+=d.m_position.x,s+=d.m_position.y;m=e.x,e=e.y;h=m,m=(r=d.m_R).col1.x*h+r.col2.x*e,e=r.col1.y*h+r.col2.y*e;var p=u*l+_*s,s=-(i*l+o*s),m=i*(m+=d.m_position.x)+o*(e+=d.m_position.y),d=[new ClipVertex,new ClipVertex],y=[new ClipVertex,new ClipVertex],e=0;if(b2Collision.b2CollidePolyTempVec.Set(-i,-o),e=b2Collision.ClipSegmentToLine(d,a,b2Collision.b2CollidePolyTempVec,s),!(e<2||(b2Collision.b2CollidePolyTempVec.Set(i,o),(e=b2Collision.ClipSegmentToLine(y,d,b2Collision.b2CollidePolyTempVec,m))<2))){c?t.normal.Set(-u,-_):t.normal.Set(u,_);for(var b=0,f=0;f<b2Settings.b2_maxManifoldPoints;++f){var x=y[f].v,v=u*x.x+_*x.y-p;(v<=0||1==n)&&((x=t.points[b]).separation=v,x.position.SetV(y[f].v),x.id.Set(y[f].id),x.id.features.flip=c,++b)}t.pointCount=b}}}},b2Collision.b2CollideCircle=function(t,e,i,n){t.pointCount=0;var o,s=i.m_position.x-e.m_position.x,r=i.m_position.y-e.m_position.y,a=s*s+r*r,e=e.m_radius+i.m_radius;e*e<a&&0==n||(a<Number.MIN_VALUE?(o=-e,t.normal.Set(0,1)):(o=(a=Math.sqrt(a))-e,a=1/a,t.normal.x=a*s,t.normal.y=a*r),t.pointCount=1,(r=t.points[0]).id.set_key(0),r.separation=o,r.position.x=i.m_position.x-i.m_radius*t.normal.x,r.position.y=i.m_position.y-i.m_radius*t.normal.y)},b2Collision.b2CollidePolyAndCircle=function(t,e,i,n){var o,s;t.pointCount=0;for(var r,a=i.m_position.x-e.m_position.x,l=i.m_position.y-e.m_position.y,m=e.m_R,c=a*m.col1.x+l*m.col1.y,l=a*m.col2.x+l*m.col2.y,a=c,h=0,u=-Number.MAX_VALUE,_=i.m_radius,p=0;p<e.m_vertexCount;++p){var d=e.m_normals[p].x*(a-e.m_vertices[p].x)+e.m_normals[p].y*(l-e.m_vertices[p].y);if(_<d)return;u<d&&(u=d,h=p)}if(u<Number.MIN_VALUE){t.pointCount=1;var y=e.m_normals[h];return t.normal.x=m.col1.x*y.x+m.col2.x*y.y,t.normal.y=m.col1.y*y.x+m.col2.y*y.y,(C=t.points[0]).id.features.incidentEdge=h,C.id.features.incidentVertex=b2Collision.b2_nullFeature,C.id.features.referenceFace=b2Collision.b2_nullFeature,C.id.features.flip=0,C.position.x=i.m_position.x-_*t.normal.x,C.position.y=i.m_position.y-_*t.normal.y,void(C.separation=u-_)}var b=h,f=b+1<e.m_vertexCount?b+1:0,x=e.m_vertices[f].x-e.m_vertices[b].x,v=e.m_vertices[f].y-e.m_vertices[b].y,c=Math.sqrt(x*x+v*v);if(x/=c,v/=c,c<Number.MIN_VALUE)return o=a-e.m_vertices[b].x,s=l-e.m_vertices[b].y,o/=r=Math.sqrt(o*o+s*s),s/=r,_<r?void 0:(t.pointCount=1,t.normal.Set(m.col1.x*o+m.col2.x*s,m.col1.y*o+m.col2.y*s),(C=t.points[0]).id.features.incidentEdge=b2Collision.b2_nullFeature,C.id.features.incidentVertex=b,C.id.features.referenceFace=b2Collision.b2_nullFeature,C.id.features.flip=0,C.position.x=i.m_position.x-_*t.normal.x,C.position.y=i.m_position.y-_*t.normal.y,void(C.separation=r-_));var g,S,C,y=(a-e.m_vertices[b].x)*x+(l-e.m_vertices[b].y)*v;(C=t.points[0]).id.features.incidentEdge=b2Collision.b2_nullFeature,C.id.features.incidentVertex=b2Collision.b2_nullFeature,C.id.features.referenceFace=b2Collision.b2_nullFeature,y<=(C.id.features.flip=0)?(g=e.m_vertices[b].x,S=e.m_vertices[b].y,C.id.features.incidentVertex=b):c<=y?(g=e.m_vertices[f].x,S=e.m_vertices[f].y,C.id.features.incidentVertex=f):(g=x*y+e.m_vertices[b].x,S=v*y+e.m_vertices[b].y,C.id.features.incidentEdge=b),o=a-g,s=l-S,o/=r=Math.sqrt(o*o+s*s),s/=r,_<r||(t.pointCount=1,t.normal.Set(m.col1.x*o+m.col2.x*s,m.col1.y*o+m.col2.y*s),C.position.x=i.m_position.x-_*t.normal.x,C.position.y=i.m_position.y-_*t.normal.y,C.separation=r-_)},b2Collision.b2TestOverlap=function(t,e){var i=e.minVertex,n=t.maxVertex,o=i.x-n.x,s=i.y-n.y,i=t.minVertex,n=e.maxVertex,e=i.x-n.x,n=i.y-n.y;return!(0<o||0<s)&&!(0<e||0<n)};var Features=Class.create();Features.prototype={set_referenceFace:function(t){this._referenceFace=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceFace},get_referenceFace:function(){return this._referenceFace},_referenceFace:0,set_incidentEdge:function(t){this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280},get_incidentEdge:function(){return this._incidentEdge},_incidentEdge:0,set_incidentVertex:function(t){this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680},get_incidentVertex:function(){return this._incidentVertex},_incidentVertex:0,set_flip:function(t){this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080},get_flip:function(){return this._flip},_flip:0,_m_id:null,initialize:function(){}};var b2ContactID=Class.create();b2ContactID.prototype={initialize:function(){this.features=new Features,this.features._m_id=this},Set:function(t){this.set_key(t._key)},Copy:function(){var t=new b2ContactID;return t.set_key(this._key),t},get_key:function(){return this._key},set_key:function(t){this._key=t,this.features._referenceFace=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255},features:new Features,_key:0};var b2ContactPoint=Class.create();b2ContactPoint.prototype={position:new b2Vec2,separation:null,normalImpulse:null,tangentImpulse:null,id:new b2ContactID,initialize:function(){this.position=new b2Vec2,this.id=new b2ContactID}};var b2Distance=Class.create();b2Distance.prototype={initialize:function(){}},b2Distance.ProcessTwo=function(t,e,i,n,o){var s=-o[1].x,r=-o[1].y,a=o[0].x-o[1].x,l=o[0].y-o[1].y,m=Math.sqrt(a*a+l*l),l=s*(a/=m)+r*(l/=m);return l<=0||m<Number.MIN_VALUE?(t.SetV(i[1]),e.SetV(n[1]),i[0].SetV(i[1]),n[0].SetV(n[1]),o[0].SetV(o[1]),1):(l/=m,t.x=i[1].x+l*(i[0].x-i[1].x),t.y=i[1].y+l*(i[0].y-i[1].y),e.x=n[1].x+l*(n[0].x-n[1].x),e.y=n[1].y+l*(n[0].y-n[1].y),2)},b2Distance.ProcessThree=function(t,e,i,n,o){var s=o[0].x,r=o[0].y,a=o[1].x,l=o[1].y,m=o[2].x,c=o[2].y,h=a-s,u=l-r,_=m-s,p=c-r,d=m-a,y=c-l,b=-(s*_+r*p),f=m*_+c*p,x=-(a*d+l*y),y=m*d+c*y;if(f<=0&&y<=0)return t.SetV(i[2]),e.SetV(n[2]),i[0].SetV(i[2]),n[0].SetV(n[2]),o[0].SetV(o[2]),1;u=h*p-u*_,_=u*(s*l-r*a),l=u*(a*c-l*m);if(l<=0&&0<=x&&0<=y){var v=x/(x+y);return t.x=i[1].x+v*(i[2].x-i[1].x),t.y=i[1].y+v*(i[2].y-i[1].y),e.x=n[1].x+v*(n[2].x-n[1].x),e.y=n[1].y+v*(n[2].y-n[1].y),i[0].SetV(i[2]),n[0].SetV(n[2]),o[0].SetV(o[2]),2}s=u*(m*r-c*s);if(s<=0&&0<=b&&0<=f){v=b/(b+f);return t.x=i[0].x+v*(i[2].x-i[0].x),t.y=i[0].y+v*(i[2].y-i[0].y),e.x=n[0].x+v*(n[2].x-n[0].x),e.y=n[0].y+v*(n[2].y-n[0].y),i[1].SetV(i[2]),n[1].SetV(n[2]),o[1].SetV(o[2]),2}_=l+s+_,l*=_=1/_,s*=_,_=1-l-s;return t.x=l*i[0].x+s*i[1].x+_*i[2].x,t.y=l*i[0].y+s*i[1].y+_*i[2].y,e.x=l*n[0].x+s*n[1].x+_*n[2].x,e.y=l*n[0].y+s*n[1].y+_*n[2].y,3},b2Distance.InPoinsts=function(t,e,i){for(var n=0;n<i;++n)if(t.x==e[n].x&&t.y==e[n].y)return!0;return!1},b2Distance.Distance=function(t,e,i,n){var o=new Array(3),s=new Array(3),r=new Array(3),a=0;t.SetV(i.m_position),e.SetV(n.m_position);for(var l=0,m=0;m<20;++m){var c=e.x-t.x,h=e.y-t.y,u=i.Support(c,h),_=n.Support(-c,-h),l=c*c+h*h,p=_.x-u.x,d=_.y-u.y;if(l-b2Dot(c*p+h*d)<=.01*l)return 0==a&&(t.SetV(u),e.SetV(_)),b2Distance.g_GJK_Iterations=m,Math.sqrt(l);switch(a){case 0:o[0].SetV(u),s[0].SetV(_),r[0]=w,t.SetV(o[0]),e.SetV(s[0]),++a;break;case 1:o[1].SetV(u),s[1].SetV(_),r[1].x=p,r[1].y=d,a=b2Distance.ProcessTwo(t,e,o,s,r);break;case 2:o[2].SetV(u),s[2].SetV(_),r[2].x=p,r[2].y=d,a=b2Distance.ProcessThree(t,e,o,s,r)}if(3==a)return b2Distance.g_GJK_Iterations=m,0;for(var y=-Number.MAX_VALUE,b=0;b<a;++b)y=b2Math.b2Max(y,r[b].x*r[b].x+r[b].y*r[b].y);if(3==a||l<=100*Number.MIN_VALUE*y)return b2Distance.g_GJK_Iterations=m,Math.sqrt(l)}return b2Distance.g_GJK_Iterations=20,Math.sqrt(l)},b2Distance.g_GJK_Iterations=0;var b2Manifold=Class.create();b2Manifold.prototype={initialize:function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new b2ContactPoint;this.normal=new b2Vec2},points:null,normal:null,pointCount:0};var b2OBB=Class.create();b2OBB.prototype={R:new b2Mat22,center:new b2Vec2,extents:new b2Vec2,initialize:function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2}};var b2Proxy=Class.create();b2Proxy.prototype={GetNext:function(){return this.lowerBounds[0]},SetNext:function(t){this.lowerBounds[0]=t},IsValid:function(){return this.overlapCount!=b2BroadPhase.b2_invalid},lowerBounds:[0,0],upperBounds:[0,0],overlapCount:0,timeStamp:0,userData:null,initialize:function(){this.lowerBounds=[0,0],this.upperBounds=[0,0]}};var ClipVertex=Class.create();ClipVertex.prototype={v:new b2Vec2,id:new b2ContactID,initialize:function(){this.v=new b2Vec2,this.id=new b2ContactID}};var b2Shape=Class.create();b2Shape.prototype={TestPoint:function(t){return!1},GetUserData:function(){return this.m_userData},GetType:function(){return this.m_type},GetBody:function(){return this.m_body},GetPosition:function(){return this.m_position},GetRotationMatrix:function(){return this.m_R},ResetProxy:function(t){},GetNext:function(){return this.m_next},initialize:function(t,e){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex},DestroyProxy:function(){this.m_proxyId!=b2Pair.b2_nullProxy&&(this.m_body.m_world.m_broadPhase.DestroyProxy(this.m_proxyId),this.m_proxyId=b2Pair.b2_nullProxy)},Synchronize:function(t,e,i,n){},QuickSync:function(t,e){},Support:function(t,e,i){},GetMaxRadius:function(){return this.m_maxRadius},m_next:null,m_R:new b2Mat22,m_position:new b2Vec2,m_type:0,m_userData:null,m_body:null,m_friction:null,m_restitution:null,m_maxRadius:null,m_proxyId:0,m_categoryBits:0,m_maskBits:0,m_groupIndex:0},b2Shape.Create=function(t,e,i){switch(t.type){case b2Shape.e_circleShape:return new b2CircleShape(t,e,i);case b2Shape.e_boxShape:case b2Shape.e_polyShape:return new b2PolyShape(t,e,i)}return null},b2Shape.Destroy=function(t){t.m_proxyId!=b2Pair.b2_nullProxy&&t.m_body.m_world.m_broadPhase.DestroyProxy(t.m_proxyId)},b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_boxShape=1,b2Shape.e_polyShape=2,b2Shape.e_meshShape=3,b2Shape.e_shapeTypeCount=4,b2Shape.PolyMass=function(t,e,i,n){var o=new b2Vec2;o.SetZero();for(var s=0,r=0,a=new b2Vec2(0,0),l=0;l<i;++l){var m=a,c=e[l],h=l+1<i?e[l+1]:e[0],u=b2Math.SubtractVV(c,m),_=b2Math.SubtractVV(h,m),p=b2Math.b2CrossVV(u,_),d=.5*p;s+=d;var y=new b2Vec2;y.SetV(m),y.Add(c),y.Add(h),y.Multiply(1/3*d),o.Add(y);h=m.x,d=m.y,y=u.x,m=u.y,u=_.x,_=_.y;r+=p*(1/3*(.25*(y*y+u*y+u*u)+(h*y+h*u))+.5*h*h+(1/3*(.25*(m*m+_*m+_*_)+(d*m+d*_))+.5*d*d))}t.mass=n*s,o.Multiply(1/s),t.center=o,r=n*(r-s*b2Math.b2Dot(o,o)),t.I=r},b2Shape.PolyCentroid=function(t,e,i){for(var n=0,o=0,s=0,r=0;r<e;++r){var a=t[r].x,l=t[r].y,m=(r+1<e?t[r+1]:t[0]).x,c=(r+1<e?t[r+1]:t[0]).y,h=.5*(+a*+c-+l*+m);s+=h,n+=1/3*h*(0+a+m),o+=1/3*h*(0+l+c)}n*=1/s,o*=1/s,i.Set(n,o)};var b2ShapeDef=Class.create();b2ShapeDef.prototype={initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},ComputeMass:function(t){switch(t.center=new b2Vec2(0,0),0==this.density&&(t.mass=0,t.center.Set(0,0),t.I=0),this.type){case b2Shape.e_circleShape:t.mass=this.density*b2Settings.b2_pi*this.radius*this.radius,t.center.Set(0,0),t.I=.5*t.mass*this.radius*this.radius;break;case b2Shape.e_boxShape:t.mass=4*this.density*this.extents.x*this.extents.y,t.center.Set(0,0),t.I=t.mass/3*b2Math.b2Dot(this.extents,this.extents);break;case b2Shape.e_polyShape:b2Shape.PolyMass(t,this.vertices,this.vertexCount,this.density);break;default:t.mass=0,t.center.Set(0,0),t.I=0}},type:0,userData:null,localPosition:null,localRotation:null,friction:null,restitution:null,density:null,categoryBits:0,maskBits:0,groupIndex:0};var b2BoxDef=Class.create();Object.extend(b2BoxDef.prototype,b2ShapeDef.prototype),Object.extend(b2BoxDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.type=b2Shape.e_boxShape,this.extents=new b2Vec2(1,1)},extents:null});var b2CircleDef=Class.create();Object.extend(b2CircleDef.prototype,b2ShapeDef.prototype),Object.extend(b2CircleDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.type=b2Shape.e_circleShape,this.radius=1},radius:null});var b2CircleShape=Class.create();Object.extend(b2CircleShape.prototype,b2Shape.prototype),Object.extend(b2CircleShape.prototype,{TestPoint:function(t){var e=new b2Vec2;return e.SetV(t),e.Subtract(this.m_position),b2Math.b2Dot(e,e)<=this.m_radius*this.m_radius},initialize:function(t,e,i){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex,this.m_localPosition=new b2Vec2;e=t;this.m_localPosition.Set(t.localPosition.x-i.x,t.localPosition.y-i.y),this.m_type=b2Shape.e_circleShape,this.m_radius=e.radius,this.m_R.SetM(this.m_body.m_R);i=this.m_R.col1.x*this.m_localPosition.x+this.m_R.col2.x*this.m_localPosition.y,e=this.m_R.col1.y*this.m_localPosition.x+this.m_R.col2.y*this.m_localPosition.y;this.m_position.x=this.m_body.m_position.x+i,this.m_position.y=this.m_body.m_position.y+e,this.m_maxRadius=Math.sqrt(i*i+e*e)+this.m_radius;i=new b2AABB;i.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius),i.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);e=this.m_body.m_world.m_broadPhase;e.InRange(i)?this.m_proxyId=e.CreateProxy(i,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()},Synchronize:function(t,e,i,n){var o;this.m_R.SetM(n),this.m_position.x=n.col1.x*this.m_localPosition.x+n.col2.x*this.m_localPosition.y+i.x,this.m_position.y=n.col1.y*this.m_localPosition.x+n.col2.y*this.m_localPosition.y+i.y,this.m_proxyId!=b2Pair.b2_nullProxy&&(o=t.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y),n=t.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y),i=Math.min(o,this.m_position.x),t=Math.min(n,this.m_position.y),e=Math.max(o,this.m_position.x),o=Math.max(n,this.m_position.y),(n=new b2AABB).minVertex.Set(i-this.m_radius,t-this.m_radius),n.maxVertex.Set(e+this.m_radius,o+this.m_radius),(o=this.m_body.m_world.m_broadPhase).InRange(n)?o.MoveProxy(this.m_proxyId,n):this.m_body.Freeze())},QuickSync:function(t,e){this.m_R.SetM(e),this.m_position.x=e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y+t.x,this.m_position.y=e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y+t.y},ResetProxy:function(t){var e;this.m_proxyId!=b2Pair.b2_nullProxy&&(t.GetProxy(this.m_proxyId),t.DestroyProxy(this.m_proxyId),(e=new b2AABB).minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius),e.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius),t.InRange(e)?this.m_proxyId=t.CreateProxy(e,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze())},Support:function(t,e,i){var n=Math.sqrt(t*t+e*e);t/=n,e/=n,i.Set(this.m_position.x+this.m_radius*t,this.m_position.y+this.m_radius*e)},m_localPosition:new b2Vec2,m_radius:null});var b2MassData=Class.create();b2MassData.prototype={mass:0,center:new b2Vec2(0,0),I:0,initialize:function(){this.center=new b2Vec2(0,0)}};var b2PolyDef=Class.create();Object.extend(b2PolyDef.prototype,b2ShapeDef.prototype),Object.extend(b2PolyDef.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.vertices=new Array(b2Settings.b2_maxPolyVertices),this.type=b2Shape.e_polyShape;for(var t=this.vertexCount=0;t<b2Settings.b2_maxPolyVertices;t++)this.vertices[t]=new b2Vec2},vertices:new Array(b2Settings.b2_maxPolyVertices),vertexCount:0});var b2PolyShape=Class.create();Object.extend(b2PolyShape.prototype,b2Shape.prototype),Object.extend(b2PolyShape.prototype,{TestPoint:function(t){var e=new b2Vec2;e.SetV(t),e.Subtract(this.m_position),e.MulTM(this.m_R);for(var i=0;i<this.m_vertexCount;++i){var n=new b2Vec2;if(n.SetV(e),n.Subtract(this.m_vertices[i]),0<b2Math.b2Dot(this.m_normals[i],n))return!1}return!0},initialize:function(t,e,i){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex,this.syncAABB=new b2AABB,this.syncMat=new b2Mat22,this.m_localCentroid=new b2Vec2,this.m_localOBB=new b2OBB;var n,o,s=0,r=new b2AABB;this.m_vertices=new Array(b2Settings.b2_maxPolyVertices),this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices),this.m_normals=new Array(b2Settings.b2_maxPolyVertices),this.m_type=b2Shape.e_polyShape;var a=new b2Mat22(t.localRotation);if(t.type==b2Shape.e_boxShape){this.m_localCentroid.x=t.localPosition.x-i.x,this.m_localCentroid.y=t.localPosition.y-i.y;var l=t;this.m_vertexCount=4,n=l.extents.x,o=l.extents.y;var m=Math.max(0,n-2*b2Settings.b2_linearSlop),e=Math.max(0,o-2*b2Settings.b2_linearSlop);(l=this.m_vertices[0]=new b2Vec2).x=a.col1.x*n+a.col2.x*o,l.y=a.col1.y*n+a.col2.y*o,(l=this.m_vertices[1]=new b2Vec2).x=a.col1.x*-n+a.col2.x*o,l.y=a.col1.y*-n+a.col2.y*o,(l=this.m_vertices[2]=new b2Vec2).x=a.col1.x*-n+a.col2.x*-o,l.y=a.col1.y*-n+a.col2.y*-o,(l=this.m_vertices[3]=new b2Vec2).x=a.col1.x*n+a.col2.x*-o,l.y=a.col1.y*n+a.col2.y*-o,(l=this.m_coreVertices[0]=new b2Vec2).x=a.col1.x*m+a.col2.x*e,l.y=a.col1.y*m+a.col2.y*e,(l=this.m_coreVertices[1]=new b2Vec2).x=a.col1.x*-m+a.col2.x*e,l.y=a.col1.y*-m+a.col2.y*e,(l=this.m_coreVertices[2]=new b2Vec2).x=a.col1.x*-m+a.col2.x*-e,l.y=a.col1.y*-m+a.col2.y*-e,(l=this.m_coreVertices[3]=new b2Vec2).x=a.col1.x*m+a.col2.x*-e,l.y=a.col1.y*m+a.col2.y*-e}else{var c=t;this.m_vertexCount=c.vertexCount,b2Shape.PolyCentroid(c.vertices,c.vertexCount,b2PolyShape.tempVec);var h=b2PolyShape.tempVec.x,u=b2PolyShape.tempVec.y;for(this.m_localCentroid.x=t.localPosition.x+(a.col1.x*h+a.col2.x*u)-i.x,this.m_localCentroid.y=t.localPosition.y+(a.col1.y*h+a.col2.y*u)-i.y,s=0;s<this.m_vertexCount;++s){this.m_vertices[s]=new b2Vec2,this.m_coreVertices[s]=new b2Vec2,n=c.vertices[s].x-h,o=c.vertices[s].y-u,this.m_vertices[s].x=a.col1.x*n+a.col2.x*o,this.m_vertices[s].y=a.col1.y*n+a.col2.y*o;var _=this.m_vertices[s].x,p=this.m_vertices[s].y,d=Math.sqrt(_*_+p*p);d>Number.MIN_VALUE&&(_*=1/d,p*=1/d),this.m_coreVertices[s].x=this.m_vertices[s].x-2*b2Settings.b2_linearSlop*_,this.m_coreVertices[s].y=this.m_vertices[s].y-2*b2Settings.b2_linearSlop*p}}var y=Number.MAX_VALUE,b=Number.MAX_VALUE,f=-Number.MAX_VALUE,x=-Number.MAX_VALUE;for(s=this.m_maxRadius=0;s<this.m_vertexCount;++s){var v=this.m_vertices[s],y=Math.min(y,v.x),b=Math.min(b,v.y),f=Math.max(f,v.x),x=Math.max(x,v.y);this.m_maxRadius=Math.max(this.m_maxRadius,v.Length())}this.m_localOBB.R.SetIdentity(),this.m_localOBB.center.Set(.5*(y+f),.5*(b+x)),this.m_localOBB.extents.Set(.5*(f-y),.5*(x-b));for(var g=0,S=0,s=0;s<this.m_vertexCount;++s)this.m_normals[s]=new b2Vec2,S=(g=s)+1<this.m_vertexCount?s+1:0,this.m_normals[s].x=this.m_vertices[S].y-this.m_vertices[g].y,this.m_normals[s].y=-(this.m_vertices[S].x-this.m_vertices[g].x),this.m_normals[s].Normalize();for(s=0;s<this.m_vertexCount;++s)S=(g=s)+1<this.m_vertexCount?s+1:0;this.m_R.SetM(this.m_body.m_R),this.m_position.x=this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y),b2PolyShape.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y,b2PolyShape.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y,b2PolyShape.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y,b2PolyShape.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y,b2PolyShape.tAbsR.Abs(),n=b2PolyShape.tAbsR.col1.x*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.x*this.m_localOBB.extents.y,o=b2PolyShape.tAbsR.col1.y*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.y*this.m_localOBB.extents.y;t=this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y),i=this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);r.minVertex.x=t-n,r.minVertex.y=i-o,r.maxVertex.x=t+n,r.maxVertex.y=i+o;i=this.m_body.m_world.m_broadPhase;i.InRange(r)?this.m_proxyId=i.CreateProxy(r,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()},syncAABB:new b2AABB,syncMat:new b2Mat22,Synchronize:function(t,e,i,n){var o,s,r,a,l,m,c;this.m_R.SetM(n),this.m_position.x=this.m_body.m_position.x+(n.col1.x*this.m_localCentroid.x+n.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(n.col1.y*this.m_localCentroid.x+n.col2.y*this.m_localCentroid.y),this.m_proxyId!=b2Pair.b2_nullProxy&&(o=e.col1,s=e.col2,r=this.m_localOBB.R.col1,a=this.m_localOBB.R.col2,this.syncMat.col1.x=o.x*r.x+s.x*r.y,this.syncMat.col1.y=o.y*r.x+s.y*r.y,this.syncMat.col2.x=o.x*a.x+s.x*a.y,this.syncMat.col2.y=o.y*a.x+s.y*a.y,this.syncMat.Abs(),m=this.m_localCentroid.x+this.m_localOBB.center.x,c=this.m_localCentroid.y+this.m_localOBB.center.y,l=t.x+(e.col1.x*m+e.col2.x*c),e=t.y+(e.col1.y*m+e.col2.y*c),m=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,c=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=l-m,this.syncAABB.minVertex.y=e-c,this.syncAABB.maxVertex.x=l+m,this.syncAABB.maxVertex.y=e+c,o=n.col1,s=n.col2,r=this.m_localOBB.R.col1,a=this.m_localOBB.R.col2,this.syncMat.col1.x=o.x*r.x+s.x*r.y,this.syncMat.col1.y=o.y*r.x+s.y*r.y,this.syncMat.col2.x=o.x*a.x+s.x*a.y,this.syncMat.col2.y=o.y*a.x+s.y*a.y,this.syncMat.Abs(),m=this.m_localCentroid.x+this.m_localOBB.center.x,c=this.m_localCentroid.y+this.m_localOBB.center.y,l=i.x+(n.col1.x*m+n.col2.x*c),e=i.y+(n.col1.y*m+n.col2.y*c),m=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,c=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,l-m),this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,e-c),this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,l+m),this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,e+c),(c=this.m_body.m_world.m_broadPhase).InRange(this.syncAABB)?c.MoveProxy(this.m_proxyId,this.syncAABB):this.m_body.Freeze())},QuickSync:function(t,e){this.m_R.SetM(e),this.m_position.x=t.x+(e.col1.x*this.m_localCentroid.x+e.col2.x*this.m_localCentroid.y),this.m_position.y=t.y+(e.col1.y*this.m_localCentroid.x+e.col2.y*this.m_localCentroid.y)},ResetProxy:function(t){var e,i,n;this.m_proxyId!=b2Pair.b2_nullProxy&&(t.GetProxy(this.m_proxyId),t.DestroyProxy(this.m_proxyId),i=b2Math.b2MulMM(this.m_R,this.m_localOBB.R),n=b2Math.b2AbsM(i),e=b2Math.b2MulMV(n,this.m_localOBB.extents),(i=b2Math.b2MulMV(this.m_R,this.m_localOBB.center)).Add(this.m_position),(n=new b2AABB).minVertex.SetV(i),n.minVertex.Subtract(e),n.maxVertex.SetV(i),n.maxVertex.Add(e),t.InRange(n)?this.m_proxyId=t.CreateProxy(n,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze())},Support:function(t,e,i){for(var n=t*this.m_R.col1.x+e*this.m_R.col1.y,o=t*this.m_R.col2.x+e*this.m_R.col2.y,s=0,r=this.m_coreVertices[0].x*n+this.m_coreVertices[0].y*o,a=1;a<this.m_vertexCount;++a){var l=this.m_coreVertices[a].x*n+this.m_coreVertices[a].y*o;r<l&&(s=a,r=l)}i.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[s].x+this.m_R.col2.x*this.m_coreVertices[s].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[s].x+this.m_R.col2.y*this.m_coreVertices[s].y))},m_localCentroid:new b2Vec2,m_localOBB:new b2OBB,m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null}),b2PolyShape.tempVec=new b2Vec2,b2PolyShape.tAbsR=new b2Mat22;var b2Body=Class.create();b2Body.prototype={SetOriginPosition:function(t,e){if(!this.IsFrozen()){this.m_rotation=e,this.m_R.Set(this.m_rotation),this.m_position=b2Math.AddVV(t,b2Math.b2MulMV(this.m_R,this.m_center)),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation;for(var i=this.m_shapeList;null!=i;i=i.m_next)i.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);this.m_world.m_broadPhase.Commit()}},GetOriginPosition:function(){return b2Math.SubtractVV(this.m_position,b2Math.b2MulMV(this.m_R,this.m_center))},SetCenterPosition:function(t,e){if(!this.IsFrozen()){this.m_rotation=e,this.m_R.Set(this.m_rotation),this.m_position.SetV(t),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation;for(var i=this.m_shapeList;null!=i;i=i.m_next)i.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);this.m_world.m_broadPhase.Commit()}},GetCenterPosition:function(){return this.m_position},GetRotation:function(){return this.m_rotation},GetRotationMatrix:function(){return this.m_R},SetLinearVelocity:function(t){this.m_linearVelocity.SetV(t)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(t){this.m_angularVelocity=t},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(t,e){0==this.IsSleeping()&&(this.m_force.Add(t),this.m_torque+=b2Math.b2CrossVV(b2Math.SubtractVV(e,this.m_position),t))},ApplyTorque:function(t){0==this.IsSleeping()&&(this.m_torque+=t)},ApplyImpulse:function(t,e){0==this.IsSleeping()&&(this.m_linearVelocity.Add(b2Math.MulFV(this.m_invMass,t)),this.m_angularVelocity+=this.m_invI*b2Math.b2CrossVV(b2Math.SubtractVV(e,this.m_position),t))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I},GetWorldPoint:function(t){return b2Math.AddVV(this.m_position,b2Math.b2MulMV(this.m_R,t))},GetWorldVector:function(t){return b2Math.b2MulMV(this.m_R,t)},GetLocalPoint:function(t){return b2Math.b2MulTMV(this.m_R,b2Math.SubtractVV(t,this.m_position))},GetLocalVector:function(t){return b2Math.b2MulTMV(this.m_R,t)},IsStatic:function(){return(this.m_flags&b2Body.e_staticFlag)==b2Body.e_staticFlag},IsFrozen:function(){return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag},IsSleeping:function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag},AllowSleeping:function(t){t?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.WakeUp())},WakeUp:function(){this.m_flags&=~b2Body.e_sleepFlag,this.m_sleepTime=0},GetShapeList:function(){return this.m_shapeList},GetContactList:function(){return this.m_contactList},GetJointList:function(){return this.m_jointList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(t,e){this.sMat0=new b2Mat22,this.m_position=new b2Vec2,this.m_R=new b2Mat22(0),this.m_position0=new b2Vec2;var i,n,o=0;this.m_flags=0,this.m_position.SetV(t.position),this.m_rotation=t.rotation,this.m_R.Set(this.m_rotation),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation,this.m_world=e,this.m_linearDamping=b2Math.b2Clamp(1-t.linearDamping,0,1),this.m_angularDamping=b2Math.b2Clamp(1-t.angularDamping,0,1),this.m_force=new b2Vec2(0,0),this.m_torque=0,this.m_mass=0;for(var s=new Array(b2Settings.b2_maxShapesPerBody),o=0;o<b2Settings.b2_maxShapesPerBody;o++)s[o]=new b2MassData;for(this.m_shapeCount=0,this.m_center=new b2Vec2(0,0),o=0;o<b2Settings.b2_maxShapesPerBody&&null!=(i=t.shapes[o]);++o)n=s[o],i.ComputeMass(n),this.m_mass+=n.mass,this.m_center.x+=n.mass*(i.localPosition.x+n.center.x),this.m_center.y+=n.mass*(i.localPosition.y+n.center.y),++this.m_shapeCount;for(0<this.m_mass?(this.m_center.Multiply(1/this.m_mass),this.m_position.Add(b2Math.b2MulMV(this.m_R,this.m_center))):this.m_flags|=b2Body.e_staticFlag,o=this.m_I=0;o<this.m_shapeCount;++o){i=t.shapes[o],n=s[o],this.m_I+=n.I;var r=b2Math.SubtractVV(b2Math.AddVV(i.localPosition,n.center),this.m_center);this.m_I+=n.mass*b2Math.b2Dot(r,r)}for(0<this.m_mass?this.m_invMass=1/this.m_mass:this.m_invMass=0,0<this.m_I&&0==t.preventRotation?this.m_invI=1/this.m_I:(this.m_I=0,this.m_invI=0),this.m_linearVelocity=b2Math.AddVV(t.linearVelocity,b2Math.b2CrossFV(t.angularVelocity,this.m_center)),this.m_angularVelocity=t.angularVelocity,this.m_jointList=null,this.m_contactList=null,this.m_prev=null,this.m_next=null,this.m_shapeList=null,o=0;o<this.m_shapeCount;++o){i=t.shapes[o];var a=b2Shape.Create(i,this,this.m_center);a.m_next=this.m_shapeList,this.m_shapeList=a}this.m_sleepTime=0,t.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),t.isSleeping&&(this.m_flags|=b2Body.e_sleepFlag),(this.m_flags&b2Body.e_sleepFlag||0==this.m_invMass)&&(this.m_linearVelocity.Set(0,0),this.m_angularVelocity=0),this.m_userData=t.userData},Destroy:function(){for(var t=this.m_shapeList;t;){var e=t,t=t.m_next;b2Shape.Destroy(e)}},sMat0:new b2Mat22,SynchronizeShapes:function(){this.sMat0.Set(this.m_rotation0);for(var t=this.m_shapeList;null!=t;t=t.m_next)t.Synchronize(this.m_position0,this.sMat0,this.m_position,this.m_R)},QuickSyncShapes:function(){for(var t=this.m_shapeList;null!=t;t=t.m_next)t.QuickSync(this.m_position,this.m_R)},IsConnected:function(t){for(var e=this.m_jointList;null!=e;e=e.next)if(e.other==t)return 0==e.joint.m_collideConnected;return!1},Freeze:function(){this.m_flags|=b2Body.e_frozenFlag,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;for(var t=this.m_shapeList;null!=t;t=t.m_next)t.DestroyProxy()},m_flags:0,m_position:new b2Vec2,m_rotation:null,m_R:new b2Mat22(0),m_position0:new b2Vec2,m_rotation0:null,m_linearVelocity:null,m_angularVelocity:null,m_force:null,m_torque:null,m_center:null,m_world:null,m_prev:null,m_next:null,m_shapeList:null,m_shapeCount:0,m_jointList:null,m_contactList:null,m_mass:null,m_invMass:null,m_I:null,m_invI:null,m_linearDamping:null,m_angularDamping:null,m_sleepTime:null,m_userData:null},b2Body.e_staticFlag=1,b2Body.e_frozenFlag=2,b2Body.e_islandFlag=4,b2Body.e_sleepFlag=8,b2Body.e_allowSleepFlag=16,b2Body.e_destroyFlag=32;var b2BodyDef=Class.create();b2BodyDef.prototype={initialize:function(){this.shapes=new Array,this.userData=null;for(var t=0;t<b2Settings.b2_maxShapesPerBody;t++)this.shapes[t]=null;this.position=new b2Vec2(0,0),this.rotation=0,this.linearVelocity=new b2Vec2(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.isSleeping=!1,this.preventRotation=!1},userData:null,shapes:new Array,position:null,rotation:null,linearVelocity:null,angularVelocity:null,linearDamping:null,angularDamping:null,allowSleep:null,isSleeping:null,preventRotation:null,AddShape:function(t){for(var e=0;e<b2Settings.b2_maxShapesPerBody;++e)if(null==this.shapes[e]){this.shapes[e]=t;break}}};var b2CollisionFilter=Class.create();b2CollisionFilter.prototype={ShouldCollide:function(t,e){return t.m_groupIndex==e.m_groupIndex&&0!=t.m_groupIndex?0<t.m_groupIndex:0!=(t.m_maskBits&e.m_categoryBits)&&0!=(t.m_categoryBits&e.m_maskBits)},initialize:function(){}},b2CollisionFilter.b2_defaultFilter=new b2CollisionFilter;var b2Island=Class.create();b2Island.prototype={initialize:function(t,e,i,n){var o=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodies=new Array(t),o=0;o<t;o++)this.m_bodies[o]=null;for(this.m_contacts=new Array(e),o=0;o<e;o++)this.m_contacts[o]=null;for(this.m_joints=new Array(i),o=0;o<i;o++)this.m_joints[o]=null;this.m_allocator=n},Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Solve:function(t,e){var i,n=0;for(n=0;n<this.m_bodyCount;++n)0!=(i=this.m_bodies[n]).m_invMass&&(i.m_linearVelocity.Add(b2Math.MulFV(t.dt,b2Math.AddVV(e,b2Math.MulFV(i.m_invMass,i.m_force)))),i.m_angularVelocity+=t.dt*i.m_invI*i.m_torque,i.m_linearVelocity.Multiply(i.m_linearDamping),i.m_angularVelocity*=i.m_angularDamping,i.m_position0.SetV(i.m_position),i.m_rotation0=i.m_rotation);var o=new b2ContactSolver(this.m_contacts,this.m_contactCount,this.m_allocator);for(o.PreSolve(),n=0;n<this.m_jointCount;++n)this.m_joints[n].PrepareVelocitySolver();for(n=0;n<t.iterations;++n){o.SolveVelocityConstraints();for(var s=0;s<this.m_jointCount;++s)this.m_joints[s].SolveVelocityConstraints(t)}for(n=0;n<this.m_bodyCount;++n)0!=(i=this.m_bodies[n]).m_invMass&&(i.m_position.x+=t.dt*i.m_linearVelocity.x,i.m_position.y+=t.dt*i.m_linearVelocity.y,i.m_rotation+=t.dt*i.m_angularVelocity,i.m_R.Set(i.m_rotation));for(n=0;n<this.m_jointCount;++n)this.m_joints[n].PreparePositionSolver();if(b2World.s_enablePositionCorrection)for(b2Island.m_positionIterationCount=0;b2Island.m_positionIterationCount<t.iterations;++b2Island.m_positionIterationCount){for(var r=o.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),a=!0,n=0;n<this.m_jointCount;++n)var l=this.m_joints[n].SolvePositionConstraints(),a=a&&l;if(r&&a)break}for(o.PostSolve(),n=0;n<this.m_bodyCount;++n)0!=(i=this.m_bodies[n]).m_invMass&&(i.m_R.Set(i.m_rotation),i.SynchronizeShapes(),i.m_force.Set(0,0),i.m_torque=0)},UpdateSleep:function(t){for(var e,i=0,n=Number.MAX_VALUE,o=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,s=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance,i=0;i<this.m_bodyCount;++i)0!=(e=this.m_bodies[i]).m_invMass&&(0==(e.m_flags&b2Body.e_allowSleepFlag)&&(n=e.m_sleepTime=0),n=0==(e.m_flags&b2Body.e_allowSleepFlag)||e.m_angularVelocity*e.m_angularVelocity>s||b2Math.b2Dot(e.m_linearVelocity,e.m_linearVelocity)>o?e.m_sleepTime=0:(e.m_sleepTime+=t,b2Math.b2Min(n,e.m_sleepTime)));if(n>=b2Settings.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)(e=this.m_bodies[i]).m_flags|=b2Body.e_sleepFlag},AddBody:function(t){this.m_bodies[this.m_bodyCount++]=t},AddContact:function(t){this.m_contacts[this.m_contactCount++]=t},AddJoint:function(t){this.m_joints[this.m_jointCount++]=t},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null},b2Island.m_positionIterationCount=0;var b2TimeStep=Class.create();b2TimeStep.prototype={dt:null,inv_dt:null,iterations:0,initialize:function(){}};var b2ContactNode=Class.create();b2ContactNode.prototype={other:null,contact:null,prev:null,next:null,initialize:function(){}};var b2Contact=Class.create();b2Contact.prototype={GetManifolds:function(){return null},GetManifoldCount:function(){return this.m_manifoldCount},GetNext:function(){return this.m_next},GetShape1:function(){return this.m_shape1},GetShape2:function(){return this.m_shape2},initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null},Evaluate:function(){},m_flags:0,m_prev:null,m_next:null,m_node1:new b2ContactNode,m_node2:new b2ContactNode,m_shape1:null,m_shape2:null,m_manifoldCount:0,m_friction:null,m_restitution:null},b2Contact.e_islandFlag=1,b2Contact.e_destroyFlag=2,b2Contact.AddType=function(t,e,i,n){b2Contact.s_registers[i][n].createFcn=t,b2Contact.s_registers[i][n].destroyFcn=e,b2Contact.s_registers[i][n].primary=!0,i!=n&&(b2Contact.s_registers[n][i].createFcn=t,b2Contact.s_registers[n][i].destroyFcn=e,b2Contact.s_registers[n][i].primary=!1)},b2Contact.InitializeRegisters=function(){b2Contact.s_registers=new Array(b2Shape.e_shapeTypeCount);for(var t=0;t<b2Shape.e_shapeTypeCount;t++){b2Contact.s_registers[t]=new Array(b2Shape.e_shapeTypeCount);for(var e=0;e<b2Shape.e_shapeTypeCount;e++)b2Contact.s_registers[t][e]=new b2ContactRegister}b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polyShape,b2Shape.e_circleShape),b2Contact.AddType(b2PolyContact.Create,b2PolyContact.Destroy,b2Shape.e_polyShape,b2Shape.e_polyShape)},b2Contact.Create=function(t,e,i){0==b2Contact.s_initialized&&(b2Contact.InitializeRegisters(),b2Contact.s_initialized=!0);var n=t.m_type,o=e.m_type,s=b2Contact.s_registers[n][o].createFcn;if(s){if(b2Contact.s_registers[n][o].primary)return s(t,e,i);for(var r=s(e,t,i),a=0;a<r.GetManifoldCount();++a){var l=r.GetManifolds()[a];l.normal=l.normal.Negative()}return r}return null},b2Contact.Destroy=function(t,e){0<t.GetManifoldCount()&&(t.m_shape1.m_body.WakeUp(),t.m_shape2.m_body.WakeUp());var i=t.m_shape1.m_type,n=t.m_shape2.m_type;(0,b2Contact.s_registers[i][n].destroyFcn)(t,e)},b2Contact.s_registers=null,b2Contact.s_initialized=!1;var b2ContactConstraint=Class.create();b2ContactConstraint.prototype={initialize:function(){this.normal=new b2Vec2,this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new b2ContactConstraintPoint},points:null,normal:new b2Vec2,manifold:null,body1:null,body2:null,friction:null,restitution:null,pointCount:0};var b2ContactConstraintPoint=Class.create();b2ContactConstraintPoint.prototype={localAnchor1:new b2Vec2,localAnchor2:new b2Vec2,normalImpulse:null,tangentImpulse:null,positionImpulse:null,normalMass:null,tangentMass:null,separation:null,velocityBias:null,initialize:function(){this.localAnchor1=new b2Vec2,this.localAnchor2=new b2Vec2}};var b2ContactRegister=Class.create();b2ContactRegister.prototype={createFcn:null,destroyFcn:null,primary:null,initialize:function(){}};var b2ContactSolver=Class.create();b2ContactSolver.prototype={initialize:function(t,e,i){this.m_constraints=new Array,this.m_allocator=i;var n=0;for(n=this.m_constraintCount=0;n<e;++n)this.m_constraintCount+=t[n].GetManifoldCount();for(n=0;n<this.m_constraintCount;n++)this.m_constraints[n]=new b2ContactConstraint;for(var o=0,n=0;n<e;++n)for(var s=t[n],r=s.m_shape1.m_body,a=s.m_shape2.m_body,l=s.GetManifoldCount(),m=s.GetManifolds(),c=s.m_friction,h=s.m_restitution,u=r.m_linearVelocity.x,_=r.m_linearVelocity.y,p=a.m_linearVelocity.x,d=a.m_linearVelocity.y,y=r.m_angularVelocity,b=a.m_angularVelocity,f=0;f<l;++f){var x=m[f],v=x.normal.x,g=x.normal.y,S=this.m_constraints[o];S.body1=r,S.body2=a,S.manifold=x,S.normal.x=v,S.normal.y=g,S.pointCount=x.pointCount,S.friction=c,S.restitution=h;for(var C=0;C<S.pointCount;++C){var M=x.points[C],w=S.points[C];w.normalImpulse=M.normalImpulse,w.tangentImpulse=M.tangentImpulse,w.separation=M.separation;var A=M.position.x-r.m_position.x,V=M.position.y-r.m_position.y,I=M.position.x-a.m_position.x,P=M.position.y-a.m_position.y,B=w.localAnchor1,R=r.m_R;B.x=A*R.col1.x+V*R.col1.y,B.y=A*R.col2.x+V*R.col2.y,B=w.localAnchor2,R=a.m_R,B.x=I*R.col1.x+P*R.col1.y,B.y=I*R.col2.x+P*R.col2.y;var T=A*A+V*V,L=I*I+P*P,M=A*v+V*g,B=I*v+P*g,R=r.m_invMass+a.m_invMass;R+=r.m_invI*(T-M*M)+a.m_invI*(L-B*B),w.normalMass=1/R;M=-v,B=A*g+V*M,R=I*g+P*M,M=r.m_invMass+a.m_invMass;M+=r.m_invI*(T-B*B)+a.m_invI*(L-R*R),w.tangentMass=1/M,(w.velocityBias=0)<w.separation&&(w.velocityBias=-60*w.separation);V=p+-b*P-u- -y*V,A=d+b*I-_-y*A,A=S.normal.x*V+S.normal.y*A;A<-b2Settings.b2_velocityThreshold&&(w.velocityBias+=-S.restitution*A)}++o}},PreSolve:function(){for(var t=0;t<this.m_constraintCount;++t){var e=this.m_constraints[t],i=e.body1,n=e.body2,o=i.m_invMass,s=i.m_invI,r=n.m_invMass,a=n.m_invI,l=e.normal.x,m=e.normal.y,c=m,h=-l,u=0,_=0;if(b2World.s_enableWarmStarting)for(_=e.pointCount,u=0;u<_;++u){var p=e.points[u],d=p.normalImpulse*l+p.tangentImpulse*c,y=p.normalImpulse*m+p.tangentImpulse*h,b=i.m_R,f=p.localAnchor1,x=b.col1.x*f.x+b.col2.x*f.y,v=b.col1.y*f.x+b.col2.y*f.y;b=n.m_R,f=p.localAnchor2;var g=b.col1.x*f.x+b.col2.x*f.y,f=b.col1.y*f.x+b.col2.y*f.y;i.m_angularVelocity-=s*(x*y-v*d),i.m_linearVelocity.x-=o*d,i.m_linearVelocity.y-=o*y,n.m_angularVelocity+=a*(g*y-f*d),n.m_linearVelocity.x+=r*d,n.m_linearVelocity.y+=r*y,p.positionImpulse=0}else for(_=e.pointCount,u=0;u<_;++u){var S=e.points[u];S.normalImpulse=0,S.tangentImpulse=0,S.positionImpulse=0}}},SolveVelocityConstraints:function(){for(var t,e,i,n,o,s=0,r=0;r<this.m_constraintCount;++r){for(var a=this.m_constraints[r],l=a.body1,m=a.body2,c=l.m_angularVelocity,h=l.m_linearVelocity,u=m.m_angularVelocity,_=m.m_linearVelocity,p=l.m_invMass,d=l.m_invI,y=m.m_invMass,b=m.m_invI,f=a.normal.x,x=a.normal.y,v=x,g=-f,S=a.pointCount,s=0;s<S;++s){t=a.points[s],A=l.m_R,V=t.localAnchor1,e=A.col1.x*V.x+A.col2.x*V.y,i=A.col1.y*V.x+A.col2.y*V.y,A=m.m_R,V=t.localAnchor2,n=A.col1.x*V.x+A.col2.x*V.y,o=A.col1.y*V.x+A.col2.y*V.y;var C,M=(_.x+-u*o-h.x- -c*i)*f+(_.y+u*n-h.y-c*e)*x,w=-t.normalMass*(M-t.velocityBias),A=(w=(C=b2Math.b2Max(t.normalImpulse+w,0))-t.normalImpulse)*f,V=w*x;h.x-=p*A,h.y-=p*V,c-=d*(e*V-i*A),_.x+=y*A,_.y+=y*V,u+=b*(n*V-o*A),t.normalImpulse=C;M=(_.x+-u*o-h.x- -c*i)*v+(_.y+u*n-h.y-c*e)*g;w=t.tangentMass*-M;M=a.friction*t.normalImpulse;A=(w=(C=b2Math.b2Clamp(t.tangentImpulse+w,-M,M))-t.tangentImpulse)*v,V=w*g,h.x-=p*A,h.y-=p*V,c-=d*(e*V-i*A),_.x+=y*A,_.y+=y*V,u+=b*(n*V-o*A),t.tangentImpulse=C}l.m_angularVelocity=c,m.m_angularVelocity=u}},SolvePositionConstraints:function(t){for(var e=0,i=0;i<this.m_constraintCount;++i){for(var n=this.m_constraints[i],o=n.body1,s=n.body2,r=o.m_position,a=o.m_rotation,l=s.m_position,m=s.m_rotation,c=o.m_invMass,h=o.m_invI,u=s.m_invMass,_=s.m_invI,p=n.normal.x,d=n.normal.y,y=n.pointCount,b=0;b<y;++b){var f=n.points[b],x=o.m_R,v=f.localAnchor1,g=x.col1.x*v.x+x.col2.x*v.y,S=x.col1.y*v.x+x.col2.y*v.y;x=s.m_R,v=f.localAnchor2;var C=x.col1.x*v.x+x.col2.x*v.y,M=x.col1.y*v.x+x.col2.y*v.y,x=r.x+g,v=r.y+S,x=(l.x+C-x)*p+(l.y+M-v)*d+f.separation,e=b2Math.b2Min(e,x),v=t*b2Math.b2Clamp(x+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),x=-f.normalMass*v,v=f.positionImpulse;f.positionImpulse=b2Math.b2Max(v+x,0);v=(x=f.positionImpulse-v)*p,x=x*d;r.x-=c*v,r.y-=c*x,a-=h*(g*x-S*v),o.m_R.Set(a),l.x+=u*v,l.y+=u*x,m+=_*(C*x-M*v),s.m_R.Set(m)}o.m_rotation=a,s.m_rotation=m}return e>=-b2Settings.b2_linearSlop},PostSolve:function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,n=0;n<e.pointCount;++n){var o=i.points[n],s=e.points[n];o.normalImpulse=s.normalImpulse,o.tangentImpulse=s.tangentImpulse}},m_allocator:null,m_constraints:new Array,m_constraintCount:0};var b2CircleContact=Class.create();Object.extend(b2CircleContact.prototype,b2Contact.prototype),Object.extend(b2CircleContact.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m_manifold=[new b2Manifold],this.m_manifold[0].pointCount=0,this.m_manifold[0].points[0].normalImpulse=0,this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollideCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,!1),0<this.m_manifold[0].pointCount?this.m_manifoldCount=1:this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),b2CircleContact.Create=function(t,e,i){return new b2CircleContact(t,e)},b2CircleContact.Destroy=function(t,e){};var b2Conservative=Class.create();b2Conservative.prototype={initialize:function(){}},b2Conservative.R1=new b2Mat22,b2Conservative.R2=new b2Mat22,b2Conservative.x1=new b2Vec2,b2Conservative.x2=new b2Vec2,b2Conservative.Conservative=function(t,e){var i=t.GetBody(),n=e.GetBody(),o=i.m_position.x-i.m_position0.x,s=i.m_position.y-i.m_position0.y,r=i.m_rotation-i.m_rotation0,a=n.m_position.x-n.m_position0.x,l=n.m_position.y-n.m_position0.y,m=n.m_rotation-n.m_rotation0,c=t.GetMaxRadius(),h=e.GetMaxRadius(),u=i.m_position0.x,_=i.m_position0.y,p=i.m_rotation0,y=n.m_position0.x,b=n.m_position0.y,f=n.m_rotation0,x=u,v=_,g=p,S=y,C=b,M=f;b2Conservative.R1.Set(g),b2Conservative.R2.Set(M),t.QuickSync(p1,b2Conservative.R1),e.QuickSync(p2,b2Conservative.R2);for(var w,A,V=0,I=0,P=!0,B=0;B<10;++B){var R=b2Distance.Distance(b2Conservative.x1,b2Conservative.x2,t,e);if(R<b2Settings.b2_linearSlop){P=0!=B;break}if(0==B){w=b2Conservative.x2.x-b2Conservative.x1.x,A=b2Conservative.x2.y-b2Conservative.x1.y;Math.sqrt(w*w+A*A);var T=w*(o-a)+A*(s-l)+Math.abs(r)*c+Math.abs(m)*h;if(Math.abs(T)<Number.MIN_VALUE){P=!1;break}I=1/T}R=V+R*I;if(R<0||1<R){P=!1;break}if(R<(1+100*Number.MIN_VALUE)*V){P=!0;break}x=u+(V=R)*v1.x,v=_+V*v1.y,g=p+V*r,S=y+V*v2.x,C=b+V*v2.y,M=f+V*m,b2Conservative.R1.Set(g),b2Conservative.R2.Set(M),t.QuickSync(p1,b2Conservative.R1),e.QuickSync(p2,b2Conservative.R2)}if(P){w=b2Conservative.x2.x-b2Conservative.x1.x,A=b2Conservative.x2.y-b2Conservative.x1.y;var L=Math.sqrt(w*w+A*A);return L>FLT_EPSILON&&(d*=b2_linearSlop/L),i.IsStatic()?(i.m_position.x=x,i.m_position.y=v):(i.m_position.x=x-w,i.m_position.y=v-A),i.m_rotation=g,i.m_R.Set(g),i.QuickSyncShapes(),n.IsStatic()?(n.m_position.x=S,n.m_position.y=C):(n.m_position.x=S+w,n.m_position.y=C+A),n.m_position.x=S+w,n.m_position.y=C+A,n.m_rotation=M,n.m_R.Set(M),n.QuickSyncShapes(),!0}return t.QuickSync(i.m_position,i.m_R),e.QuickSync(n.m_position,n.m_R),!1};var b2NullContact=Class.create();Object.extend(b2NullContact.prototype,b2Contact.prototype),Object.extend(b2NullContact.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null},Evaluate:function(){},GetManifolds:function(){return null}});var b2PolyAndCircleContact=Class.create();Object.extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),Object.extend(b2PolyAndCircleContact.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m_manifold=[new b2Manifold],b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polyShape),b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape),this.m_manifold[0].pointCount=0,this.m_manifold[0].points[0].normalImpulse=0,this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollidePolyAndCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,!1),0<this.m_manifold[0].pointCount?this.m_manifoldCount=1:this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),b2PolyAndCircleContact.Create=function(t,e,i){return new b2PolyAndCircleContact(t,e)},b2PolyAndCircleContact.Destroy=function(t,e){};var b2PolyContact=Class.create();Object.extend(b2PolyContact.prototype,b2Contact.prototype),Object.extend(b2PolyContact.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m0=new b2Manifold,this.m_manifold=[new b2Manifold],this.m_manifold[0].pointCount=0},m0:new b2Manifold,Evaluate:function(){for(var t=this.m_manifold[0],e=this.m0.points,i=0;i<t.pointCount;i++){var n=e[i],o=t.points[i];n.normalImpulse=o.normalImpulse,n.tangentImpulse=o.tangentImpulse,n.id=o.id.Copy()}if(this.m0.pointCount=t.pointCount,b2Collision.b2CollidePoly(t,this.m_shape1,this.m_shape2,!1),0<t.pointCount){for(var s=[!1,!1],r=0;r<t.pointCount;++r){var a=t.points[r];a.normalImpulse=0,a.tangentImpulse=0;for(var l=a.id.key,m=0;m<this.m0.pointCount;++m)if(1!=s[m]){var c=this.m0.points[m];if(c.id.key==l){s[m]=!0,a.normalImpulse=c.normalImpulse,a.tangentImpulse=c.tangentImpulse;break}}}this.m_manifoldCount=1}else this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),b2PolyContact.Create=function(t,e,i){return new b2PolyContact(t,e)},b2PolyContact.Destroy=function(t,e){};var b2ContactManager=Class.create();Object.extend(b2ContactManager.prototype,b2PairCallback.prototype),Object.extend(b2ContactManager.prototype,{initialize:function(){this.m_nullContact=new b2NullContact,this.m_world=null,this.m_destroyImmediate=!1},PairAdded:function(t,e){var i=t,n=e,o=i.m_body,t=n.m_body;if(o.IsStatic()&&t.IsStatic())return this.m_nullContact;if(i.m_body==n.m_body)return this.m_nullContact;if(t.IsConnected(o))return this.m_nullContact;if(null!=this.m_world.m_filter&&0==this.m_world.m_filter.ShouldCollide(i,n))return this.m_nullContact;0==t.m_invMass&&(e=i,i=n,n=e,e=o,o=t,t=e);n=b2Contact.Create(i,n,this.m_world.m_blockAllocator);return null==n?this.m_nullContact:(n.m_prev=null,n.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=n),this.m_world.m_contactList=n,this.m_world.m_contactCount++,n)},PairRemoved:function(t,e,i){null==i||(i=i)!=this.m_nullContact&&(1==this.m_destroyImmediate?(this.DestroyContact(i),i=null):i.m_flags|=b2Contact.e_destroyFlag)},DestroyContact:function(t){var e,i,n,o;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),0<t.GetManifoldCount()&&(e=t.m_shape1.m_body,i=t.m_shape2.m_body,n=t.m_node1,o=t.m_node2,e.WakeUp(),i.WakeUp(),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n==e.m_contactList&&(e.m_contactList=n.next),n.prev=null,n.next=null,o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),o==i.m_contactList&&(i.m_contactList=o.next),o.prev=null,o.next=null),b2Contact.Destroy(t,this.m_world.m_blockAllocator),--this.m_world.m_contactCount},CleanContactList:function(){for(var t=this.m_world.m_contactList;null!=t;){var e=t,t=t.m_next;e.m_flags&b2Contact.e_destroyFlag&&(this.DestroyContact(e),0)}},Collide:function(){for(var t,e,i,n,o,s,r=this.m_world.m_contactList;null!=r;r=r.m_next)r.m_shape1.m_body.IsSleeping()&&r.m_shape2.m_body.IsSleeping()||(o=r.GetManifoldCount(),r.Evaluate(),s=r.GetManifoldCount(),0==o&&0<s?(t=r.m_shape1.m_body,e=r.m_shape2.m_body,i=r.m_node1,n=r.m_node2,i.contact=r,i.other=e,i.prev=null,i.next=t.m_contactList,null!=i.next&&(i.next.prev=r.m_node1),t.m_contactList=r.m_node1,n.contact=r,n.other=t,n.prev=null,n.next=e.m_contactList,null!=n.next&&(n.next.prev=n),e.m_contactList=n):0<o&&0==s&&(t=r.m_shape1.m_body,e=r.m_shape2.m_body,i=r.m_node1,n=r.m_node2,i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),i==t.m_contactList&&(t.m_contactList=i.next),i.prev=null,i.next=null,n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n==e.m_contactList&&(e.m_contactList=n.next),n.prev=null,n.next=null))},m_world:null,m_nullContact:new b2NullContact,m_destroyImmediate:null});var b2World=Class.create();b2World.prototype={initialize:function(t,e,i){this.step=new b2TimeStep,this.m_contactManager=new b2ContactManager,this.m_listener=null,this.m_filter=b2CollisionFilter.b2_defaultFilter,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodyDestroyList=null,this.m_allowSleep=i,this.m_gravity=e,(this.m_contactManager.m_world=this).m_broadPhase=new b2BroadPhase(t,this.m_contactManager);t=new b2BodyDef;this.m_groundBody=this.CreateBody(t)},SetListener:function(t){this.m_listener=t},SetFilter:function(t){this.m_filter=t},CreateBody:function(t){t=new b2Body(t,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},DestroyBody:function(t){t.m_flags&b2Body.e_destroyFlag||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_flags|=b2Body.e_destroyFlag,--this.m_bodyCount,t.m_prev=null,t.m_next=this.m_bodyDestroyList,this.m_bodyDestroyList=t)},CleanBodyList:function(){this.m_contactManager.m_destroyImmediate=!0;for(var t=this.m_bodyDestroyList;t;){for(var e=t,t=t.m_next,i=e.m_jointList;i;){var n=i,i=i.next;this.m_listener&&this.m_listener.NotifyJointDestroyed(n.joint),this.DestroyJoint(n.joint)}e.Destroy()}this.m_bodyDestroyList=null,this.m_contactManager.m_destroyImmediate=!1},CreateJoint:function(t){var e=b2Joint.Create(t,this.m_blockAllocator);if(e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,(e.m_node1.joint=e).m_node1.other=e.m_body2,e.m_node1.prev=null,e.m_node1.next=e.m_body1.m_jointList,e.m_body1.m_jointList&&(e.m_body1.m_jointList.prev=e.m_node1),e.m_body1.m_jointList=e.m_node1,(e.m_node2.joint=e).m_node2.other=e.m_body1,e.m_node2.prev=null,e.m_node2.next=e.m_body2.m_jointList,e.m_body2.m_jointList&&(e.m_body2.m_jointList.prev=e.m_node2),e.m_body2.m_jointList=e.m_node2,0==t.collideConnected)for(var i=(t.body1.m_shapeCount<t.body2.m_shapeCount?t.body1:t.body2).m_shapeList;i;i=i.m_next)i.ResetProxy(this.m_broadPhase);return e},DestroyJoint:function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_body1,n=t.m_body2;if(i.WakeUp(),n.WakeUp(),t.m_node1.prev&&(t.m_node1.prev.next=t.m_node1.next),t.m_node1.next&&(t.m_node1.next.prev=t.m_node1.prev),t.m_node1==i.m_jointList&&(i.m_jointList=t.m_node1.next),t.m_node1.prev=null,t.m_node1.next=null,t.m_node2.prev&&(t.m_node2.prev.next=t.m_node2.next),t.m_node2.next&&(t.m_node2.next.prev=t.m_node2.prev),t.m_node2==n.m_jointList&&(n.m_jointList=t.m_node2.next),t.m_node2.prev=null,t.m_node2.next=null,b2Joint.Destroy(t,this.m_blockAllocator),--this.m_jointCount,0==e)for(var o=(i.m_shapeCount<n.m_shapeCount?i:n).m_shapeList;o;o=o.m_next)o.ResetProxy(this.m_broadPhase)},GetGroundBody:function(){return this.m_groundBody},step:new b2TimeStep,Step:function(t,e){var i;this.step.dt=t,this.step.iterations=e,this.step.inv_dt=0<t?1/t:0,this.m_positionIterationCount=0,this.m_contactManager.CleanContactList(),this.CleanBodyList(),this.m_contactManager.Collide();var n=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(u=this.m_bodyList;null!=u;u=u.m_next)u.m_flags&=~b2Body.e_islandFlag;for(var o=this.m_contactList;null!=o;o=o.m_next)o.m_flags&=~b2Contact.e_islandFlag;for(var s=this.m_jointList;null!=s;s=s.m_next)s.m_islandFlag=!1;this.m_bodyCount;for(var r=new Array(this.m_bodyCount),a=0;a<this.m_bodyCount;a++)r[a]=null;for(var l=this.m_bodyList;null!=l;l=l.m_next)if(!(l.m_flags&(b2Body.e_staticFlag|b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag))){n.Clear();var m=0;for((r[m++]=l).m_flags|=b2Body.e_islandFlag;0<m;)if(u=r[--m],n.AddBody(u),u.m_flags&=~b2Body.e_sleepFlag,!(u.m_flags&b2Body.e_staticFlag)){for(var c=u.m_contactList;null!=c;c=c.next)c.contact.m_flags&b2Contact.e_islandFlag||(n.AddContact(c.contact),c.contact.m_flags|=b2Contact.e_islandFlag,(i=c.other).m_flags&b2Body.e_islandFlag||((r[m++]=i).m_flags|=b2Body.e_islandFlag));for(var h=u.m_jointList;null!=h;h=h.next)1!=h.joint.m_islandFlag&&(n.AddJoint(h.joint),h.joint.m_islandFlag=!0,(i=h.other).m_flags&b2Body.e_islandFlag||((r[m++]=i).m_flags|=b2Body.e_islandFlag))}n.Solve(this.step,this.m_gravity),this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount),this.m_allowSleep&&n.UpdateSleep(t);for(var u,_=0;_<n.m_bodyCount;++_)(u=n.m_bodies[_]).m_flags&b2Body.e_staticFlag&&(u.m_flags&=~b2Body.e_islandFlag),u.IsFrozen()&&this.m_listener&&this.m_listener.NotifyBoundaryViolated(u)==b2WorldListener.b2_destroyBody&&(this.DestroyBody(u),u=null,n.m_bodies[_]=null)}this.m_broadPhase.Commit()},Query:function(t,e,i){for(var n=new Array,o=this.m_broadPhase.QueryAABB(t,n,i),s=0;s<o;++s)e[s]=n[s];return o},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},m_blockAllocator:null,m_stackAllocator:null,m_broadPhase:null,m_contactManager:new b2ContactManager,m_bodyList:null,m_contactList:null,m_jointList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_bodyDestroyList:null,m_gravity:null,m_allowSleep:null,m_groundBody:null,m_listener:null,m_filter:null,m_positionIterationCount:0},b2World.s_enablePositionCorrection=1,b2World.s_enableWarmStarting=1;var b2WorldListener=Class.create();b2WorldListener.prototype={NotifyJointDestroyed:function(t){},NotifyBoundaryViolated:function(t){return b2WorldListener.b2_freezeBody},initialize:function(){}},b2WorldListener.b2_freezeBody=0,b2WorldListener.b2_destroyBody=1;var b2JointNode=Class.create();b2JointNode.prototype={other:null,joint:null,prev:null,next:null,initialize:function(){}};var b2Joint=Class.create();b2Joint.prototype={GetType:function(){return this.m_type},GetAnchor1:function(){return null},GetAnchor2:function(){return null},GetReactionForce:function(t){return null},GetReactionTorque:function(t){return 0},GetBody1:function(){return this.m_body1},GetBody2:function(){return this.m_body2},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},PrepareVelocitySolver:function(){},SolveVelocityConstraints:function(t){},PreparePositionSolver:function(){},SolvePositionConstraints:function(){return!1},m_type:0,m_prev:null,m_next:null,m_node1:new b2JointNode,m_node2:new b2JointNode,m_body1:null,m_body2:null,m_islandFlag:null,m_collideConnected:null,m_userData:null},b2Joint.Create=function(t,e){var i=null;switch(t.type){case b2Joint.e_distanceJoint:i=new b2DistanceJoint(t);break;case b2Joint.e_mouseJoint:i=new b2MouseJoint(t);break;case b2Joint.e_prismaticJoint:i=new b2PrismaticJoint(t);break;case b2Joint.e_revoluteJoint:i=new b2RevoluteJoint(t);break;case b2Joint.e_pulleyJoint:i=new b2PulleyJoint(t);break;case b2Joint.e_gearJoint:i=new b2GearJoint(t)}return i},b2Joint.Destroy=function(t,e){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3;var b2JointDef=Class.create();b2JointDef.prototype={initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1},type:0,userData:null,body1:null,body2:null,collideConnected:null};var b2DistanceJoint=Class.create();Object.extend(b2DistanceJoint.prototype,b2Joint.prototype),Object.extend(b2DistanceJoint.prototype,{initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2,e=this.m_body1.m_R,i=t.anchorPoint1.x-this.m_body1.m_position.x,n=t.anchorPoint1.y-this.m_body1.m_position.y,this.m_localAnchor1.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor1.y=i*e.col2.x+n*e.col2.y,e=this.m_body2.m_R,i=t.anchorPoint2.x-this.m_body2.m_position.x,n=t.anchorPoint2.y-this.m_body2.m_position.y,this.m_localAnchor2.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor2.y=i*e.col2.x+n*e.col2.y,i=t.anchorPoint2.x-t.anchorPoint1.x,n=t.anchorPoint2.y-t.anchorPoint1.y,this.m_length=Math.sqrt(i*i+n*n),this.m_impulse=0},PrepareVelocitySolver:function(){var t=this.m_body1.m_R,e=t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,n=(t=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y;this.m_u.x=this.m_body2.m_position.x+n-this.m_body1.m_position.x-e,this.m_u.y=this.m_body2.m_position.y+o-this.m_body1.m_position.y-i;var s=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);s>b2Settings.b2_linearSlop?this.m_u.Multiply(1/s):this.m_u.SetZero();t=e*this.m_u.y-i*this.m_u.x,s=n*this.m_u.y-o*this.m_u.x;this.m_mass=this.m_body1.m_invMass+this.m_body1.m_invI*t*t+this.m_body2.m_invMass+this.m_body2.m_invI*s*s,this.m_mass=1/this.m_mass,b2World.s_enableWarmStarting?(t=this.m_impulse*this.m_u.x,s=this.m_impulse*this.m_u.y,this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*t,this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*s,this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(e*s-i*t),this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*t,this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*s,this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(n*s-o*t)):this.m_impulse=0},SolveVelocityConstraints:function(t){var e=this.m_body1.m_R,i=e.col1.x*this.m_localAnchor1.x+e.col2.x*this.m_localAnchor1.y,n=e.col1.y*this.m_localAnchor1.x+e.col2.y*this.m_localAnchor1.y,o=(e=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+e.col2.x*this.m_localAnchor2.y,s=e.col1.y*this.m_localAnchor2.x+e.col2.y*this.m_localAnchor2.y,r=this.m_body1.m_linearVelocity.x+-this.m_body1.m_angularVelocity*n,a=this.m_body1.m_linearVelocity.y+this.m_body1.m_angularVelocity*i,l=this.m_body2.m_linearVelocity.x+-this.m_body2.m_angularVelocity*s,e=this.m_body2.m_linearVelocity.y+this.m_body2.m_angularVelocity*o,e=this.m_u.x*(l-r)+this.m_u.y*(e-a),a=-this.m_mass*e;this.m_impulse+=a;e=a*this.m_u.x,a*=this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*e,this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*a,this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(i*a-n*e),this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*e,this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*a,this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(o*a-s*e)},SolvePositionConstraints:function(){var t=this.m_body1.m_R,e=t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,n=(t=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,s=this.m_body2.m_position.x+n-this.m_body1.m_position.x-e,r=this.m_body2.m_position.y+o-this.m_body1.m_position.y-i,a=Math.sqrt(s*s+r*r);s/=a,r/=a;t=a-this.m_length,t=b2Math.b2Clamp(t,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),a=-this.m_mass*t;this.m_u.Set(s,r);r=a*this.m_u.x,a*=this.m_u.y;return this.m_body1.m_position.x-=this.m_body1.m_invMass*r,this.m_body1.m_position.y-=this.m_body1.m_invMass*a,this.m_body1.m_rotation-=this.m_body1.m_invI*(e*a-i*r),this.m_body2.m_position.x+=this.m_body2.m_invMass*r,this.m_body2.m_position.y+=this.m_body2.m_invMass*a,this.m_body2.m_rotation+=this.m_body2.m_invI*(n*a-o*r),this.m_body1.m_R.Set(this.m_body1.m_rotation),this.m_body2.m_R.Set(this.m_body2.m_rotation),b2Math.b2Abs(t)<b2Settings.b2_linearSlop},GetAnchor1:function(){return b2Math.AddVV(this.m_body1.m_position,b2Math.b2MulMV(this.m_body1.m_R,this.m_localAnchor1))},GetAnchor2:function(){return b2Math.AddVV(this.m_body2.m_position,b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor2))},GetReactionForce:function(t){var e=new b2Vec2;return e.SetV(this.m_u),e.Multiply(this.m_impulse*t),e},GetReactionTorque:function(t){return 0},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u:new b2Vec2,m_impulse:null,m_mass:null,m_length:null});var b2DistanceJointDef=Class.create();Object.extend(b2DistanceJointDef.prototype,b2JointDef.prototype),Object.extend(b2DistanceJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.anchorPoint1=new b2Vec2,this.anchorPoint2=new b2Vec2,this.type=b2Joint.e_distanceJoint},anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2});var b2Jacobian=Class.create();b2Jacobian.prototype={linear1:new b2Vec2,angular1:null,linear2:new b2Vec2,angular2:null,SetZero:function(){this.linear1.SetZero(),this.angular1=0,this.linear2.SetZero(),this.angular2=0},Set:function(t,e,i,n){this.linear1.SetV(t),this.angular1=e,this.linear2.SetV(i),this.angular2=n},Compute:function(t,e,i,n){return this.linear1.x*t.x+this.linear1.y*t.y+this.angular1*e+(this.linear2.x*i.x+this.linear2.y*i.y)+this.angular2*n},initialize:function(){this.linear1=new b2Vec2,this.linear2=new b2Vec2}};var b2GearJoint=Class.create();Object.extend(b2GearJoint.prototype,b2Joint.prototype),Object.extend(b2GearJoint.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetReactionForce:function(t){return new b2Vec2},GetReactionTorque:function(t){return 0},GetRatio:function(){return this.m_ratio},initialize:function(t){var e,i;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian,this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null,this.m_ground1=t.joint1.m_body1,this.m_body1=t.joint1.m_body2,e=t.joint1.m_type==b2Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.m_body1,this.m_body2=t.joint2.m_body2,i=t.joint2.m_type==b2Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*i,this.m_impulse=0},PrepareVelocitySolver:function(){var t,e,i,n,o,s=this.m_ground1,r=this.m_ground2,a=this.m_body1,l=this.m_body2,m=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angular1=-1,m+=a.m_invI):(i=s.m_R,n=this.m_prismatic1.m_localXAxis1,t=i.col1.x*n.x+i.col2.x*n.y,e=i.col1.y*n.x+i.col2.y*n.y,o=((i=a.m_R).col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y)*e-(i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y)*t,this.m_J.linear1.Set(-t,-e),this.m_J.angular1=-o,m+=a.m_invMass+a.m_invI*o*o),this.m_revolute2?(this.m_J.angular2=-this.m_ratio,m+=this.m_ratio*this.m_ratio*l.m_invI):(i=r.m_R,n=this.m_prismatic2.m_localXAxis1,t=i.col1.x*n.x+i.col2.x*n.y,e=i.col1.y*n.x+i.col2.y*n.y,o=((i=l.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y)*e-(i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y)*t,this.m_J.linear2.Set(-this.m_ratio*t,-this.m_ratio*e),this.m_J.angular2=-this.m_ratio*o,m+=this.m_ratio*this.m_ratio*(l.m_invMass+l.m_invI*o*o)),this.m_mass=1/m,a.m_linearVelocity.x+=a.m_invMass*this.m_impulse*this.m_J.linear1.x,a.m_linearVelocity.y+=a.m_invMass*this.m_impulse*this.m_J.linear1.y,a.m_angularVelocity+=a.m_invI*this.m_impulse*this.m_J.angular1,l.m_linearVelocity.x+=l.m_invMass*this.m_impulse*this.m_J.linear2.x,l.m_linearVelocity.y+=l.m_invMass*this.m_impulse*this.m_J.linear2.y,l.m_angularVelocity+=l.m_invI*this.m_impulse*this.m_J.angular2},SolveVelocityConstraints:function(t){var e=this.m_body1,i=this.m_body2,n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),n=-this.m_mass*n;this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linear1.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linear1.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angular1,i.m_linearVelocity.x+=i.m_invMass*n*this.m_J.linear2.x,i.m_linearVelocity.y+=i.m_invMass*n*this.m_J.linear2.y,i.m_angularVelocity+=i.m_invI*n*this.m_J.angular2},SolvePositionConstraints:function(){var t=this.m_body1,e=this.m_body2,i=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),n=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),n=this.m_constant-(i+this.m_ratio*n),n=-this.m_mass*n;return t.m_position.x+=t.m_invMass*n*this.m_J.linear1.x,t.m_position.y+=t.m_invMass*n*this.m_J.linear1.y,t.m_rotation+=t.m_invI*n*this.m_J.angular1,e.m_position.x+=e.m_invMass*n*this.m_J.linear2.x,e.m_position.y+=e.m_invMass*n*this.m_J.linear2.y,e.m_rotation+=e.m_invI*n*this.m_J.angular2,t.m_R.Set(t.m_rotation),e.m_R.Set(e.m_rotation),0<b2Settings.b2_linearSlop},m_ground1:null,m_ground2:null,m_revolute1:null,m_prismatic1:null,m_revolute2:null,m_prismatic2:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_J:new b2Jacobian,m_constant:null,m_ratio:null,m_mass:null,m_impulse:null});var b2GearJointDef=Class.create();Object.extend(b2GearJointDef.prototype,b2JointDef.prototype),Object.extend(b2GearJointDef.prototype,{initialize:function(){this.type=b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},joint1:null,joint2:null,ratio:null});var b2MouseJoint=Class.create();Object.extend(b2MouseJoint.prototype,b2Joint.prototype),Object.extend(b2MouseJoint.prototype,{GetAnchor1:function(){return this.m_target},GetAnchor2:function(){var t=b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);return t.Add(this.m_body2.m_position),t},GetReactionForce:function(t){var e=new b2Vec2;return e.SetV(this.m_impulse),e.Multiply(t),e},GetReactionTorque:function(t){return 0},SetTarget:function(t){this.m_body2.WakeUp(),this.m_target=t},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_ptpMass=new b2Mat22,this.m_C=new b2Vec2,this.m_target.SetV(t.target);var e=this.m_target.x-this.m_body2.m_position.x,i=this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=e*this.m_body2.m_R.col1.x+i*this.m_body2.m_R.col1.y,this.m_localAnchor.y=e*this.m_body2.m_R.col2.x+i*this.m_body2.m_R.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero();var n=this.m_body2.m_mass,e=2*b2Settings.b2_pi*t.frequencyHz,i=2*n*t.dampingRatio*e,e=n*e*e;this.m_gamma=1/(i+t.timeStep*e),this.m_beta=t.timeStep*e/(i+t.timeStep*e)},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,PrepareVelocitySolver:function(){var t=this.m_body2,e=t.m_R,i=e.col1.x*this.m_localAnchor.x+e.col2.x*this.m_localAnchor.y,n=e.col1.y*this.m_localAnchor.x+e.col2.y*this.m_localAnchor.y,o=t.m_invMass,s=t.m_invI;this.K1.col1.x=o,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=o,this.K2.col1.x=s*n*n,this.K2.col2.x=-s*i*n,this.K2.col1.y=-s*i*n,this.K2.col2.y=s*i*i,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.Invert(this.m_ptpMass),this.m_C.x=t.m_position.x+i-this.m_target.x,this.m_C.y=t.m_position.y+n-this.m_target.y,t.m_angularVelocity*=.98;var r=this.m_impulse.x,e=this.m_impulse.y;t.m_linearVelocity.x+=o*r,t.m_linearVelocity.y+=o*e,t.m_angularVelocity+=s*(i*e-n*r)},SolveVelocityConstraints:function(t){var e=this.m_body2,i=e.m_R,n=i.col1.x*this.m_localAnchor.x+i.col2.x*this.m_localAnchor.y,o=i.col1.y*this.m_localAnchor.x+i.col2.y*this.m_localAnchor.y,s=e.m_linearVelocity.x+-e.m_angularVelocity*o,r=e.m_linearVelocity.y+e.m_angularVelocity*n;i=this.m_ptpMass;var a=s+this.m_beta*t.inv_dt*this.m_C.x+this.m_gamma*this.m_impulse.x,l=r+this.m_beta*t.inv_dt*this.m_C.y+this.m_gamma*this.m_impulse.y,s=-(i.col1.x*a+i.col2.x*l),r=-(i.col1.y*a+i.col2.y*l),a=this.m_impulse.x,i=this.m_impulse.y;this.m_impulse.x+=s,this.m_impulse.y+=r;l=this.m_impulse.Length();l>t.dt*this.m_maxForce&&this.m_impulse.Multiply(t.dt*this.m_maxForce/l),s=this.m_impulse.x-a,r=this.m_impulse.y-i,e.m_linearVelocity.x+=e.m_invMass*s,e.m_linearVelocity.y+=e.m_invMass*r,e.m_angularVelocity+=e.m_invI*(n*r-o*s)},SolvePositionConstraints:function(){return!0},m_localAnchor:new b2Vec2,m_target:new b2Vec2,m_impulse:new b2Vec2,m_ptpMass:new b2Mat22,m_C:new b2Vec2,m_maxForce:null,m_beta:null,m_gamma:null});var b2MouseJointDef=Class.create();Object.extend(b2MouseJointDef.prototype,b2JointDef.prototype),Object.extend(b2MouseJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.target=new b2Vec2,this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7,this.timeStep=1/60},target:new b2Vec2,maxForce:null,frequencyHz:null,dampingRatio:null,timeStep:null});var b2PrismaticJoint=Class.create();Object.extend(b2PrismaticJoint.prototype,b2Joint.prototype),Object.extend(b2PrismaticJoint.prototype,{GetAnchor1:function(){var t=this.m_body1,e=new b2Vec2;return e.SetV(this.m_localAnchor1),e.MulM(t.m_R),e.Add(t.m_position),e},GetAnchor2:function(){var t=this.m_body2,e=new b2Vec2;return e.SetV(this.m_localAnchor2),e.MulM(t.m_R),e.Add(t.m_position),e},GetJointTranslation:function(){var t=this.m_body1,e=this.m_body2,i=t.m_R,n=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,s=(i=e.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,r=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,n=t.m_position.x+n,o=t.m_position.y+o,n=e.m_position.x+s-n,o=e.m_position.y+r-o;return((i=t.m_R).col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y)*n+(i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y)*o},GetJointSpeed:function(){var t=this.m_body1,e=this.m_body2,i=t.m_R,n=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,s=(i=e.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,r=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,a=t.m_position.x+n,l=t.m_position.y+o,m=e.m_position.x+s-a,c=e.m_position.y+r-l,h=(i=t.m_R).col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y,a=i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y,l=t.m_linearVelocity,i=e.m_linearVelocity,t=t.m_angularVelocity,e=e.m_angularVelocity;return-t*a*m+t*h*c+(h*(i.x+-e*r-l.x- -t*o)+a*(i.y+e*s-l.y-t*n))},GetMotorForce:function(t){return t*this.m_motorImpulse},SetMotorSpeed:function(t){this.m_motorSpeed=t},SetMotorForce:function(t){this.m_maxMotorForce=t},GetReactionForce:function(t){var e=t*this.m_limitImpulse,i=this.m_body1.m_R,n=e*(i.col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y),o=e*(i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y),t=e*(i.col1.x*this.m_localYAxis1.x+i.col2.x*this.m_localYAxis1.y),i=e*(i.col1.y*this.m_localYAxis1.x+i.col2.y*this.m_localYAxis1.y);return new b2Vec2(n+t,o+i)},GetReactionTorque:function(t){return t*this.m_angularImpulse},initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_linearJacobian=new b2Jacobian,this.m_motorJacobian=new b2Jacobian,e=this.m_body1.m_R,i=t.anchorPoint.x-this.m_body1.m_position.x,n=t.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),e=this.m_body2.m_R,i=t.anchorPoint.x-this.m_body2.m_position.x,n=t.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),e=this.m_body1.m_R,i=t.axis.x,n=t.axis.y,this.m_localXAxis1.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_linearJacobian.SetZero(),this.m_linearMass=0,this.m_linearImpulse=0,this.m_angularMass=0,this.m_angularImpulse=0,this.m_motorJacobian.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.motorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor},PrepareVelocitySolver:function(){var t,e,i=this.m_body1,n=this.m_body2,o=i.m_R,s=o.col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,r=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y,a=(o=n.m_R).col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,l=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,m=i.m_invMass,c=n.m_invMass,h=i.m_invI,u=n.m_invI,_=(o=i.m_R).col1.x*this.m_localYAxis1.x+o.col2.x*this.m_localYAxis1.y,p=o.col1.y*this.m_localYAxis1.x+o.col2.y*this.m_localYAxis1.y,d=n.m_position.x+a-i.m_position.x,y=n.m_position.y+l-i.m_position.y;this.m_linearJacobian.linear1.x=-_,this.m_linearJacobian.linear1.y=-p,this.m_linearJacobian.linear2.x=_,this.m_linearJacobian.linear2.y=p,this.m_linearJacobian.angular1=-(d*p-y*_),this.m_linearJacobian.angular2=a*p-l*_,this.m_linearMass=m+h*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+c+u*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2,this.m_linearMass=1/this.m_linearMass,this.m_angularMass=1/(h+u),(this.m_enableLimit||this.m_enableMotor)&&(_=(o=i.m_R).col1.x*this.m_localXAxis1.x+o.col2.x*this.m_localXAxis1.y,t=o.col1.y*this.m_localXAxis1.x+o.col2.y*this.m_localXAxis1.y,this.m_motorJacobian.linear1.x=-_,this.m_motorJacobian.linear1.y=-t,this.m_motorJacobian.linear2.x=_,this.m_motorJacobian.linear2.y=t,this.m_motorJacobian.angular1=-(d*t-y*_),this.m_motorJacobian.angular2=a*t-l*_,this.m_motorMass=m+h*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+c+u*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit&&(e=_*(d-s)+t*(y-r),b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:e<=this.m_lowerTranslation?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):e>=this.m_upperTranslation?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0))),0==this.m_enableMotor&&(this.m_motorImpulse=0),0==this.m_enableLimit&&(this.m_limitImpulse=0),b2World.s_enableWarmStarting?(d=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x,s=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y,t=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x,y=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y,r=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1,e=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2,i.m_linearVelocity.x+=m*d,i.m_linearVelocity.y+=m*s,i.m_angularVelocity+=h*r,n.m_linearVelocity.x+=c*t,n.m_linearVelocity.y+=c*y,n.m_angularVelocity+=u*e):(this.m_linearImpulse=0,this.m_angularImpulse=0,this.m_limitImpulse=0,this.m_motorImpulse=0),this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(t){var e,i=this.m_body1,n=this.m_body2,o=i.m_invMass,s=n.m_invMass,r=i.m_invI,a=n.m_invI,l=this.m_linearJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),l=-this.m_linearMass*l;this.m_linearImpulse+=l,i.m_linearVelocity.x+=o*l*this.m_linearJacobian.linear1.x,i.m_linearVelocity.y+=o*l*this.m_linearJacobian.linear1.y,i.m_angularVelocity+=r*l*this.m_linearJacobian.angular1,n.m_linearVelocity.x+=s*l*this.m_linearJacobian.linear2.x,n.m_linearVelocity.y+=s*l*this.m_linearJacobian.linear2.y,n.m_angularVelocity+=a*l*this.m_linearJacobian.angular2;var m,l=n.m_angularVelocity-i.m_angularVelocity,l=-this.m_angularMass*l;this.m_angularImpulse+=l,i.m_angularVelocity-=r*l,n.m_angularVelocity+=a*l,this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(l=this.m_motorJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity)-this.m_motorSpeed,m=-this.m_motorMass*l,l=this.m_motorImpulse,this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+m,-t.dt*this.m_maxMotorForce,t.dt*this.m_maxMotorForce),m=this.m_motorImpulse-l,i.m_linearVelocity.x+=o*m*this.m_motorJacobian.linear1.x,i.m_linearVelocity.y+=o*m*this.m_motorJacobian.linear1.y,i.m_angularVelocity+=r*m*this.m_motorJacobian.angular1,n.m_linearVelocity.x+=s*m*this.m_motorJacobian.linear2.x,n.m_linearVelocity.y+=s*m*this.m_motorJacobian.linear2.y,n.m_angularVelocity+=a*m*this.m_motorJacobian.angular2),this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit&&(m=this.m_motorJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),m=-this.m_motorMass*m,this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=m:this.m_limitState==b2Joint.e_atLowerLimit?(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+m,0),m=this.m_limitImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+m,0),m=this.m_limitImpulse-e),i.m_linearVelocity.x+=o*m*this.m_motorJacobian.linear1.x,i.m_linearVelocity.y+=o*m*this.m_motorJacobian.linear1.y,i.m_angularVelocity+=r*m*this.m_motorJacobian.angular1,n.m_linearVelocity.x+=s*m*this.m_motorJacobian.linear2.x,n.m_linearVelocity.y+=s*m*this.m_motorJacobian.linear2.y,n.m_angularVelocity+=a*m*this.m_motorJacobian.angular2)},SolvePositionConstraints:function(){var t,e,i=this.m_body1,n=this.m_body2,o=i.m_invMass,s=n.m_invMass,r=i.m_invI,a=n.m_invI,l=i.m_R,m=l.col1.x*this.m_localAnchor1.x+l.col2.x*this.m_localAnchor1.y,c=l.col1.y*this.m_localAnchor1.x+l.col2.y*this.m_localAnchor1.y,h=(l=n.m_R).col1.x*this.m_localAnchor2.x+l.col2.x*this.m_localAnchor2.y,u=l.col1.y*this.m_localAnchor2.x+l.col2.y*this.m_localAnchor2.y,_=i.m_position.x+m,p=i.m_position.y+c,d=n.m_position.x+h,y=n.m_position.y+u,b=d-_,f=y-p,x=((l=i.m_R).col1.x*this.m_localYAxis1.x+l.col2.x*this.m_localYAxis1.y)*b+(l.col1.y*this.m_localYAxis1.x+l.col2.y*this.m_localYAxis1.y)*f,x=b2Math.b2Clamp(x,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),v=-this.m_linearMass*x;i.m_position.x+=o*v*this.m_linearJacobian.linear1.x,i.m_position.y+=o*v*this.m_linearJacobian.linear1.y,i.m_rotation+=r*v*this.m_linearJacobian.angular1,n.m_position.x+=s*v*this.m_linearJacobian.linear2.x,n.m_position.y+=s*v*this.m_linearJacobian.linear2.y,n.m_rotation+=a*v*this.m_linearJacobian.angular2;var g=b2Math.b2Abs(x),v=n.m_rotation-i.m_rotation-this.m_initialAngle,v=b2Math.b2Clamp(v,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),x=-this.m_angularMass*v;i.m_rotation-=i.m_invI*x,i.m_R.Set(i.m_rotation),n.m_rotation+=n.m_invI*x,n.m_R.Set(n.m_rotation);x=b2Math.b2Abs(v);return this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit&&(m=(l=i.m_R).col1.x*this.m_localAnchor1.x+l.col2.x*this.m_localAnchor1.y,c=l.col1.y*this.m_localAnchor1.x+l.col2.y*this.m_localAnchor1.y,h=(l=n.m_R).col1.x*this.m_localAnchor2.x+l.col2.x*this.m_localAnchor2.y,u=l.col1.y*this.m_localAnchor2.x+l.col2.y*this.m_localAnchor2.y,_=i.m_position.x+m,p=i.m_position.y+c,b=n.m_position.x+h-_,f=n.m_position.y+u-p,l=((l=i.m_R).col1.x*this.m_localXAxis1.x+l.col2.x*this.m_localXAxis1.y)*b+(l.col1.y*this.m_localXAxis1.x+l.col2.y*this.m_localXAxis1.y)*f,f=0,this.m_limitState==b2Joint.e_equalLimits?(t=b2Math.b2Clamp(l,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),f=-this.m_motorMass*t,g=b2Math.b2Max(g,b2Math.b2Abs(v))):this.m_limitState==b2Joint.e_atLowerLimit?(t=l-this.m_lowerTranslation,g=b2Math.b2Max(g,-t),t=b2Math.b2Clamp(t+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),f=-this.m_motorMass*t,e=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+f,0),f=this.m_limitPositionImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(t=l-this.m_upperTranslation,g=b2Math.b2Max(g,t),t=b2Math.b2Clamp(t-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),f=-this.m_motorMass*t,e=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+f,0),f=this.m_limitPositionImpulse-e),i.m_position.x+=o*f*this.m_motorJacobian.linear1.x,i.m_position.y+=o*f*this.m_motorJacobian.linear1.y,i.m_rotation+=r*f*this.m_motorJacobian.angular1,i.m_R.Set(i.m_rotation),n.m_position.x+=s*f*this.m_motorJacobian.linear2.x,n.m_position.y+=s*f*this.m_motorJacobian.linear2.y,n.m_rotation+=a*f*this.m_motorJacobian.angular2,n.m_R.Set(n.m_rotation)),g<=b2Settings.b2_linearSlop&&x<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_localXAxis1:new b2Vec2,m_localYAxis1:new b2Vec2,m_initialAngle:null,m_linearJacobian:new b2Jacobian,m_linearMass:null,m_linearImpulse:null,m_angularMass:null,m_angularImpulse:null,m_motorJacobian:new b2Jacobian,m_motorMass:null,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_lowerTranslation:null,m_upperTranslation:null,m_maxMotorForce:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});var b2PrismaticJointDef=Class.create();Object.extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),Object.extend(b2PrismaticJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.type=b2Joint.e_prismaticJoint,this.anchorPoint=new b2Vec2(0,0),this.axis=new b2Vec2(0,0),this.lowerTranslation=0,this.upperTranslation=0,this.motorForce=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},anchorPoint:null,axis:null,lowerTranslation:null,upperTranslation:null,motorForce:null,motorSpeed:null,enableLimit:null,enableMotor:null});var b2PulleyJoint=Class.create();Object.extend(b2PulleyJoint.prototype,b2Joint.prototype),Object.extend(b2PulleyJoint.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetGroundPoint1:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor1.x,this.m_ground.m_position.y+this.m_groundAnchor1.y)},GetGroundPoint2:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor2.x,this.m_ground.m_position.y+this.m_groundAnchor2.y)},GetReactionForce:function(t){return new b2Vec2},GetReactionTorque:function(t){return 0},GetLength1:function(){var t=this.m_body1.m_R,e=this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),t=this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y),e=e-(this.m_ground.m_position.x+this.m_groundAnchor1.x),t=t-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return Math.sqrt(e*e+t*t)},GetLength2:function(){var t=this.m_body2.m_R,e=this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),t=this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y),e=e-(this.m_ground.m_position.x+this.m_groundAnchor2.x),t=t-(this.m_ground.m_position.y+this.m_groundAnchor2.y);return Math.sqrt(e*e+t*t)},GetRatio:function(){return this.m_ratio},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2,this.m_ground=this.m_body1.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundPoint1.x-this.m_ground.m_position.x,this.m_groundAnchor1.y=t.groundPoint1.y-this.m_ground.m_position.y,this.m_groundAnchor2.x=t.groundPoint2.x-this.m_ground.m_position.x,this.m_groundAnchor2.y=t.groundPoint2.y-this.m_ground.m_position.y,e=this.m_body1.m_R,i=t.anchorPoint1.x-this.m_body1.m_position.x,n=t.anchorPoint1.y-this.m_body1.m_position.y,this.m_localAnchor1.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor1.y=i*e.col2.x+n*e.col2.y,e=this.m_body2.m_R,i=t.anchorPoint2.x-this.m_body2.m_position.x,n=t.anchorPoint2.y-this.m_body2.m_position.y,this.m_localAnchor2.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor2.y=i*e.col2.x+n*e.col2.y,this.m_ratio=t.ratio,i=t.groundPoint1.x-t.anchorPoint1.x,n=t.groundPoint1.y-t.anchorPoint1.y;var e=Math.sqrt(i*i+n*n),i=t.groundPoint2.x-t.anchorPoint2.x,n=t.groundPoint2.y-t.anchorPoint2.y,n=Math.sqrt(i*i+n*n),e=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,e),n=b2Math.b2Max(.5*b2PulleyJoint.b2_minPulleyLength,n);this.m_constant=e+this.m_ratio*n,this.m_maxLength1=b2Math.b2Clamp(t.maxLength1,e,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.b2Clamp(t.maxLength2,n,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_pulleyImpulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},PrepareVelocitySolver:function(){var t=this.m_body1,e=this.m_body2,i=t.m_R,n=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,s=(i=e.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,r=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,a=t.m_position.x+n,l=t.m_position.y+o,m=e.m_position.x+s,c=e.m_position.y+r,h=this.m_ground.m_position.x+this.m_groundAnchor1.x,u=this.m_ground.m_position.y+this.m_groundAnchor1.y,_=this.m_ground.m_position.x+this.m_groundAnchor2.x,i=this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(a-h,l-u),this.m_u2.Set(m-_,c-i);m=this.m_u1.Length(),_=this.m_u2.Length();m>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/m):this.m_u1.SetZero(),_>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/_):this.m_u2.SetZero(),m<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):(this.m_limitState1=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0),_<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):(this.m_limitState2=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0);c=n*this.m_u1.y-o*this.m_u1.x,i=s*this.m_u2.y-r*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*c*c,this.m_limitMass2=e.m_invMass+e.m_invI*i*i,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass;m=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x,_=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y,c=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x,i=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*m,t.m_linearVelocity.y+=t.m_invMass*_,t.m_angularVelocity+=t.m_invI*(n*_-o*m),e.m_linearVelocity.x+=e.m_invMass*c,e.m_linearVelocity.y+=e.m_invMass*i,e.m_angularVelocity+=e.m_invI*(s*i-r*c)},SolveVelocityConstraints:function(t){var e,i,n,o,s=this.m_body1,r=this.m_body2,a=s.m_R,l=a.col1.x*this.m_localAnchor1.x+a.col2.x*this.m_localAnchor1.y,m=a.col1.y*this.m_localAnchor1.x+a.col2.y*this.m_localAnchor1.y,c=(a=r.m_R).col1.x*this.m_localAnchor2.x+a.col2.x*this.m_localAnchor2.y,h=a.col1.y*this.m_localAnchor2.x+a.col2.y*this.m_localAnchor2.y,u=s.m_linearVelocity.x+-s.m_angularVelocity*m,_=s.m_linearVelocity.y+s.m_angularVelocity*l,p=r.m_linearVelocity.x+-r.m_angularVelocity*h,d=r.m_linearVelocity.y+r.m_angularVelocity*c,y=-(this.m_u1.x*u+this.m_u1.y*_)-this.m_ratio*(this.m_u2.x*p+this.m_u2.y*d),b=-this.m_pulleyMass*y;this.m_pulleyImpulse+=b,e=-b*this.m_u1.x,i=-b*this.m_u1.y,n=-this.m_ratio*b*this.m_u2.x,a=-this.m_ratio*b*this.m_u2.y,s.m_linearVelocity.x+=s.m_invMass*e,s.m_linearVelocity.y+=s.m_invMass*i,s.m_angularVelocity+=s.m_invI*(l*i-m*e),r.m_linearVelocity.x+=r.m_invMass*n,r.m_linearVelocity.y+=r.m_invMass*a,r.m_angularVelocity+=r.m_invI*(c*a-h*n),this.m_limitState1==b2Joint.e_atUpperLimit&&(u=s.m_linearVelocity.x+-s.m_angularVelocity*m,_=s.m_linearVelocity.y+s.m_angularVelocity*l,y=-(this.m_u1.x*u+this.m_u1.y*_),b=-this.m_limitMass1*y,o=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.b2Max(0,this.m_limitImpulse1+b),e=-(b=this.m_limitImpulse1-o)*this.m_u1.x,i=-b*this.m_u1.y,s.m_linearVelocity.x+=s.m_invMass*e,s.m_linearVelocity.y+=s.m_invMass*i,s.m_angularVelocity+=s.m_invI*(l*i-m*e)),this.m_limitState2==b2Joint.e_atUpperLimit&&(p=r.m_linearVelocity.x+-r.m_angularVelocity*h,d=r.m_linearVelocity.y+r.m_angularVelocity*c,y=-(this.m_u2.x*p+this.m_u2.y*d),b=-this.m_limitMass2*y,o=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.b2Max(0,this.m_limitImpulse2+b),n=-(b=this.m_limitImpulse2-o)*this.m_u2.x,a=-b*this.m_u2.y,r.m_linearVelocity.x+=r.m_invMass*n,r.m_linearVelocity.y+=r.m_invMass*a,r.m_angularVelocity+=r.m_invI*(c*a-h*n))},SolvePositionConstraints:function(){var t,e,i,n,o,s,r=this.m_body1,a=this.m_body2,l=this.m_ground.m_position.x+this.m_groundAnchor1.x,m=this.m_ground.m_position.y+this.m_groundAnchor1.y,c=this.m_ground.m_position.x+this.m_groundAnchor2.x,h=this.m_ground.m_position.y+this.m_groundAnchor2.y,u=0,_=(t=r.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,p=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,d=(t=a.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,y=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,b=r.m_position.x+_,f=r.m_position.y+p,x=a.m_position.x+d,v=a.m_position.y+y;return this.m_u1.Set(b-l,f-m),this.m_u2.Set(x-c,v-h),e=this.m_u1.Length(),i=this.m_u2.Length(),e>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),i>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/i):this.m_u2.SetZero(),n=this.m_constant-e-this.m_ratio*i,u=b2Math.b2Max(u,Math.abs(n)),n=b2Math.b2Clamp(n,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),b=-(o=-this.m_pulleyMass*n)*this.m_u1.x,f=-o*this.m_u1.y,x=-this.m_ratio*o*this.m_u2.x,v=-this.m_ratio*o*this.m_u2.y,r.m_position.x+=r.m_invMass*b,r.m_position.y+=r.m_invMass*f,r.m_rotation+=r.m_invI*(_*f-p*b),a.m_position.x+=a.m_invMass*x,a.m_position.y+=a.m_invMass*v,a.m_rotation+=a.m_invI*(d*v-y*x),r.m_R.Set(r.m_rotation),a.m_R.Set(a.m_rotation),this.m_limitState1==b2Joint.e_atUpperLimit&&(_=(t=r.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,p=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,b=r.m_position.x+_,f=r.m_position.y+p,this.m_u1.Set(b-l,f-m),(e=this.m_u1.Length())>b2Settings.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),n=this.m_maxLength1-e,u=b2Math.b2Max(u,-n),n=b2Math.b2Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),o=-this.m_limitMass1*n,s=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+o),b=-(o=this.m_limitPositionImpulse1-s)*this.m_u1.x,f=-o*this.m_u1.y,r.m_position.x+=r.m_invMass*b,r.m_position.y+=r.m_invMass*f,r.m_rotation+=r.m_invI*(_*f-p*b),r.m_R.Set(r.m_rotation)),this.m_limitState2==b2Joint.e_atUpperLimit&&(d=(t=a.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,y=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,x=a.m_position.x+d,v=a.m_position.y+y,this.m_u2.Set(x-c,v-h),(i=this.m_u2.Length())>b2Settings.b2_linearSlop?(this.m_u2.x*=1/i,this.m_u2.y*=1/i):this.m_u2.SetZero(),n=this.m_maxLength2-i,u=b2Math.b2Max(u,-n),n=b2Math.b2Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),o=-this.m_limitMass2*n,s=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+o),x=-(o=this.m_limitPositionImpulse2-s)*this.m_u2.x,v=-o*this.m_u2.y,a.m_position.x+=a.m_invMass*x,a.m_position.y+=a.m_invMass*v,a.m_rotation+=a.m_invI*(d*v-y*x),a.m_R.Set(a.m_rotation)),u<b2Settings.b2_linearSlop},m_ground:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u1:new b2Vec2,m_u2:new b2Vec2,m_constant:null,m_ratio:null,m_maxLength1:null,m_maxLength2:null,m_pulleyMass:null,m_limitMass1:null,m_limitMass2:null,m_pulleyImpulse:null,m_limitImpulse1:null,m_limitImpulse2:null,m_limitPositionImpulse1:null,m_limitPositionImpulse2:null,m_limitState1:0,m_limitState2:0}),b2PulleyJoint.b2_minPulleyLength=b2Settings.b2_lengthUnitsPerMeter;var b2PulleyJointDef=Class.create();Object.extend(b2PulleyJointDef.prototype,b2JointDef.prototype),Object.extend(b2PulleyJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.groundPoint1=new b2Vec2,this.groundPoint2=new b2Vec2,this.anchorPoint1=new b2Vec2,this.anchorPoint2=new b2Vec2,this.type=b2Joint.e_pulleyJoint,this.groundPoint1.Set(-1,1),this.groundPoint2.Set(1,1),this.anchorPoint1.Set(-1,0),this.anchorPoint2.Set(1,0),this.maxLength1=.5*b2PulleyJoint.b2_minPulleyLength,this.maxLength2=.5*b2PulleyJoint.b2_minPulleyLength,this.ratio=1,this.collideConnected=!0},groundPoint1:new b2Vec2,groundPoint2:new b2Vec2,anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2,maxLength1:null,maxLength2:null,ratio:null});var b2RevoluteJoint=Class.create();Object.extend(b2RevoluteJoint.prototype,b2Joint.prototype),Object.extend(b2RevoluteJoint.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetJointAngle:function(){return this.m_body2.m_rotation-this.m_body1.m_rotation},GetJointSpeed:function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity},GetMotorTorque:function(t){return t*this.m_motorImpulse},SetMotorSpeed:function(t){this.m_motorSpeed=t},SetMotorTorque:function(t){this.m_maxMotorTorque=t},GetReactionForce:function(t){var e=this.m_ptpImpulse.Copy();return e.Multiply(t),e},GetReactionTorque:function(t){return t*this.m_limitImpulse},initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_ptpImpulse=new b2Vec2,this.m_ptpMass=new b2Mat22,e=this.m_body1.m_R,i=t.anchorPoint.x-this.m_body1.m_position.x,n=t.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor1.y=i*e.col2.x+n*e.col2.y,e=this.m_body2.m_R,i=t.anchorPoint.x-this.m_body2.m_position.x,n=t.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor2.y=i*e.col2.x+n*e.col2.y,this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_ptpImpulse.Set(0,0),this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.motorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,K3:new b2Mat22,PrepareVelocitySolver:function(){var t=this.m_body1,e=this.m_body2,i=t.m_R,n=i.col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,o=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,s=(i=e.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,r=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,a=t.m_invMass,l=e.m_invMass,m=t.m_invI,c=e.m_invI;this.K1.col1.x=a+l,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=a+l,this.K2.col1.x=m*o*o,this.K2.col2.x=-m*n*o,this.K2.col1.y=-m*n*o,this.K2.col2.y=m*n*n,this.K3.col1.x=c*r*r,this.K3.col2.x=-c*s*r,this.K3.col1.y=-c*s*r,this.K3.col2.y=c*s*s,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Invert(this.m_ptpMass),this.m_motorMass=1/(m+c),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit?(i=e.m_rotation-t.m_rotation-this.m_intialAngle,b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:i<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):i>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0)):this.m_limitImpulse=0,b2World.s_enableWarmStarting?(t.m_linearVelocity.x-=a*this.m_ptpImpulse.x,t.m_linearVelocity.y-=a*this.m_ptpImpulse.y,t.m_angularVelocity-=m*(n*this.m_ptpImpulse.y-o*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse),e.m_linearVelocity.x+=l*this.m_ptpImpulse.x,e.m_linearVelocity.y+=l*this.m_ptpImpulse.y,e.m_angularVelocity+=c*(s*this.m_ptpImpulse.y-r*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse)):(this.m_ptpImpulse.SetZero(),this.m_motorImpulse=0,this.m_limitImpulse=0),this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(t){var e,i,n=this.m_body1,o=this.m_body2,s=n.m_R,r=s.col1.x*this.m_localAnchor1.x+s.col2.x*this.m_localAnchor1.y,a=s.col1.y*this.m_localAnchor1.x+s.col2.y*this.m_localAnchor1.y,l=(s=o.m_R).col1.x*this.m_localAnchor2.x+s.col2.x*this.m_localAnchor2.y,m=s.col1.y*this.m_localAnchor2.x+s.col2.y*this.m_localAnchor2.y,c=o.m_linearVelocity.x+-o.m_angularVelocity*m-n.m_linearVelocity.x- -n.m_angularVelocity*a,h=o.m_linearVelocity.y+o.m_angularVelocity*l-n.m_linearVelocity.y-n.m_angularVelocity*r,s=-(this.m_ptpMass.col1.x*c+this.m_ptpMass.col2.x*h),h=-(this.m_ptpMass.col1.y*c+this.m_ptpMass.col2.y*h);this.m_ptpImpulse.x+=s,this.m_ptpImpulse.y+=h,n.m_linearVelocity.x-=n.m_invMass*s,n.m_linearVelocity.y-=n.m_invMass*h,n.m_angularVelocity-=n.m_invI*(r*h-a*s),o.m_linearVelocity.x+=o.m_invMass*s,o.m_linearVelocity.y+=o.m_invMass*h,o.m_angularVelocity+=o.m_invI*(l*h-m*s),this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(s=o.m_angularVelocity-n.m_angularVelocity-this.m_motorSpeed,i=-this.m_motorMass*s,s=this.m_motorImpulse,this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+i,-t.dt*this.m_maxMotorTorque,t.dt*this.m_maxMotorTorque),i=this.m_motorImpulse-s,n.m_angularVelocity-=n.m_invI*i,o.m_angularVelocity+=o.m_invI*i),this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit&&(i=o.m_angularVelocity-n.m_angularVelocity,i=-this.m_motorMass*i,this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=i:this.m_limitState==b2Joint.e_atLowerLimit?(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+i,0),i=this.m_limitImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+i,0),i=this.m_limitImpulse-e),n.m_angularVelocity-=n.m_invI*i,o.m_angularVelocity+=o.m_invI*i)},SolvePositionConstraints:function(){var t,e,i=this.m_body1,n=this.m_body2,o=i.m_R,s=o.col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,r=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y,a=(o=n.m_R).col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,l=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,m=i.m_position.x+s,c=i.m_position.y+r,h=n.m_position.x+a-m,u=n.m_position.y+l-c,_=Math.sqrt(h*h+u*u),p=i.m_invMass,o=n.m_invMass,m=i.m_invI,c=n.m_invI;this.K1.col1.x=p+o,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=p+o,this.K2.col1.x=m*r*r,this.K2.col2.x=-m*s*r,this.K2.col1.y=-m*s*r,this.K2.col2.y=m*s*s,this.K3.col1.x=c*l*l,this.K3.col2.x=-c*a*l,this.K3.col1.y=-c*a*l,this.K3.col2.y=c*a*a,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-h,-u);h=b2RevoluteJoint.tImpulse.x,u=b2RevoluteJoint.tImpulse.y;i.m_position.x-=i.m_invMass*h,i.m_position.y-=i.m_invMass*u,i.m_rotation-=i.m_invI*(s*u-r*h),i.m_R.Set(i.m_rotation),n.m_position.x+=n.m_invMass*h,n.m_position.y+=n.m_invMass*u,n.m_rotation+=n.m_invI*(a*u-l*h),n.m_R.Set(n.m_rotation);u=0;return this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit&&(l=n.m_rotation-i.m_rotation-this.m_intialAngle,h=0,this.m_limitState==b2Joint.e_equalLimits?(e=b2Math.b2Clamp(l,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),h=-this.m_motorMass*e,u=b2Math.b2Abs(e)):this.m_limitState==b2Joint.e_atLowerLimit?(e=l-this.m_lowerAngle,u=b2Math.b2Max(0,-e),e=b2Math.b2Clamp(e+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),h=-this.m_motorMass*e,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+h,0),h=this.m_limitPositionImpulse-t):this.m_limitState==b2Joint.e_atUpperLimit&&(e=l-this.m_upperAngle,u=b2Math.b2Max(0,e),e=b2Math.b2Clamp(e-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),h=-this.m_motorMass*e,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+h,0),h=this.m_limitPositionImpulse-t),i.m_rotation-=i.m_invI*h,i.m_R.Set(i.m_rotation),n.m_rotation+=n.m_invI*h,n.m_R.Set(n.m_rotation)),_<=b2Settings.b2_linearSlop&&u<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_ptpImpulse:new b2Vec2,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_ptpMass:new b2Mat22,m_motorMass:null,m_intialAngle:null,m_lowerAngle:null,m_upperAngle:null,m_maxMotorTorque:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0}),b2RevoluteJoint.tImpulse=new b2Vec2;var b2RevoluteJointDef=Class.create();Object.extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),Object.extend(b2RevoluteJointDef.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.type=b2Joint.e_revoluteJoint,this.anchorPoint=new b2Vec2(0,0),this.lowerAngle=0,this.upperAngle=0,this.motorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},anchorPoint:null,lowerAngle:null,upperAngle:null,motorTorque:null,motorSpeed:null,enableLimit:null,enableMotor:null});var delta=[0,0],stage=[window.screenX,window.screenY,window.innerWidth,window.innerHeight];getBrowserDimensions();var worldAABB,world,mouseJoint,query,gWebSearch,gImageSearch,isRunning=!1,isMouseDown=!1,iterations=1,timeStep=.04,walls=[],wall_thickness=200,wallsSetted=!1,mouse={x:0,y:0},mouseOnClick=[],elements=[],bodies=[],properties=[],page=0,imFeelingLuckyMode=!1,resultBodies=[],gravity={x:0,y:1};function init(){document.addEventListener("mousedown",onDocumentMouseDown,!1),document.addEventListener("mouseup",onDocumentMouseUp,!1),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("keyup",onDocumentKeyUp,!1),document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),document.addEventListener("touchend",onDocumentTouchEnd,!1),window.addEventListener("deviceorientation",onWindowDeviceOrientation,!1),(worldAABB=new b2AABB).minVertex.Set(-200,-200),worldAABB.maxVertex.Set(window.innerWidth+200,window.innerHeight+200),world=new b2World(worldAABB,new b2Vec2(0,0),!0),setWalls(),elements=getElementsByClass("box2d");for(var t=0;t<elements.length;t++)properties[t]=getElementProperties(elements[t]);for(t=0;t<elements.length;t++){var e=elements[t];for(e.style.position="absolute",e.style.left=properties[t][0]+"px",e.style.top=properties[t][1]+"px",e.style.width=properties[t][2]+"px",e.addEventListener("mousedown",onElementMouseDown,!1),e.addEventListener("mouseup",onElementMouseUp,!1),e.addEventListener("click",onElementClick,!1),bodies[t]=createBox(world,properties[t][0]+(properties[t][2]>>1),properties[t][1]+(properties[t][3]>>1),properties[t][2]/2,properties[t][3]/2,!1);e.offsetParent;)(e=e.offsetParent).style.position="static"}}function run(){isRunning=!0,setInterval(loop,25)}function onDocumentMouseDown(t){isMouseDown=!0}function onDocumentMouseUp(t){isMouseDown=!1}function onDocumentMouseMove(t){isRunning||run(),mouse.x=t.clientX,mouse.y=t.clientY}function onDocumentKeyUp(t){13==t.keyCode&&search()}function onDocumentTouchStart(t){1==t.touches.length&&(isRunning||run(),mouse.x=t.touches[0].pageX,mouse.y=t.touches[0].pageY,isMouseDown=!0)}function onDocumentTouchMove(t){1==t.touches.length&&(t.preventDefault(),mouse.x=t.touches[0].pageX,mouse.y=t.touches[0].pageY)}function onDocumentTouchEnd(t){0==t.touches.length&&(isMouseDown=!1)}function onWindowDeviceOrientation(t){/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)?$(window).width()>$(window).height()?t.beta&&(gravity.y=-1*Math.sin(t.gamma*Math.PI/180),gravity.x=t.beta*Math.PI/180):t.beta&&(gravity.x=Math.sin(t.gamma*Math.PI/180),gravity.y=t.beta*Math.PI/180):t.beta&&(gravity.x=Math.sin(t.gamma*Math.PI/180),gravity.y=Math.PI/4+t.beta*Math.PI/180)}function onElementMouseDown(t){t.preventDefault(),mouseOnClick[0]=t.clientX,mouseOnClick[1]=t.clientY}function onElementMouseUp(t){t.preventDefault()}function onElementClick(t){(mouseOnClick[0]>t.clientX+5||mouseOnClick[0]<t.clientX-5&&mouseOnClick[1]>t.clientY+5||mouseOnClick[1]<t.clientY-5)&&t.preventDefault(),t.target==document.getElementById("btnG")&&search(),t.target==document.getElementById("btnI")&&imFeelingLucky(),t.target==document.getElementById("q")&&document.getElementById("q").focus()}function loop(){for(getBrowserDimensions()&&setWalls(),delta[0]+=.5*(0-delta[0]),delta[1]+=.5*(0-delta[1]),world.m_gravity.x=350*gravity.x+delta[0],world.m_gravity.y=350*gravity.y+delta[1],mouseDrag(),world.Step(timeStep,iterations),i=0;i<elements.length;i++){var t=bodies[i],e=elements[i];e.style.left=t.m_position0.x-(properties[i][2]>>1)+"px",e.style.top=t.m_position0.y-(properties[i][3]>>1)+"px";t="rotate("+57.2957795*t.m_rotation0+"deg)";e.style.transform=t,e.style.WebkitTransform=t+" translateZ(0)",e.style.MozTransform=t,e.style.OTransform=t,e.style.msTransform=t}}function createBox(t,e,i,n,o,s,r){void 0===s&&(s=!0);var a=new b2BoxDef;s||(a.density=1),a.extents.Set(n,o);o=new b2BodyDef;return o.AddShape(a),o.position.Set(e,i),o.userData={element:r},t.CreateBody(o)}function mouseDrag(){var t,e;!isMouseDown||mouseJoint||(e=getBodyAtMouse())&&((t=new b2MouseJointDef).body1=world.m_groundBody,t.body2=e,t.target.Set(mouse.x,mouse.y),t.maxForce=3e4*e.m_mass,t.timeStep=timeStep,mouseJoint=world.CreateJoint(t),e.WakeUp()),isMouseDown||mouseJoint&&(world.DestroyJoint(mouseJoint),mouseJoint=null),mouseJoint&&(e=new b2Vec2(mouse.x,mouse.y),mouseJoint.SetTarget(e))}function getBodyAtMouse(){var t=new b2Vec2;t.Set(mouse.x,mouse.y);var e=new b2AABB;e.minVertex.Set(mouse.x-1,mouse.y-1),e.maxVertex.Set(mouse.x+1,mouse.y+1);for(var i=[],n=world.Query(e,i,10),o=null,s=0;s<n;s++)if(0==i[s].m_body.IsStatic()&&i[s].TestPoint(t)){o=i[s].m_body;break}return o}function setWalls(){wallsSetted&&(world.DestroyBody(walls[0]),world.DestroyBody(walls[1]),world.DestroyBody(walls[2]),world.DestroyBody(walls[3]),walls[0]=null,walls[1]=null,walls[2]=null,walls[3]=null),walls[0]=createBox(world,stage[2]/2,-wall_thickness,stage[2],wall_thickness),walls[1]=createBox(world,stage[2]/2,stage[3]+wall_thickness,stage[2],wall_thickness),walls[2]=createBox(world,-wall_thickness,stage[3]/2,wall_thickness,stage[3]),walls[3]=createBox(world,stage[2]+wall_thickness,stage[3]/2,wall_thickness,stage[3]),wallsSetted=!0}function getElementsByClass(t){var e=[],n=document.getElementsByTagName("*"),o=n.length;for(i=0,j=0;i<o;i++){var s=n[i].className.split(" ");for(k=0;k<s.length;k++)s[k]==t&&(e[j++]=n[i])}return e}function getElementProperties(t){for(var e=0,i=0,n=t.offsetWidth,o=t.offsetHeight;e+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;);return[e,i,n,o]}function getBrowserDimensions(){var t=!1;return stage[0]!=window.screenX&&(delta[0]=50*(window.screenX-stage[0]),stage[0]=window.screenX,t=!0),stage[1]!=window.screenY&&(delta[1]=50*(window.screenY-stage[1]),stage[1]=window.screenY,t=!0),stage[2]!=window.innerWidth&&(stage[2]=window.innerWidth,t=!0),stage[3]!=window.innerHeight&&(stage[3]=window.innerHeight,t=!0),t}function grav(){$("html").css("overflow","hidden"),$("body").css("overflow","hidden"),$("img").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("zIndex","99"))}),$("div").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("span").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("a").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("li").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("ol").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("p").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))}),$("embed").each(function(){$(this).children().length<1&&($(this).addClass("box2d"),$(this).css("position","relative"),$(this).css("zIndex","99"))})}setTimeout(function(){grav(),init(),run()},1e3);